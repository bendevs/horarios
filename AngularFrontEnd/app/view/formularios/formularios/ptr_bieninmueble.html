<script>
  function documentosDeSalidaController($scope,$rootScope, DreamFactory, CONFIG, FileUploader, fileUpload,sweet) {
    var sDocumentoSalida        =   "";
    $scope.tipoDocumento        =   "";
    $scope.tamanioDocumento     =   "";
    $scope.formatoDocumento     =   "";
    $scope.docsFechaCreacion    =   $scope.fechactual; 
    $scope.procesonro           =   0;       
    var idActividad             =   $scope.casoActual.casoactid;
    $scope.inicioDocumentosSalida = function () {

    $scope.procesonro = $scope.casoActual.procid;
      var resDatos = {
        "table_name":"_fr_casos",
        "filter": "cas_id="+$scope.casoActual.casoid
      };
      var obj=DreamFactory.api[CONFIG.SERVICE].getRecordsByFilter(resDatos);
      obj.success(function (response) {
        $scope.datos=JSON.parse(response.record[0].cas_datos);
        var nro = $scope.datos.PTR_BLOQ_INV;

        console.log(nro);
        switch (nro) {
          case '1':
          $scope.bloque1=true;
          $scope.bloque2=false;
          $scope.bloque3=false;
          $scope.bloque4=false;
          $scope.bloque5=false;
          break;
          case '2':
          $scope.bloque1=true;
          $scope.bloque2=true;
          $scope.bloque3=false;
          $scope.bloque4=false;
          $scope.bloque5=false;
          break;
          case '3':
          $scope.bloque1=true;
          $scope.bloque2=true;
          $scope.bloque3=true;
          $scope.bloque4=false;
          $scope.bloque5=false;
          break;
          case '4':
          $scope.bloque1=true;
          $scope.bloque2=true;
          $scope.bloque3=true;
          $scope.bloque4=true;
          $scope.bloque5=false;
          break;
          case '5':
          $scope.bloque1=true;
          $scope.bloque2=true;
          $scope.bloque3=true;
          $scope.bloque4=true;
          $scope.bloque5=true;
          break;
          default:
          $scope.bloque1=false;
          $scope.bloque2=false;
          $scope.bloque3=false;
          $scope.bloque4=false;
          $scope.bloque5=false;
        }
      });
      obj.error(function(error) {
      });
      if(DreamFactory.isReady()){                
      }      
      scroll(0,0); 
     /* var idCasoActual    =   $scope.casoActual.casoid;
      $scope.fotografiaimp(idCasoActual,$scope.casoActual.casonombre);
      $scope.impresion($scope.casoActual);*/
    };
  $scope.fotografiaimp = function(casoid,casonombre) {
    //$.blockUI();
    var proceso = 0;
    var ficha = '';
    var titulo = '';
    var idfrcasos = casoid;
    var nombre = casonombre;
    var tipo = nombre.substring(0,7);
    var resDatos = {
      "table_name":"_fr_casos",
      "filter": "cas_id="+idfrcasos
    };
    var obj=DreamFactory.api[CONFIG.SERVICE].getRecordsByFilter(resDatos);
    obj.success(function (response) {
      $scope.datosImp=response.record[0].cas_nro_caso;
      $scope.dataImp = JSON.parse(response.record[0].cas_datos);
      if(tipo == 'PTR_CBI'){
        ficha =$scope.dataImp.PTR_NUM_FIC;
        titulo = "ARCHIVO FOTOGRAFICO DE BIENES INMUEBLES"; 
      }else if(tipo == 'PTR_BMA'){
        ficha =$scope.dataImp.PTR_COD;
        titulo = "ARCHIVO FOTOGRAFICO DE BIENES ARQUEOLOGICOS"; 
      }else if(tipo == 'PTR_IME'){
        ficha =$scope.dataImp.PTR_NRO_FIC;
        titulo = "ARCHIVO FOTOGRAFICO DE ESCULTURAS"; 
      }else if(tipo == 'PTR-PCI'){
        ficha =$scope.dataImp.PTR_COD;
        titulo = "ARCHIVO FOTOGRAFICO DE PATRIMONIO INMATERIAL"; 
      }else if(tipo == 'PTR-CON'){
        ficha =$scope.dataImp.PTR_NUM_FIC;
        titulo = "ARCHIVO FOTOGRAFICO DE CONJUNTOS"; 
      }else if(tipo == 'PTR-ESP'){
        ficha =$scope.dataImp.PTR_REG;
        titulo = "ARCHIVO FOTOGRAFICO DE ESPACIOS ABIERTOS"; 
      }  

      console.log($scope.procesonro,$scope.datosImp);
      var reslocal = {
        "procedure_name":"ejecutartojson",
        "body":{
          "params": [
          {
            "name":"expression",

            "param_type":"IN","value":"select doc_url_logica,doc_correlativo, doc_datos, doc_nombre from dms_gt_documentos where doc_proceso = '"+ $scope.procesonro+"' and doc_estado = 'A' and doc_id ="+$scope.datosImp
          }]
        }
      };
      var obj=DreamFactory.api[CONFIG.SERVICE].callStoredProcWithParams(reslocal);
      obj.success(function (respons) {
        $scope.url = JSON.parse(respons[0].ejecutartojson)
        var pic =[];
        pic[0] ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAFCAYAAACJmvbYAAAABHNCSVQICAgIfAhkiAAAABl0RVh0U29mdHdhcmUAZ25vbWUtc2NyZWVuc2hvdO8Dvz4AAAAVSURBVAiZY/z///9/BhyACZcEDSUBO0oEBrFgibAAAAAASUVORK5CYII=";
        pic[1] ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAFCAYAAACJmvbYAAAABHNCSVQICAgIfAhkiAAAABl0RVh0U29mdHdhcmUAZ25vbWUtc2NyZWVuc2hvdO8Dvz4AAAAVSURBVAiZY/z///9/BhyACZcEDSUBO0oEBrFgibAAAAAASUVORK5CYII=";
        pic[2] ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAFCAYAAACJmvbYAAAABHNCSVQICAgIfAhkiAAAABl0RVh0U29mdHdhcmUAZ25vbWUtc2NyZWVuc2hvdO8Dvz4AAAAVSURBVAiZY/z///9/BhyACZcEDSUBO0oEBrFgibAAAAAASUVORK5CYII=";
        pic[3] ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAFCAYAAACJmvbYAAAABHNCSVQICAgIfAhkiAAAABl0RVh0U29mdHdhcmUAZ25vbWUtc2NyZWVuc2hvdO8Dvz4AAAAVSURBVAiZY/z///9/BhyACZcEDSUBO0oEBrFgibAAAAAASUVORK5CYII=";
        pic[4] ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAFCAYAAACJmvbYAAAABHNCSVQICAgIfAhkiAAAABl0RVh0U29mdHdhcmUAZ25vbWUtc2NyZWVuc2hvdO8Dvz4AAAAVSURBVAiZY/z///9/BhyACZcEDSUBO0oEBrFgibAAAAAASUVORK5CYII=";
        pic[5] ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAFCAYAAACJmvbYAAAABHNCSVQICAgIfAhkiAAAABl0RVh0U29mdHdhcmUAZ25vbWUtc2NyZWVuc2hvdO8Dvz4AAAAVSURBVAiZY/z///9/BhyACZcEDSUBO0oEBrFgibAAAAAASUVORK5CYII=";
        var nom = [];
        nom[0]=" ";
        nom[1]=" ";
        nom[2]=" ";
        nom[3]=" ";
        nom[4]=" ";
        nom[5]=" ";
        var k =0;
        var j=0;
        var n = 10;
        if($scope.url == null){

              sweet.show(' ', 'No se cuenta con fotografias para el Archivo Fotografico', 'error');
                $scope.archivofotografico(pic,nom,ficha,titulo);       
          }
          else{
        for(var i=0;i<$scope.url.length ;i++){
          var a = $scope.url[i].doc_nombre;
          var imga = $scope.url[i].doc_url_logica;
          imga = imga.replace(/Ñ/gi,"%d1");
          imga = imga.replace(/ñ/gi,"%f1");
          imga = imga.replace(/Á/gi,"%c1");
          imga = imga.replace(/á/gi,"%e1");
          imga = imga.replace(/É/gi,"%c9");
          imga = imga.replace(/é/gi,"%e9");
          imga = imga.replace(/Í/gi,"%cd");
          imga = imga.replace(/í/gi,"%ed");
          imga = imga.replace(/Ó/gi,"%d3");
          imga = imga.replace(/ó/gi,"%f3");
          imga = imga.replace(/Ú/gi,"%da");
          imga = imga.replace(/ú/gi,"%fa");
          imga = imga.replace(/ /gi,"%20");
          imga = imga.replace(/“/gi,"%93");
          imga = imga.replace(/”/gi,"%94");
          imga = imga.replace(/&/gi,"%26");
          imga = imga.replace(/\\/gi,"/");
          if($scope.url[i].doc_correlativo == 5){
            nom[0]=$scope.url[i].doc_datos;
            k++;          
            var img4 = new Image();
            img4.crossOrigin = 'Anonymous';
            img4.src = imga;
            img4.onload = function(){
                var canvas = document.createElement('CANVAS');
                var ctx = canvas.getContext('2d');
                canvas.height = img4.height;
                canvas.width = img4.width;
                ctx.drawImage(img4, 0, 0);
                pic[0] = canvas.toDataURL("image/jpeg",0.2);
                j++;
                if(j == n){
                  $scope.archivofotografico(pic,nom,ficha,titulo);
                }
              
            }
            img4.onerror = function(){
              sweet.show('Error de Carga de Imagen', a, 'error');
            }          
          }else if($scope.url[i].doc_correlativo == 6){
            nom[1]=$scope.url[i].doc_datos;
            k++;
            var img5 = new Image();
            img5.crossOrigin = 'Anonymous';
            img5.src = imga;
            img5.onload = function(){
              
                var canvas = document.createElement('CANVAS');
                var ctx = canvas.getContext('2d');
                canvas.height = img5.height;
                canvas.width = img5.width;
                console.log(img5.height,img5.width);
                ctx.drawImage(img5, 0, 0);
                pic[1] = canvas.toDataURL("image/jpeg",0.2);
                j++;
                if(j == n ){
                  $scope.archivofotografico(pic,nom,ficha,titulo);
                }
              
            }
            img5.onerror = function(){
              sweet.show('Error de Carga de Imagen', a, 'error');
            }
          }else if($scope.url[i].doc_correlativo == 7){
            nom[2]=$scope.url[i].doc_datos;
            k++;
            var img6 = new Image();
            img6.crossOrigin = 'Anonymous';
            img6.src = imga;
            img6.onload = function(){
              
                var canvas = document.createElement('CANVAS');
                var ctx = canvas.getContext('2d');
                canvas.height = img6.height;
                canvas.width = img6.width;
                console.log(img6.height,img6.width);
                ctx.drawImage(img6, 0, 0);
                pic[2] = canvas.toDataURL("image/jpeg",0.2);
                j++;
                if(j == n ){
                  $scope.archivofotografico(pic,nom,ficha,titulo);
                }
              
            }
            img6.onerror = function(){
              sweet.show('Error de Carga de Imagen', a, 'error');
            }
          }else if($scope.url[i].doc_correlativo ==8){
            nom[3]=$scope.url[i].doc_datos;
            k++;
            var img7 = new Image();
            img7.crossOrigin = 'Anonymous';
            img7.src = imga;
            img7.onload = function(){
             
                var canvas = document.createElement('CANVAS');
                var ctx = canvas.getContext('2d');
                canvas.height = img7.height;
                canvas.width = img7.width;
                console.log(img7.height,img7.width);
                ctx.drawImage(img7, 0, 0);
                pic[3] = canvas.toDataURL("image/jpeg",0.2);
                j++;
                if(j == n ){
                  $scope.archivofotografico(pic,nom,ficha,titulo);
                }
              
            }
            img7.onerror = function(){
              sweet.show('Error de Carga de Imagen', a , 'error');
            }
          }else if($scope.url[i].doc_correlativo ==9){
            nom[4]=$scope.url[i].doc_datos;
            k++;
            var img8 = new Image();
            img8.crossOrigin = 'Anonymous';
            img8.src = imga;
            img8.onload = function(){
              
                var canvas = document.createElement('CANVAS');
                var ctx = canvas.getContext('2d');
                canvas.height = img8.height;
                canvas.width = img8.width;
                console.log(img8.height,img8.width);
                ctx.drawImage(img8, 0, 0);
                pic[4] = canvas.toDataURL("image/jpeg",0.2);
                j++;
                if(j == n){
                $scope.archivofotografico(pic,nom,ficha,titulo);
                }
                         
            }
            img8.onerror = function(){
              sweet.show('Error de Carga de Imagen', a, 'error');
            }
          }else if($scope.url[i].doc_correlativo ==10){
            nom[5]=$scope.url[i].doc_datos;
            k++;
            var img9 = new Image();
            img9.crossOrigin = 'Anonymous';
            img9.src = imga;
            img9.onload = function(){
              
                var canvas = document.createElement('CANVAS');
                var ctx = canvas.getContext('2d');
                canvas.height = img9.height;
                canvas.width = img9.width;
                console.log(img9.height,img9.width);
                ctx.drawImage(img9, 0, 0);
                pic[5] = canvas.toDataURL("image/jpeg",0.2);
                j++;
                if(j == n){
                  $scope.archivofotografico(pic,nom,ficha,titulo); 
                }
                         
            }
            img9.onerror = function(){
              sweet.show('Error de Carga de Imagen', a, 'error');
            }
          }
          if($scope.url.length == i+1 && k==0){
            sweet.show(' ', 'No se cuenta con fotografias para el Archivo Fotografico', 'error');
            
            $scope.archivofotografico(pic,nom,ficha,titulo);
          }

          if($scope.url.length == i+1){
            n=k;
          }
        }
      }
      })
      obj.error(function(error) {
      });
      })
    obj.error(function(error) {
    });
  };
  $scope.primero = "";
  $scope.segundo = "";
  $scope.archivofotografico = function(pic,nom,fic,texto){
    console.log("Archivo",nom);
    var doc = new jsPDF('p', 'pt');
    doc.addImage(material,'JPEG', 35, 40, 525, 60);
    doc.setTextColor(0);
    doc.setFontStyle('bold');
    doc.setFontSize(11);
    doc.text(texto,40,120);
    doc.setFontSize(9);
    doc.text('NRO. FICHA: ',400,120);
    doc.setFontStyle('normal');
    doc.text(fic,470,120);
    doc.rect(390, 105, 170, 25);
      var a=40;
      var b=360;
      var g=135;
      var j=0;
        doc.setFontSize(8);
      for(var i=0;i<pic.length;i++){
        j++;
        if(nom[i] === null){
          nom[i] = " ";
        }
        if(i%2 === 0){
          doc.addImage(pic[i],'JPEG', a, g, 190, 190);
          doc.setTextColor(0);
          doc.text(nom[i],a, g+200);
        }
        else{
          doc.addImage(pic[i],'JPEG', b, g, 190, 190);
          doc.setTextColor(0);
          doc.text(nom[i],b, g+200);
          g=g+220;
        }
      }
      doc.setFontStyle('normal');
      doc.setFontSize(8); 
      doc.text("Para cualquier consulta, por favor comunicarse al Telefono. 2-2440746 ", 150, doc.internal.pageSize.height - 40);
      doc.text("Página 1 de 1", 470, doc.internal.pageSize.height - 40);
      $.unblockUI();
      //doc.save('arcfotografico'+'.pdf');
        $('#visorFumm object').attr('data',doc.output('datauristring'));
        $("#divPopup8").modal('show');

        //window.open(doc.output('datauri'));  
  };
  $scope.inmueble = function(idfrcasos,nro) {
    //$.blockUI();  
    console.log("IMPRESION INMUEBLE");
    var resDatos = {
      "table_name":"_fr_casos",
      "filter": "cas_id="+idfrcasos
    };
    var obj=DreamFactory.api[CONFIG.SERVICE].getRecordsByFilter(resDatos);
    obj.success(function (response) {
      $scope.datos=response.record[0].cas_nro_caso;
      var reslocal = {
        "procedure_name":"ejecutartojson",
        "body":{
          "params": [
          {
            "name":"expression",

            "param_type":"IN","value":"select doc_url_logica,doc_correlativo, doc_datos ,doc_nombre from dms_gt_documentos where doc_proceso = '"+ $scope.procesonro+"' and doc_estado = 'A' and doc_id ="+$scope.datos
          }]
        }
      };
      var obj=DreamFactory.api[CONFIG.SERVICE].callStoredProcWithParams(reslocal);
      obj.success(function (respons) {
        $scope.url = JSON.parse(respons[0].ejecutartojson)
        var pic =[];
        pic[0] ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAFCAYAAACJmvbYAAAABHNCSVQICAgIfAhkiAAAABl0RVh0U29mdHdhcmUAZ25vbWUtc2NyZWVuc2hvdO8Dvz4AAAAVSURBVAiZY/z///9/BhyACZcEDSUBO0oEBrFgibAAAAAASUVORK5CYII=";
        pic[1] ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAFCAYAAACJmvbYAAAABHNCSVQICAgIfAhkiAAAABl0RVh0U29mdHdhcmUAZ25vbWUtc2NyZWVuc2hvdO8Dvz4AAAAVSURBVAiZY/z///9/BhyACZcEDSUBO0oEBrFgibAAAAAASUVORK5CYII=";
        pic[2] ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAFCAYAAACJmvbYAAAABHNCSVQICAgIfAhkiAAAABl0RVh0U29mdHdhcmUAZ25vbWUtc2NyZWVuc2hvdO8Dvz4AAAAVSURBVAiZY/z///9/BhyACZcEDSUBO0oEBrFgibAAAAAASUVORK5CYII=";
        pic[3] ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAFCAYAAACJmvbYAAAABHNCSVQICAgIfAhkiAAAABl0RVh0U29mdHdhcmUAZ25vbWUtc2NyZWVuc2hvdO8Dvz4AAAAVSURBVAiZY/z///9/BhyACZcEDSUBO0oEBrFgibAAAAAASUVORK5CYII=";
        pic[4] ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAFCAYAAACJmvbYAAAABHNCSVQICAgIfAhkiAAAABl0RVh0U29mdHdhcmUAZ25vbWUtc2NyZWVuc2hvdO8Dvz4AAAAVSURBVAiZY/z///9/BhyACZcEDSUBO0oEBrFgibAAAAAASUVORK5CYII=";
        pic[5] ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAFCAYAAACJmvbYAAAABHNCSVQICAgIfAhkiAAAABl0RVh0U29mdHdhcmUAZ25vbWUtc2NyZWVuc2hvdO8Dvz4AAAAVSURBVAiZY/z///9/BhyACZcEDSUBO0oEBrFgibAAAAAASUVORK5CYII=";
        pic[6] ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAFCAYAAACJmvbYAAAABHNCSVQICAgIfAhkiAAAABl0RVh0U29mdHdhcmUAZ25vbWUtc2NyZWVuc2hvdO8Dvz4AAAAVSURBVAiZY/z///9/BhyACZcEDSUBO0oEBrFgibAAAAAASUVORK5CYII=";
        pic[7] ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAFCAYAAACJmvbYAAAABHNCSVQICAgIfAhkiAAAABl0RVh0U29mdHdhcmUAZ25vbWUtc2NyZWVuc2hvdO8Dvz4AAAAVSURBVAiZY/z///9/BhyACZcEDSUBO0oEBrFgibAAAAAASUVORK5CYII=";
        pic[8] ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAFCAYAAACJmvbYAAAABHNCSVQICAgIfAhkiAAAABl0RVh0U29mdHdhcmUAZ25vbWUtc2NyZWVuc2hvdO8Dvz4AAAAVSURBVAiZY/z///9/BhyACZcEDSUBO0oEBrFgibAAAAAASUVORK5CYII=";
        pic[9] ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAFCAYAAACJmvbYAAAABHNCSVQICAgIfAhkiAAAABl0RVh0U29mdHdhcmUAZ25vbWUtc2NyZWVuc2hvdO8Dvz4AAAAVSURBVAiZY/z///9/BhyACZcEDSUBO0oEBrFgibAAAAAASUVORK5CYII=";
        var nom = [];
        nom[0]=" ";
        nom[1]=" ";
        nom[2]=" ";
        nom[3]=" ";
        nom[4]=" ";
        nom[5]=" ";
        var k =0;
        var j=0;
        var n = 10;
        if($scope.url == null){
                $scope.fichainmueble(idfrcasos,pic,nro,nom);         
          }
          else{
        for(var i=0;i<$scope.url.length ;i++){
          var a = $scope.url[i].doc_nombre;
          var imga = $scope.url[i].doc_url_logica;
          imga = imga.replace(/Ñ/gi,"%d1");
          imga = imga.replace(/ñ/gi,"%f1");
          imga = imga.replace(/Á/gi,"%c1");
          imga = imga.replace(/á/gi,"%e1");
          imga = imga.replace(/É/gi,"%c9");
          imga = imga.replace(/é/gi,"%e9");
          imga = imga.replace(/Í/gi,"%cd");
          imga = imga.replace(/í/gi,"%ed");
          imga = imga.replace(/Ó/gi,"%d3");
          imga = imga.replace(/ó/gi,"%f3");
          imga = imga.replace(/Ú/gi,"%da");
          imga = imga.replace(/ú/gi,"%fa");
          imga = imga.replace(/ /gi,"%20");
          imga = imga.replace(/“/gi,"%93");
          imga = imga.replace(/”/gi,"%94");
          imga = imga.replace(/&/gi,"%26");
          imga = imga.replace(/\\/gi,"/");
          if($scope.url[i].doc_correlativo == 1){
            k++;
            var img = new Image();
            img.crossOrigin = 'Anonymous';
            img.src = imga;
            img.onload = function(){
                var canvas = document.createElement('CANVAS');
                var ctx = canvas.getContext('2d');
                canvas.height = img.height;
                canvas.width = img.width;
                ctx.drawImage(img, 0, 0);      
                pic[0] = canvas.toDataURL("image/jpeg",0.3);
              j++;
              if(j == n){
                $scope.fichainmueble(idfrcasos,pic,nro,nom);
              }
            }
            img.onerror = function(){
              sweet.show('Error de Carga de Imagen', a, 'error');
            }
          }else if($scope.url[i].doc_correlativo == 2){
            k++;
            var img1 = new Image();
            img1.crossOrigin = 'Anonymous';
            img1.src = imga;
            img1.onload = function(){
                var canvas = document.createElement('CANVAS');
                var ctx = canvas.getContext('2d');
                canvas.height = img1.height;
                canvas.width = img1.width;
                ctx.drawImage(img1, 0, 0);
                pic[1] = canvas.toDataURL("image/jpeg",0.1);
              j++;
              if(j == n){
                $scope.fichainmueble(idfrcasos,pic,nro,nom);
              }
            }
            img1.onerror = function(){
              sweet.show('Error de Carga de Imagen', a, 'error');
            }
          }else if($scope.url[i].doc_correlativo == 3){
            k++;
            var img2 = new Image();
            img2.crossOrigin = 'Anonymous';
            img2.src = imga;
            img2.onload = function(){
              
                var canvas = document.createElement('CANVAS');
                var ctx = canvas.getContext('2d');
                canvas.height = img2.height;
                canvas.width = img2.width;
                ctx.drawImage(img2, 0, 0);
                pic[2] = canvas.toDataURL("image/jpeg",0.1);
              j++;
              if(j == n){
                $scope.fichainmueble(idfrcasos,pic,nro,nom);
              }
            }
            img2.onerror = function(){
              sweet.show('Error de Carga de Imagen', a, 'error');
            }
          }else if($scope.url[i].doc_correlativo ==4){
            k++;
            var img3 = new Image();
            img3.crossOrigin = 'Anonymous';
            img3.src = imga;
            img3.onload = function(){
                var canvas = document.createElement('CANVAS');
                var ctx = canvas.getContext('2d');
                canvas.height = img3.height;
                canvas.width = img3.width;
                ctx.drawImage(img3, 0, 0);
                pic[3] = canvas.toDataURL("image/jpeg",0.1);
              j++;
              if(j == n){
                $scope.fichainmueble(idfrcasos,pic,nro,nom);
              }
            }
            img3.onerror = function(){
              sweet.show('Error de Carga de Imagen', a, 'error');
            }
          }else if($scope.url[i].doc_correlativo == 5){
            nom[0]=$scope.url[i].doc_datos;
            k++;          
            var img4 = new Image();
            img4.crossOrigin = 'Anonymous';
            img4.src = imga;
            img4.onload = function(){
                var canvas = document.createElement('CANVAS');
                var ctx = canvas.getContext('2d');
                canvas.height = img4.height;
                canvas.width = img4.width;
                ctx.drawImage(img4, 0, 0);
                pic[4] = canvas.toDataURL("image/jpg",0.2);
              j++;
              if(j == n){
                $scope.fichainmueble(idfrcasos,pic,nro,nom);
              }
            }
            img4.onerror = function(){
              sweet.show('Error de Carga de Imagen', a, 'error');
            }         
          }else if($scope.url[i].doc_correlativo == 6){
            nom[1]=$scope.url[i].doc_datos;
            k++;
            var img5 = new Image();
            img5.crossOrigin = 'Anonymous';
            img5.src = imga;
            img5.onload = function(){
                var canvas = document.createElement('CANVAS');
                var ctx = canvas.getContext('2d');
                canvas.height = img5.height;
                canvas.width = img5.width;
                ctx.drawImage(img5, 0, 0);
                pic[5] = canvas.toDataURL("image/jpeg",0.2);
              j++;
              if(j == n ){
                $scope.fichainmueble(idfrcasos,pic,nro,nom);
              }
            }
            img5.onerror = function(){
              sweet.show('Error de Carga de Imagen', a, 'error');
            }
          }else if($scope.url[i].doc_correlativo == 7){
            nom[2]=$scope.url[i].doc_datos;
            k++;
            var img6 = new Image();
            img6.crossOrigin = 'Anonymous';
            img6.src = imga;
            img6.onload = function(){
                var canvas = document.createElement('CANVAS');
                var ctx = canvas.getContext('2d');
                canvas.height = img6.height;
                canvas.width = img6.width;
                ctx.drawImage(img6, 0, 0);
                pic[6] = canvas.toDataURL("image/jpeg",0.2);
              j++;
              if(j == n ){
                $scope.fichainmueble(idfrcasos,pic,nro,nom);
              }
            }
            img6.onerror = function(){
              sweet.show('Error de Carga de Imagen', a, 'error');
            }
          }else if($scope.url[i].doc_correlativo ==8){
            nom[3]=$scope.url[i].doc_datos;
            k++;
            var img7 = new Image();
            img7.crossOrigin = 'Anonymous';
            img7.src = imga;
            img7.onload = function(){
                var canvas = document.createElement('CANVAS');
                var ctx = canvas.getContext('2d');
                canvas.height = img7.height;
                canvas.width = img7.width;
                ctx.drawImage(img7, 0, 0);
                pic[7] = canvas.toDataURL("image/jpeg",0.2);
              j++;
              if(j == n ){
                $scope.fichainmueble(idfrcasos,pic,nro,nom);
              }
            }
            img7.onerror = function(){
              sweet.show('Error de Carga de Imagen', a, 'error');
            }
          }else if($scope.url[i].doc_correlativo ==9){
            nom[4]=$scope.url[i].doc_datos;
            k++;
            var img8 = new Image();
            img8.crossOrigin = 'Anonymous';
            img8.src = imga;
            img8.onload = function(){
                var canvas = document.createElement('CANVAS');
                var ctx = canvas.getContext('2d');
                canvas.height = img8.height;
                canvas.width = img8.width;
                ctx.drawImage(img8, 0, 0);
                pic[8] = canvas.toDataURL("image/jpeg",0.2);
              j++;
              if(j == n){
                $scope.fichainmueble(idfrcasos,pic,nro,nom);
              }
            }
            img8.onerror = function(){
              sweet.show('Error de Carga de Imagen', a, 'error');
            }
          }else if($scope.url[i].doc_correlativo ==10){
            nom[5]=$scope.url[i].doc_datos;
            k++;
            var img9 = new Image();
            img9.crossOrigin = 'Anonymous';
            img9.src = imga;
            img9.onload = function(){
                var canvas = document.createElement('CANVAS');
                var ctx = canvas.getContext('2d');
                canvas.height = img9.height;
                canvas.width = img9.width;
                ctx.drawImage(img9, 0, 0);
                pic[9] = canvas.toDataURL("image/jpeg",0.2);
              j++;
              if(j == n){
                $scope.fichainmueble(idfrcasos,pic,nro,nom);
              }
            }
            img9.onerror = function(){
              sweet.show('Error de Carga de Imagen', a, 'error');
            }
          }
          if($scope.url.length == i+1 && k==0){
            $scope.fichainmueble(idfrcasos,pic,nro,nom);
          }

          if($scope.url.length == i+1){
            n=k;
          }
        }
      }
      })
      obj.error(function(error) {
      });
      })
    obj.error(function(error) {
    });
  };
  $scope.arqueologia=function(cas){
    console.log("IMPRESION ARQUEOLOGIA");
    var resDatos = {
      "table_name":"_fr_casos",
      "filter": "cas_id="+cas
    };
    var obj=DreamFactory.api[CONFIG.SERVICE].getRecordsByFilter(resDatos);
    obj.success(function (response) {
      $scope.datos=JSON.parse(response.record[0].cas_datos);
      var nro = $scope.datos.PTR_ARQ;
        $scope.ficha(cas,nro);
    });
    obj.error(function(error) {
    });  
  };
  $scope.monumento = function(idfrcasos){
    console.log("FICHA MONUMENTO");    
    var resDatos = {
      "table_name":"_fr_casos",
      "filter": "cas_id="+idfrcasos
    };
    var obj=DreamFactory.api[CONFIG.SERVICE].getRecordsByFilter(resDatos);
    obj.success(function (response) {
      $scope.datos=response.record[0].cas_nro_caso;
      var reslocal = {
        "procedure_name":"ejecutartojson",
        "body":{
          "params": [
          {
            "name":"expression",

            "param_type":"IN","value":"select doc_datos, doc_url_logica,doc_correlativo, doc_nombre from dms_gt_documentos where doc_proceso = '"+ $scope.procesonro+"' and doc_estado = 'A' and doc_id ="+$scope.datos+" "
          }
          ]
        }
      };
      var obj=DreamFactory.api[CONFIG.SERVICE].callStoredProcWithParams(reslocal);
      obj.success(function (respons) {
        $scope.url = JSON.parse(respons[0].ejecutartojson);
        var pic =[];
        var j=0;
        var k=0;
        var n= 4;
        pic[0] ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAFCAYAAACJmvbYAAAABHNCSVQICAgIfAhkiAAAABl0RVh0U29mdHdhcmUAZ25vbWUtc2NyZWVuc2hvdO8Dvz4AAAAVSURBVAiZY/z///9/BhyACZcEDSUBO0oEBrFgibAAAAAASUVORK5CYII=";
        pic[1] ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAFCAYAAACJmvbYAAAABHNCSVQICAgIfAhkiAAAABl0RVh0U29mdHdhcmUAZ25vbWUtc2NyZWVuc2hvdO8Dvz4AAAAVSURBVAiZY/z///9/BhyACZcEDSUBO0oEBrFgibAAAAAASUVORK5CYII=";
        pic[2] ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAFCAYAAACJmvbYAAAABHNCSVQICAgIfAhkiAAAABl0RVh0U29mdHdhcmUAZ25vbWUtc2NyZWVuc2hvdO8Dvz4AAAAVSURBVAiZY/z///9/BhyACZcEDSUBO0oEBrFgibAAAAAASUVORK5CYII=";
        pic[3] ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAFCAYAAACJmvbYAAAABHNCSVQICAgIfAhkiAAAABl0RVh0U29mdHdhcmUAZ25vbWUtc2NyZWVuc2hvdO8Dvz4AAAAVSURBVAiZY/z///9/BhyACZcEDSUBO0oEBrFgibAAAAAASUVORK5CYII=";
        console.log($scope.url);

        if($scope.url == null){
                $scope.fichamonumento2(idfrcasos,pic[0],pic[1],pic[2],pic[3])           
        } else {
          for(var i=0;i<$scope.url.length ;i++){
            var a = $scope.url[i].doc_nombre;
            var imga = $scope.url[i].doc_url_logica;          
            imga = imga.replace(/Ñ/gi,"%d1");
            imga = imga.replace(/ñ/gi,"%f1");
            imga = imga.replace(/Á/gi,"%c1");
            imga = imga.replace(/á/gi,"%e1");
            imga = imga.replace(/É/gi,"%c9");
            imga = imga.replace(/é/gi,"%e9");
            imga = imga.replace(/Í/gi,"%cd");
            imga = imga.replace(/í/gi,"%ed");
            imga = imga.replace(/Ó/gi,"%d3");
            imga = imga.replace(/ó/gi,"%f3");
            imga = imga.replace(/Ú/gi,"%da");
            imga = imga.replace(/ú/gi,"%fa");
            imga = imga.replace(/ /gi,"%20");
            imga = imga.replace(/“/gi,"%93");
            imga = imga.replace(/”/gi,"%94");
            imga = imga.replace(/&/gi,"%26");
            imga = imga.replace(/\\/gi,"/");
            if($scope.url[i].doc_correlativo == 1){
              k++;
              var img = new Image();
              img.crossOrigin = 'Anonymous';
              img.src = imga;
              img.onload = function(){
                  var canvas = document.createElement('CANVAS');
                  var ctx = canvas.getContext('2d');
                  canvas.height = img.height;
                  canvas.width = img.width;
                  ctx.drawImage(img, 0, 0);
                  pic[0] = canvas.toDataURL("image/jpeg",0.5);
                j++;
                if(j == n ){
                  $scope.fichamonumento2(idfrcasos,pic[0],pic[1],pic[2],pic[3])
                }
              } 
              img.onerror = function(){
                sweet.show('Error de Carga de Imagen', a, 'error');
              }          
            } else if($scope.url[i].doc_correlativo == 2){
            k++;
            var img = new Image();
            img.crossOrigin = 'Anonymous';
            img.src = imga;
            img.onload = function(){
                var canvas = document.createElement('CANVAS');
                var ctx = canvas.getContext('2d');
                canvas.height = img.height;
                canvas.width = img.width;
                ctx.drawImage(img, 0, 0);
                pic[1] = canvas.toDataURL("image/jpeg",0.5);
              j++;
              if(j == n ){
                $scope.fichamonumento2(idfrcasos,pic[0],pic[1],pic[2],pic[3])
              }
            }
            img.onerror = function(){
              sweet.show('Error de Carga de Imagen', a, 'error');
            } 
          }else if($scope.url[i].doc_correlativo == 3){
            k++;
            var img = new Image();
            img.crossOrigin = 'Anonymous';
            img.src = imga;
            img.onload = function(){
                var canvas = document.createElement('CANVAS');
                var ctx = canvas.getContext('2d');
                canvas.height = img.height;
                canvas.width = img.width;
                ctx.drawImage(img, 0, 0);
                pic[2] = canvas.toDataURL("image/jpeg",0.5);
              j++;
              if(j == n ){
                $scope.fichamonumento2(idfrcasos,pic[0],pic[1],pic[2],pic[3])
              }
            }
          }else if($scope.url[i].doc_correlativo == 4){
            k++;
            var img = new Image();
            img.crossOrigin = 'Anonymous';
            img.src = imga;
            img.onload = function(){
                var canvas = document.createElement('CANVAS');
                var ctx = canvas.getContext('2d');
                canvas.height = img.height;
                canvas.width = img.width;
                ctx.drawImage(img, 0, 0);
                pic[3] = canvas.toDataURL("image/jpeg",0.5);
              j++;
              if(j == n ){
                $scope.fichamonumento2(idfrcasos,pic[0],pic[1],pic[2],pic[3])
              }
            }
            img.onerror = function(){
              sweet.show('Error de Carga de Imagen', a, 'error');
            } 
          }
          if($scope.url.length == i+1 && k==0){
            $scope.fichamonumento2(idfrcasos,pic[0],pic[1],pic[2],pic[3]);
          }
          if($scope.url.length == i+1){
            n=k;
          }
        };
      }
      })
      obj.error(function(error) {
        console.log(error);
      });
    })
    obj.error(function(error) {
      console.log(error);
    });
  };
  $scope.inmaterial = function(idfrcasos){
    console.log("FICHA INMATERIAL");
    var resDatos = {
      "table_name":"_fr_casos",
      "filter": "cas_id="+idfrcasos
    };
    var obj=DreamFactory.api[CONFIG.SERVICE].getRecordsByFilter(resDatos);
    obj.success(function (response) {
      $scope.datos = response.record[0].cas_nro_caso;
      $scope.dato = JSON.parse(response.record[0].cas_datos);
      var nro = $scope.dato.PTR_AREAS;
      if(nro == 8) {
        $scope.formlp(idfrcasos);
      } else { 
        var reslocal = {
          "procedure_name":"ejecutartojson",
          "body":{
            "params": [
            {
              "name":"expression",

              "param_type":"IN","value":"select doc_datos, doc_url_logica,doc_correlativo, doc_nombre from dms_gt_documentos where doc_proceso = '"+ $scope.procesonro+"' and doc_estado = 'A' and doc_id ="+$scope.datos+" "
            }]
          }
        };
        var obj=DreamFactory.api[CONFIG.SERVICE].callStoredProcWithParams(reslocal);
        obj.success(function (respons) {
          $scope.url = JSON.parse(respons[0].ejecutartojson);
          var pic =[];
          var j=0;
          var k=0;
          var text1 = " ";
          var text2 = " ";
          pic[0] ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAFCAYAAACJmvbYAAAABHNCSVQICAgIfAhkiAAAABl0RVh0U29mdHdhcmUAZ25vbWUtc2NyZWVuc2hvdO8Dvz4AAAAVSURBVAiZY/z///9/BhyACZcEDSUBO0oEBrFgibAAAAAASUVORK5CYII=";
          pic[1] ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAFCAYAAACJmvbYAAAABHNCSVQICAgIfAhkiAAAABl0RVh0U29mdHdhcmUAZ25vbWUtc2NyZWVuc2hvdO8Dvz4AAAAVSURBVAiZY/z///9/BhyACZcEDSUBO0oEBrFgibAAAAAASUVORK5CYII=";
          if($scope.url == null){
              $scope.categoria(idfrcasos,nro,pic[0],pic[1]);            
          }
          else{
          for(var i=0;i<$scope.url.length ;i++){
            var a = $scope.url[i].doc_nombre;
            var imga = $scope.url[i].doc_url_logica;
            imga = imga.replace(/Ñ/gi,"%d1");
            imga = imga.replace(/ñ/gi,"%f1");
            imga = imga.replace(/Á/gi,"%c1");
            imga = imga.replace(/á/gi,"%e1");
            imga = imga.replace(/É/gi,"%c9");
            imga = imga.replace(/é/gi,"%e9");
            imga = imga.replace(/Í/gi,"%cd");
            imga = imga.replace(/í/gi,"%ed");
            imga = imga.replace(/Ó/gi,"%d3");
            imga = imga.replace(/ó/gi,"%f3");
            imga = imga.replace(/Ú/gi,"%da");
            imga = imga.replace(/ú/gi,"%fa");
            imga = imga.replace(/ /gi,"%20");
            imga = imga.replace(/“/gi,"%93");
            imga = imga.replace(/”/gi,"%94");
            imga = imga.replace(/&/gi,"%26");
            imga = imga.replace(/\\/gi,"/");
            if($scope.url.length == i+1 && k==0){
              $scope.categoria(idfrcasos,nro,pic[0],pic[1]);
            }
            if($scope.url[i].doc_correlativo == 1){
              k++;
              var img = new Image();
              img.crossOrigin = 'Anonymous';
              img.src = imga;
              text1 = $scope.url[i].doc_datos;
              img.onload = function(){
                  var canvas = document.createElement('CANVAS');
                  var ctx = canvas.getContext('2d');
                  canvas.height = img.height;
                  canvas.width = img.width;
                  ctx.drawImage(img, 0, 0);
                  pic[0] = canvas.toDataURL("image/jpg",0.2);
                j++;
                if(j == 2 ){
                  $scope.categoria(idfrcasos,nro,pic[0],pic[1],text1,text2);
                }
              } 
              img.onerror = function(){
                sweet.show('Error de Carga de Imagen', a, 'error');
              }         
            }else if($scope.url[i].doc_correlativo == 2){
              k++;
              var img1 = new Image();
              img1.crossOrigin = 'Anonymous';
              img1.src = imga;
              text2 = $scope.url[i].doc_datos;
              img1.onload = function(){
                  var canvas = document.createElement('CANVAS');
                  var ctx = canvas.getContext('2d');
                  canvas.height = img1.height;
                  canvas.width = img1.width;
                  ctx.drawImage(img1, 0, 0);
                  pic[1] = canvas.toDataURL("image/jpg",0.2);
                j++;
                if(j == 2 ){
                  $scope.categoria(idfrcasos,nro,pic[0],pic[1],text1,text2);
                }
              }
              img1.onerror = function(){
                sweet.show('Error de Carga de Imagen', a, 'error');
              } 
            }
          }
          }
        });
        obj.error(function(error) {
          console.log(error);
        });
      }
    });
    obj.error(function(error) {
      console.log(error);
    });
  };
  $scope.conjunto=function(cod_idcaso){
    console.log("FICHA CONJUNTO");
    var resDatos = {
      "table_name":"_fr_casos",
      "filter": "cas_id="+cod_idcaso
    };
    var obj=DreamFactory.api[CONFIG.SERVICE].getRecordsByFilter(resDatos);
    obj.success(function (response) {
      $scope.datos=JSON.parse(response.record[0].cas_datos);
      var columns1 = [
      {title: "titulo", dataKey: "tit"},
      {title: "descripcion", dataKey: "des"}
      ];
      var data1 = [
      {"tit":"Nominación","des":$scope.datos.PTR_NOM},
      {"tit":"Ubicación","des":$scope.datos.PTR_UBIC},
      {"tit":"Protección Legal","des":$scope.datos.PTR_TIP_PROT+' '+$scope.datos.PTR_NRO_PROT},
      {"tit":"Número Total de Inmuebles Tramo","des":$scope.datos.PTR_NUM_INM},
      {"tit":"Número Total de Inmuebles Patrimoniales","des":$scope.datos.PTR_NUM_PAT}
      ];
      var columns = [
      {title: "titulo", dataKey: "tit"},
      {title: "descripcion", dataKey: "des"}
      ];
      var data = [
      {"tit":"Indicador Urbano","des":$scope.datos.PTR_IND_URB},
      {"tit":"Indicador Artístico","des":$scope.datos.PTR_IND_ART},
      {"tit":"Indicador Tipológico","des":$scope.datos.PTR_IND_TIP},
      {"tit":"Indicador Tecnológico","des":$scope.datos.PTR_IND_TEC},
      {"tit":"Indicador de Integridad","des":$scope.datos.PTR_IND_INT},
      {"tit":"Indicador Histórico Cultural","des":$scope.datos.PTR_IND_HIST},
      {"tit":"Indicador Simbólico","des":$scope.datos.PTR_IND_SIMB},
      {"tit":"Nombre de la Vía","des":$scope.datos.PTR_NOM_VIA},
      {"tit":"Material de la Vía","des":$scope.datos.PTR_MAT_VIA},
      {"tit":"Clasificación","des":$scope.datos.PTR_CLASS},
      {"tit":"Entre Calles","des":$scope.datos.PTR_ENT_CALL}
      ];
      var colcantidad = [
      {title: "Inmuebles por Categoría y Condición de Protección", dataKey: "uno"},
      {title: "C/ Protección", dataKey: "dos"},
      {title: "S/ Protección", dataKey: "tres"},
      {title: "Total", dataKey: "cuatro"}
      ];
      var datacantidad=[];
      for (var i=1; i<$scope.datos.PTR_CANT_INM.length;i++){
        var aporte = {"uno":$scope.datos.PTR_CANT_INM[i].imn_cat ,"dos":$scope.datos.PTR_CANT_INM[i].inm_prot,"tres":$scope.datos.PTR_CANT_INM[i].inm_des,"cuatro":$scope.datos.PTR_CANT_INM[i].inm_total};          
        datacantidad[i]=aporte;      
      }
      var doc = new jsPDF('p', 'pt');
      var header = function (data) {
        doc.addImage(material,'JPEG', 35, 40, 525, 60);
        doc.setTextColor(0);
        doc.setFontStyle('bold');
        doc.setFontSize(9);
        doc.text('FICHA DE CATALOGACIÓN DE MUEBLES ARQUEOLOGICOS',40,120);
        doc.text('NRO. FICHA: ',400,120);
        doc.setFontStyle('normal');
        doc.text($scope.datos.PTR_COD_CONJ,470,120);
        doc.rect(390, 105, 170, 25);
         };
      var totalPagesExp = "{total_pages_count_string}";
      var footer = function (data) {
        var str = "Página " + data.pageCount;
        if (typeof doc.putTotalPages === 'function') {
          str = str + " de " + totalPagesExp;
        }
        doc.text(str, 40, doc.internal.pageSize.height - 30);
        doc.text("Para cualquier consulta, por favor comunicarse al Telefono. 2-2440746", 40, doc.internal.pageSize.height - 45);
      };
      doc.setFontStyle('bold');
      doc.setFontSize(8);
      doc.text("DATOS GENERALES DEL CONJUNTO ", 40, 130);
      doc.autoTable(columns1.splice(0,2), data1, {drawHeaderRow: function() {return false;},startY: 140,pageBreak: 'auto',theme: 'plain',beforePageContent: header,afterPageContent: footer,bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 50, top: 130, bottom: 70},styles: {overflow: 'linebreak'},columnStyles: {tit: {columnWidth: 170,fontStyle: 'bold'}},drawRow: function (row, data) {doc.setFontStyle('bold'); doc.setFontSize(8);
        if (row.index === 2) {
          doc.autoTableText("PROTECCIÓN LEGAL", 40, row.y + row.height / 2, {
            halign: 'left',
            valign: 'botton'
          });
          data.cursor.y += 20;
        } else if (row.index === 3) {
          doc.autoTableText("INFORMACIÓN CUANTITATIVA DEL TRAMO", 40, row.y + row.height / 2, {
            halign: 'left',
            valign: 'botton'
          });
          data.cursor.y += 20;
        }
      }
    });  doc.autoTable(colcantidad, datacantidad,{startY: doc.autoTableEndPosY() +5,pageBreak: 'auto',theme: 'grid',bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},headerStyles: {fontStyle: 'bold', rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 50, top: 110, bottom: 75},styles: {overflow: 'linebreak'}});
      doc.setFontStyle('bold');

      doc.setFontSize(8);
      doc.text("INFORMACIÓN CUALITATIVA DEL CONJUNTO", 40, doc.autoTableEndPosY()+20);
      doc.autoTable(columns.splice(0,2),data,{drawHeaderRow:function(){return false;},startY:doc.autoTableEndPosY()+25,pageBreak:'auto',theme:'plain',bodyStyles:{rowHeight:12,fontSize:8,valign:'top'},beforePageContent:header,afterPageContent:footer,margin:{horizontal:50,top:130,bottom:80},styles:{overflow:'linebreak'},columnStyles:{tit:{columnWidth:140,fontStyle:'bold'}},drawRow: function (row, data) {doc.setFontStyle('bold'); doc.setFontSize(8);
        if (row.index === 7) {
          doc.autoTableText("IDENTIFICACIÓN DE TRAMOS", 40, row.y + row.height / 2, {
            halign: 'left',
            valign: 'botton'
          });
          data.cursor.y += 20;
      }}});
      if (typeof doc.putTotalPages === 'function') {
        doc.putTotalPages(totalPagesExp);
      }
      //doc.save('conjunto'+'.pdf');
        $('#visorFumm object').attr('data',doc.output('datauristring'));
        $("#divPopup8").modal('show');
        //window.open(doc.output('datauristring'));
    })
    obj.error(function(error) {
    });
  };
  $scope.espacioabierto=function(cas_id){
    console.log("FICHA ESPACIO ABIERTO");
    var resDatos = {
      "table_name":"_fr_casos",
      "filter": "cas_id="+cas_id
    };
    var obj=DreamFactory.api[CONFIG.SERVICE].getRecordsByFilter(resDatos);
    obj.success(function (response) {
      $scope.datos=response.record[0].cas_nro_caso;
      var reslocal = {
        "procedure_name":"ejecutartojson",
        "body":{
          "params": [
          {
            "name":"expression",

            "param_type":"IN","value":"select doc_url_logica,doc_correlativo, doc_nombre from dms_gt_documentos where doc_proceso = '"+ $scope.procesonro+"' and doc_estado = 'A' and doc_id ="+$scope.datos
          }]
        }
      };
      var obj=DreamFactory.api[CONFIG.SERVICE].callStoredProcWithParams(reslocal);
      obj.success(function (respons) {
        $scope.url = JSON.parse(respons[0].ejecutartojson);
        var pic =[];
        var j=0;
        var k=0;
        var n = 3;
        pic[0] ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAFCAYAAACJmvbYAAAABHNCSVQICAgIfAhkiAAAABl0RVh0U29mdHdhcmUAZ25vbWUtc2NyZWVuc2hvdO8Dvz4AAAAVSURBVAiZY/z///9/BhyACZcEDSUBO0oEBrFgibAAAAAASUVORK5CYII=";
        pic[1] ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAFCAYAAACJmvbYAAAABHNCSVQICAgIfAhkiAAAABl0RVh0U29mdHdhcmUAZ25vbWUtc2NyZWVuc2hvdO8Dvz4AAAAVSURBVAiZY/z///9/BhyACZcEDSUBO0oEBrFgibAAAAAASUVORK5CYII=";
        pic[2] ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAFCAYAAACJmvbYAAAABHNCSVQICAgIfAhkiAAAABl0RVh0U29mdHdhcmUAZ25vbWUtc2NyZWVuc2hvdO8Dvz4AAAAVSURBVAiZY/z///9/BhyACZcEDSUBO0oEBrFgibAAAAAASUVORK5CYII=";
        if($scope.url == null){
                $scope.espacios(cas_id,pic);           
          }
          else{
        for(var i=0;i<$scope.url.length ;i++){
          var a = $scope.url[i].doc_nombre;
          var imga = $scope.url[i].doc_url_logica;
          console.log($scope.url[i]);
          imga = imga.replace(/Ñ/gi,"%d1");
          imga = imga.replace(/ñ/gi,"%f1");
          imga = imga.replace(/Á/gi,"%c1");
          imga = imga.replace(/á/gi,"%e1");
          imga = imga.replace(/É/gi,"%c9");
          imga = imga.replace(/é/gi,"%e9");
          imga = imga.replace(/Í/gi,"%cd");
          imga = imga.replace(/í/gi,"%ed");
          imga = imga.replace(/Ó/gi,"%d3");
          imga = imga.replace(/ó/gi,"%f3");
          imga = imga.replace(/Ú/gi,"%da");
          imga = imga.replace(/ú/gi,"%fa");
          imga = imga.replace(/ /gi,"%20");
          imga = imga.replace(/“/gi,"%93");
          imga = imga.replace(/”/gi,"%94");
          imga = imga.replace(/&/gi,"%26");
          imga = imga.replace(/\\/gi,"/");
          if($scope.url[i].doc_correlativo == 1){
            k++;
            var img = new Image();
            img.crossOrigin = 'Anonymous';
            img.src = imga;
            img.onload = function(){
                var canvas = document.createElement('CANVAS');
                var ctx = canvas.getContext('2d');
                canvas.height = img.height;
                canvas.width = img.width;
                ctx.drawImage(img, 0, 0);
                pic[0] = canvas.toDataURL("image/jpeg",0.2);
              j++;
              if(j == n ){
                $scope.espacios(cas_id,pic);
              }
            }
            img.onerror = function(){
              sweet.show('Error de Carga de Imagen', a, 'error');
            } 
          }else if($scope.url[i].doc_correlativo == 2){
            k++;
            var img = new Image();
            img.crossOrigin = 'Anonymous';
            img.src = imga;
            img.onload = function(){
                var canvas = document.createElement('CANVAS');
                var ctx = canvas.getContext('2d');
                canvas.height = img.height;
                canvas.width = img.width;
                ctx.drawImage(img, 0, 0);
                pic[1] = canvas.toDataURL("image/jpeg",0.2);
              j++;
              if(j == n ){
                $scope.espacios(cas_id,pic);
              }
            }
            img.onerror = function(){
              sweet.show('Error de Carga de Imagen', a, 'error');
            } 
          }else if($scope.url[i].doc_correlativo == 3){
            k++;
            var img = new Image();
            img.crossOrigin = 'Anonymous';
            img.src = imga;
            img.onload = function(){
                var canvas = document.createElement('CANVAS');
                var ctx = canvas.getContext('2d');
                canvas.height = img.height;
                canvas.width = img.width;
                ctx.drawImage(img, 0, 0);
                pic[2] = canvas.toDataURL("image/jpeg",0.2);
              j++;
              if(j == n ){
                $scope.espacios(cas_id,pic);
              }
            }
            img.onerror = function(){
              sweet.show('Error de Carga de Imagen', a, 'error');
            } 
          }
          if($scope.url.length == i+1 && k==0){
                $scope.archivofotografico(pic,nom,ficha,titulo);
          }

          if($scope.url.length == i+1){
            n=k;
          }
        }
      }
      });
      obj.error(function(error) {
      });
    });
    obj.error(function(error) {
    });
  };
  $scope.impresion = function(casos){
    var idfrcasos = casos.casoid; 
    console.log($scope.procesonro , "IMPRESION",casos);
    var nombre = casos.casonombre;
    var tipo = nombre.substring(0,7);
    console.log(tipo);
    if(tipo == 'PTR_CBI'){
        $scope.inmueble(idfrcasos);
    }else if(tipo == 'PTR_BMA'){
        $scope.arqueologia(idfrcasos);
    }else if(tipo == 'PTR_IME'){
        $scope.monumento(idfrcasos);
    }else if(tipo == 'PTR-PCI'){
        $scope.inmaterial(idfrcasos);
    }else if(tipo == 'PTR-CON'){
        $scope.conjunto(idfrcasos);
    }else if(tipo == 'PTR-ESP'){
        $scope.espacioabierto(idfrcasos);
    }
  }
  
  $scope.generarDocumentoPhp = function (nros){  
    console.log($scope.sIdProcesoActual);             
    var idCasoActual    =   $scope.casoActual.casoid;
    var idActividadActual    =   $scope.casoActual.casoactid;
    var nombre_nrocaso         =   $scope.casoActual.casonro;
       
                
    if(nros>0 && nros <6){
    $scope.fotos(idCasoActual, nros);
    }else if (nros === 6){
      $scope.fotografiaimp(idCasoActual,$scope.casoActual.casonombre);
    }
    else{
      $scope.impresion($scope.casoActual);
    }
  };

  $scope.bloque = function(casid){
    $scope.casoid=casid;
    $scope.panelbuscador=false;
    $scope.bloques=true;
    var resDatos = {
      "table_name":"_fr_casos",
      "filter": "cas_id="+casid
    };
    var obj=DreamFactory.api[CONFIG.SERVICE].getRecordsByFilter(resDatos);
    obj.success(function (response) {
      $scope.datos=JSON.parse(response.record[0].cas_datos);
      var nro = $scope.datos.PTR_BLOQ_INV;
      switch (nro) {
        case '1':
        $scope.bloq=true;
        $scope.bloq1=true;
        $scope.NombreBloque1=$scope.datos.PTR_DES_BLOQ1;
        $scope.bloq2=false;
        $scope.bloq3=false;
        $scope.bloq4=false;
        $scope.bloq5=false;
        break;
        case '2':
        $scope.bloq=true;
        $scope.bloq1=true;
        $scope.bloq2=true;
        $scope.NombreBloque1=$scope.datos.PTR_DES_BLOQ1;
        $scope.NombreBloque2=$scope.datos.PTR_DES_BLOQ2;
        $scope.bloq3=false;
        $scope.bloq4=false;
        $scope.bloq5=false;
        break;
        case '3':
        $scope.bloq=true;
        $scope.bloq1=true;
        $scope.bloq2=true;
        $scope.bloq3=true;
        $scope.NombreBloque1=$scope.datos.PTR_DES_BLOQ1;
        $scope.NombreBloque2=$scope.datos.PTR_DES_BLOQ2;
        $scope.NombreBloque3=$scope.datos.PTR_DES_BLOQ3;      
        $scope.bloq4=false;
        $scope.bloq5=false;
        break;
        case '4':
        $scope.bloq=true;
        $scope.bloq1=true;
        $scope.bloq2=true;
        $scope.bloq3=true;
        $scope.bloq4=true;
        $scope.NombreBloque1=$scope.datos.PTR_DES_BLOQ1;
        $scope.NombreBloque2=$scope.datos.PTR_DES_BLOQ2;
        $scope.NombreBloque3=$scope.datos.PTR_DES_BLOQ3;      
        $scope.NombreBloque4=$scope.datos.PTR_DES_BLOQ4;      
        $scope.bloq5=false;
        break;
        case '5':
        $scope.bloq=true;
        $scope.bloq1=true;
        $scope.bloq2=true;
        $scope.bloq3=true;
        $scope.bloq4=true;
        $scope.bloq5=true;
        $scope.NombreBloque1=$scope.datos.PTR_DES_BLOQ1;
        $scope.NombreBloque2=$scope.datos.PTR_DES_BLOQ2;
        $scope.NombreBloque3=$scope.datos.PTR_DES_BLOQ3;     
        $scope.NombreBloque4=$scope.datos.PTR_DES_BLOQ4;     
        $scope.NombreBloque5=$scope.datos.PTR_DES_BLOQ5;
        break;
        default:
        $scope.bloq=true;
        $scope.bloq1=false;
        $scope.bloq2=false;
        $scope.bloq3=false;
        $scope.bloq4=false;
        $scope.bloq5=false;
      }
    });
    obj.error(function(error) {
    });
  }; 
  
    
  $scope.fotos = function(idfrcasos,nro) {
    $.blockUI();  
    var resDatos = {
      "table_name":"_fr_casos",
      "filter": "cas_id="+idfrcasos
    };
    var obj=DreamFactory.api[CONFIG.SERVICE].getRecordsByFilter(resDatos);
    obj.success(function (response) {
      $scope.datos=JSON.parse(response.record[0].cas_datos);
      var doc = new jsPDF('p', 'pt');
      var htmlOb = document.createElement('div');
      htmlOb.innerHTML = $scope.datos.PTR_VAL_TEC_DESC1;
      var htmlObj = document.createElement('div');
      htmlObj.innerHTML = $scope.datos.PTR_VAL_HIS_DESC1;
      var htmlObje = document.createElement('div');
      htmlObje.innerHTML = $scope.datos.PTR_VAL_ART_DESC1;
      var htmlObjet = document.createElement('div');
      htmlObjet.innerHTML = $scope.datos.PTR_VAL_ARQ_DESC1;
      var inte1 = document.createElement('div');
      inte1.innerHTML = $scope.datos.PTR_VAL_INTE_DESC1;
      var urb1 = document.createElement('div');
      urb1.innerHTML = $scope.datos.PTR_VAL_URB_DESC1;
      var inmat1 = document.createElement('div');
      inmat1.innerHTML = $scope.datos.PTR_VAL_INMAT_DESC1;
      var simb1 = document.createElement('div');
      simb1.innerHTML = $scope.datos.PTR_VAL_SIMB_DESC1;      
      var tec2 = document.createElement('div');
      tec2.innerHTML = $scope.datos.PTR_VAL_TEC_DESC2;
      var his2 = document.createElement('div');
      his2.innerHTML = $scope.datos.PTR_VAL_HIS_DESC2;
      var art2 = document.createElement('div');
      art2.innerHTML = $scope.datos.PTR_VAL_ART_DESC2;
      var arq2 = document.createElement('div');
      arq2.innerHTML = $scope.datos.PTR_VAL_ARQ_DESC2;
      var inte2 = document.createElement('div');
      inte2.innerHTML = $scope.datos.PTR_VAL_INTE_DESC2;
      var urb2 = document.createElement('div');
      urb2.innerHTML = $scope.datos.PTR_VAL_URB_DESC2;
      var inmat2 = document.createElement('div');
      inmat2.innerHTML = $scope.datos.PTR_VAL_INMAT_DESC2;
      var simb2 = document.createElement('div');
      simb2.innerHTML = $scope.datos.PTR_VAL_SIMB_DESC2; 
      var tec3 = document.createElement('div');
      tec3.innerHTML = $scope.datos.PTR_VAL_TEC_DESC3;
      var his3 = document.createElement('div');
      his3.innerHTML = $scope.datos.PTR_VAL_HIS_DESC3;
      var art3 = document.createElement('div');
      art3.innerHTML = $scope.datos.PTR_VAL_ART_DESC3;
      var arq3 = document.createElement('div');
      arq3.innerHTML = $scope.datos.PTR_VAL_ARQ_DESC3;
      var inte3 = document.createElement('div');
      inte3.innerHTML = $scope.datos.PTR_VAL_INTE_DESC3;
      var urb3 = document.createElement('div');
      urb3.innerHTML = $scope.datos.PTR_VAL_URB_DESC3;
      var inmat3 = document.createElement('div');
      inmat3.innerHTML = $scope.datos.PTR_VAL_INMAT_DESC3;
      var simb3 = document.createElement('div');
      simb3.innerHTML = $scope.datos.PTR_VAL_SIMB_DESC3;
      var tec4 = document.createElement('div');
      tec4.innerHTML = $scope.datos.PTR_VAL_TEC_DESC4;
      var his4 = document.createElement('div');
      his4.innerHTML = $scope.datos.PTR_VAL_HIS_DESC4;
      var art4 = document.createElement('div');
      art4.innerHTML = $scope.datos.PTR_VAL_ART_DESC4;
      var arq4 = document.createElement('div');
      arq4.innerHTML = $scope.datos.PTR_VAL_ARQ_DESC4;
      var inte4 = document.createElement('div');
      inte4.innerHTML = $scope.datos.PTR_VAL_INTE_DESC4;
      var urb4 = document.createElement('div');
      urb4.innerHTML = $scope.datos.PTR_VAL_URB_DESC4;
      var inmat4 = document.createElement('div');
      inmat4.innerHTML = $scope.datos.PTR_VAL_INMAT_DESC4;
      var simb4 = document.createElement('div');
      simb4.innerHTML = $scope.datos.PTR_VAL_SIMB_DESC4;
      var tec5 = document.createElement('div');
      tec5.innerHTML = $scope.datos.PTR_VAL_TEC_DESC5;
      var his5 = document.createElement('div');
      his5.innerHTML = $scope.datos.PTR_VAL_HIS_DESC5;
      var art5 = document.createElement('div');
      art5.innerHTML = $scope.datos.PTR_VAL_ART_DESC5;
      var arq5 = document.createElement('div');
      arq5.innerHTML = $scope.datos.PTR_VAL_ARQ_DESC5;
      var inte5 = document.createElement('div');
      inte5.innerHTML = $scope.datos.PTR_VAL_INTE_DESC5;
      var urb5 = document.createElement('div');
      urb5.innerHTML = $scope.datos.PTR_VAL_URB_DESC5;
      var inmat5 = document.createElement('div');
      inmat5.innerHTML = $scope.datos.PTR_VAL_INMAT_DESC5;
      var simb5 = document.createElement('div');
      simb5.innerHTML = $scope.datos.PTR_VAL_SIMB_DESC5;
      if(nro==1){
        var colbloque = [
        {title: "primero", dataKey: "one"},
        {title: "segundo", dataKey: "two"},
        {title: "tercero", dataKey: "three"},
        {title: "cuarto", dataKey: "for"},
        {title: "quinto", dataKey: "five"},
        {title: "sexto", dataKey: "six"}
        ];
        var databloque = [
        {"one":"Estilo del Bloque:","two":$scope.datos.PTR_EST_BLOQ1.toUpperCase(),"three":"Rango Época Bloque:","for":$scope.datos.PTR_RANG_EPO1.toUpperCase(),"five":"Sistema Constructivo:","six":$scope.datos.PTR_SIS_CONSTRUC1.toUpperCase()}
        ];
        var colvaloracion = [
        {title: "primero", dataKey: "prim"}
        ];
        var dataval = [
        {"prim":htmlObj.innerText.toUpperCase()},
        {"prim":htmlObje.innerText.toUpperCase()},
        {"prim":htmlObjet.innerText.toUpperCase()},
        {"prim":htmlOb.innerText.toUpperCase()},
        {"prim":inte1.innerText.toUpperCase()},
        {"prim":urb1.innerText.toUpperCase()},
        {"prim":inmat1.innerText.toUpperCase()},
        {"prim":simb1.innerText.toUpperCase()}
        ];
      }
      if(nro===2){
        var colbloque = [
        {title: "primero", dataKey: "one"},
        {title: "segundo", dataKey: "two"},
        {title: "tercero", dataKey: "three"},
        {title: "cuarto", dataKey: "for"},
        {title: "quinto", dataKey: "five"},
        {title: "sexto", dataKey: "six"}
        ];
        var databloque = [
        {"one":"Estilo del Bloque:","two":$scope.datos.PTR_EST_BLOQ2.toUpperCase(),"three":"Rango Época Bloque:","for":$scope.datos.PTR_RANG_EPO2.toUpperCase(),"five":"Sistema Constructivo:","six":$scope.datos.PTR_SIS_CONSTRUC2.toUpperCase()}
        ];
        var colvaloracion = [
        {title: "primero", dataKey: "prim"}
        ];
        var dataval = [
        {"prim":his2.innerText.toUpperCase()},
        {"prim":art2.innerText.toUpperCase()},
        {"prim":arq2.innerText.toUpperCase()},
        {"prim":tec2.innerText.toUpperCase()},
        {"prim":inte2.innerText.toUpperCase()},
        {"prim":urb2.innerText.toUpperCase()},
        {"prim":inmat2.innerText.toUpperCase()},
        {"prim":simb2.innerText.toUpperCase()}
        ];
      }
      if(nro===3){
        var colbloque = [
        {title: "primero", dataKey: "one"},
        {title: "segundo", dataKey: "two"},
        {title: "tercero", dataKey: "three"},
        {title: "cuarto", dataKey: "for"},
        {title: "quinto", dataKey: "five"},
        {title: "sexto", dataKey: "six"}
        ];
        var databloque = [
        {"one":"Estilo del Bloque:","two":$scope.datos.PTR_EST_BLOQ3.toUpperCase(),"three":"Rango Época Bloque:","for":$scope.datos.PTR_RANG_EPO3.toUpperCase(),"five":"Sistema Constructivo:","six":$scope.datos.PTR_SIS_CONSTRUC3.toUpperCase()}
        ];
        var colvaloracion = [
        {title: "primero", dataKey: "prim"}
        ];
        var dataval = [
        {"prim":his3.innerText},
        {"prim":art3.innerText},
        {"prim":arq3.innerText},
        {"prim":tec3.innerText},
        {"prim":inte3.innerText},
        {"prim":urb3.innerText},
        {"prim":inmat3.innerText},
        {"prim":simb3.innerText}
        ];
      }
      var nombre = '';
      switch (nro) {
        case 1:
        $scope.datos.PTR_CATEGORIA = $scope.datos.PTR_CATEGORIA1;
        nombre=$scope.datos.PTR_DES_BLOQ1.toUpperCase();
        nombre = doc.splitTextToSize(nombre,700,{halign: 'center',valign: 'middle'});
        break;
        case 2:
        $scope.datos.PTR_CATEGORIA = $scope.datos.PTR_CATEGORIA2;
        nombre=$scope.datos.PTR_DES_BLOQ2.toUpperCase();
        nombre = doc.splitTextToSize(nombre,700,{halign: 'center',valign: 'middle'});
        break;
        case 3:
        $scope.datos.PTR_CATEGORIA = $scope.datos.PTR_CATEGORIA3;
        nombre=$scope.datos.PTR_DES_BLOQ3.toUpperCase();
        nombre = doc.splitTextToSize(nombre,700,{halign: 'center',valign: 'middle'});
        break;
        case 4:
        $scope.datos.PTR_CATEGORIA = $scope.datos.PTR_CATEGORIA4;
        nombre=$scope.datos.PTR_DES_BLOQ4.toUpperCase();
        nombre = doc.splitTextToSize(nombre,700,{halign: 'center',valign: 'middle'});
        break;
        case 5:
        $scope.datos.PTR_CATEGORIA = $scope.datos.PTR_CATEGORIA5;
        nombre=$scope.datos.PTR_DES_BLOQ5.toUpperCase();
        nombre = doc.splitTextToSize(nombre,700,{halign: 'center',valign: 'middle'});
        break;
        default:
        nombre=' ';
      }
      if(nro===4){
        var colbloque = [
        {title: "primero", dataKey: "one"},
        {title: "segundo", dataKey: "two"},
        {title: "tercero", dataKey: "three"},
        {title: "cuarto", dataKey: "for"},
        {title: "quinto", dataKey: "five"},
        {title: "sexto", dataKey: "six"}
        ];
        var databloque = [
        {"one":"Estilo del Bloque:","two":$scope.datos.PTR_EST_BLOQ4.toUpperCase(),"three":"Rango Época Bloque:","for":$scope.datos.PTR_RANG_EPO4.toUpperCase(),"five":"Sistema Constructivo:","six":$scope.datos.PTR_SIS_CONSTRUC4.toUpperCase()}
        ];

        var colvaloracion = [
        {title: "primero", dataKey: "prim"}
        ];
        var dataval = [
        {"prim":his4.innerText.toUpperCase()},
        {"prim":art4.innerText.toUpperCase()},
        {"prim":arq4.innerText.toUpperCase()},
        {"prim":tec4.innerText.toUpperCase()},
        {"prim":inte4.innerText.toUpperCase()},
        {"prim":urb4.innerText.toUpperCase()},
        {"prim":inmat4.innerText.toUpperCase()},
        {"prim":simb4.innerText.toUpperCase()}
        ];
      }
      if(nro===5){

        var colbloque = [
        {title: "primero", dataKey: "one"},
        {title: "segundo", dataKey: "two"},
        {title: "tercero", dataKey: "three"},
        {title: "cuarto", dataKey: "for"},
        {title: "quinto", dataKey: "five"},
        {title: "sexto", dataKey: "six"}
        ];
        var databloque = [
        {"one":"Estilo del Bloque:","two":$scope.datos.PTR_EST_BLOQ5.toUpperCase(),"three":"Rango Época Bloque:","for":$scope.datos.PTR_RANG_EPO5.toUpperCase(),"five":"Sistema Constructivo:","six":$scope.datos.PTR_SIS_CONSTRUC5.toUpperCase()}
        ];

        var colvaloracion = [
        {title: "primero", dataKey: "prim"}
        ];
        var dataval = [
        {"prim":his5.innerText.toUpperCase()},
        {"prim":art5.innerText.toUpperCase()},
        {"prim":arq5.innerText.toUpperCase()},
        {"prim":tec5.innerText.toUpperCase()},
        {"prim":inte5.innerText.toUpperCase()},
        {"prim":urb5.innerText.toUpperCase()},
        {"prim":inmat5.innerText.toUpperCase()},
        {"prim":simb5.innerText.toUpperCase()}
        ];
      }
      var header = function (data) {
        doc.addImage(material,'JPEG', 35, 40, 525, 60);
        doc.setTextColor(0);
        doc.setFontStyle('bold');
        doc.setFontSize(9);
        doc.text('FICHA DE CATALOGACIÓN DE BIENES INMUEBLES',40,120);
        doc.text('CATEGORIA: ',400,120);
        doc.text('NRO. FICHA: ',400,135);
        doc.setFontStyle('normal');
        doc.text($scope.datos.PTR_CATEGORIA,470,120);
        doc.text($scope.datos.PTR_NUM_FIC,470,135);
        doc.rect(390, 105, 170, 35);
      };
      var totalPagesExp = "{total_pages_count_string}";
      var footer = function (data) {
        var str = "Página " + data.pageCount;
        if (typeof doc.putTotalPages === 'function') {
          str = str + " de " + totalPagesExp;
        }
        doc.text("Para cualquier consulta, por favor comunicarse al Telefono. 2-2440746 ", 40,  doc.internal.pageSize.height - 40);
        doc.text(str, 470,  doc.internal.pageSize.height - 40);
      };
      doc.setFontSize(9);
      if($scope.datos.PTR_CATEGORIA===undefined){
        $scope.datos.PTR_CATEGORIA=" ";
      }
      if(nro>=1){
        doc.setFontSize(9);
        doc.setFontStyle('bold');
        doc.text('INFORMACIÓN POR BLOQUE:',40,135);
        doc.setFontSize(8);
        doc.text('DESCRIPCIÓN DEL BLOQUE:',60,150);
        doc.text('BLOQUES INVENTARIADOS:',60,185);
        doc.setFontStyle('normal');
        doc.text(nombre,200,150);
        doc.text($scope.datos.PTR_BLOQ_INV,200,185);
        doc.setFontSize(8);
        doc.text('BLOQUE NÚMERO:  '+nro,60,205);
        doc.autoTable(colbloque.splice(0,6), databloque, {drawHeaderRow: function() {return false;},startY: 210,pageBreak: 'auto',theme: 'plain',bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 55, top: 140, bottom: 80},styles: {overflow: 'linebreak'},columnStyles: {one: {columnWidth: 90,fontStyle: 'bold'},two: {columnWidth: 85},three: {columnWidth: 90,fontStyle: 'bold'},for: {columnWidth: 70},five: {columnWidth: 90,fontStyle: 'bold'},six: {columnWidth: 85}}});
        doc.rect(40, doc.autoTableEndPosY() -25, 525, 25);
        doc.setFontSize(9);
        doc.setFontStyle('bold');
        doc.text('VALORACIÓN:',40,doc.autoTableEndPosY() +20);
        doc.setFontSize(9);
        doc.autoTable(colvaloracion.splice(0,2), dataval, {drawHeaderRow: function() {return false;},   startY: doc.autoTableEndPosY()+30,pageBreak: 'auto',theme: 'plain',bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},beforePageContent: header,afterPageContent: footer,margin: {horizontal: 50, top: 130, bottom: 80},styles: {overflow: 'linebreak'},columnStyles: {tit: {columnWidth: 140,fontStyle: 'bold'}},drawRow: function (row, data) {doc.setFontStyle('bold'); doc.setFontSize(8);
          if (row.index === 0) {
            doc.autoTableText("INDICADOR HISTÓRICO CULTURAL", 40, row.y + 5, {
              halign: 'left',
              valign: 'botton'
            });
            data.cursor.y += 20;
          } else if (row.index === 1) {
            doc.setTextColor(0);
            doc.autoTableText("INDICADOR ARTÍSTICO" , 40, row.y + 10, {
              halign: 'left',
              valign: 'botton'
            });
            data.cursor.y += 20;
          }  else if (row.index === 2) {
            doc.setTextColor(0);
            doc.autoTableText("INDICADOR TIPOLÓGICO" , 40, row.y + 10, {
              halign: 'left',
              valign: 'botton'
            });
            data.cursor.y += 20;
          }else if (row.index === 3) {
            doc.setTextColor(0);
            doc.autoTableText("INDICADOR TECNOLÓGICO" , 40, row.y + 10, {
              halign: 'left',
              valign: 'botton'
            });
            data.cursor.y += 20;
          }else if (row.index === 4) {
            doc.setTextColor(0);
            doc.autoTableText("INDICADOR DE INTEGRIDAD" , 40, row.y + 10, {
              halign: 'left',
              valign: 'botton'
            });
            data.cursor.y += 20;
          }else if (row.index === 5) {
            doc.setTextColor(0);
            doc.autoTableText("INDICADOR URBANO" , 40, row.y + 10, {
              halign: 'left',
              valign: 'botton'
            });
            data.cursor.y += 20;
          }else if (row.index === 6) {
            doc.setTextColor(0);
            doc.autoTableText("INDICADOR INMATERIAL" , 40, row.y + 10, {
              halign: 'left',
              valign: 'botton'
            });
            data.cursor.y += 20;
          }else if (row.index === 7) {
            doc.setTextColor(0);
            doc.autoTableText("INDICADOR SIMBÓLICO" , 40, row.y + 10, {
              halign: 'left',
              valign: 'botton'
            });
            data.cursor.y += 20;
          }}});
      }
      if (typeof doc.putTotalPages === 'function') {
        doc.putTotalPages(totalPagesExp);
      }
      $.unblockUI();
      //doc.save('inmueble'+'.pdf');

        $('#visorFumm object').attr('data',doc.output('datauristring'));
        $("#divPopup8").modal('show');
        //window.open(doc.output('datauristring'));
    });
    obj.error(function(error) {
    });
  };
  $scope.fichainmueble = function(frcasos,pic,nro,nom){
    console.log("FICHA INMUEBLE");
    var resDatos = {
      "table_name":"_fr_casos",
      "filter": "cas_id="+frcasos
    };
    var obj=DreamFactory.api[CONFIG.SERVICE].getRecordsByFilter(resDatos);
    obj.success(function (response) {
      $scope.datos=JSON.parse(response.record[0].cas_datos);
      var doc = new jsPDF('p', 'pt');
      var tradicional='';
      for(var i=1; i<$scope.datos.PTR_USO_TRAD.length;i++){
        if($scope.datos.PTR_USO_TRAD[i].estado){
          if(tradicional!=''){
            tradicional=tradicional+', '+$scope.datos.PTR_USO_TRAD[i].resvalor;
          }
          else{
            tradicional=tradicional+$scope.datos.PTR_USO_TRAD[i].resvalor;
          }
        }
      }
      var actual='';
      for(var i=1; i<$scope.datos.PTR_USO_ACT.length;i++){
        if($scope.datos.PTR_USO_ACT[i].estado){
          if(actual!=''){
            actual=actual+', '+$scope.datos.PTR_USO_ACT[i].resvalor;
          }
          else{
            actual = actual + $scope.datos.PTR_USO_ACT[i].resvalor;
          }
        }
      }
      var columns = [
      {title: "primero", dataKey: "prim"},
      {title: "segundo", dataKey: "seg"}
      ];
      var figuraa = '';
      if($scope.datos.PTR_FIG_PROT[1] == undefined){
        figuraa='  '
      }
      else{
        figuraa= $scope.datos.PTR_FIG_PROT[1].f01_FIG_LEG_.toUpperCase();
      }
      var data = [
      {"prim":"CÓDIGO CATASTRAL:","seg":$scope.datos.PTR_COD_CAT},
      {"prim":"FECHA DE REGISTRO:","seg":$scope.datos.PTR_FEC_CREA},
      {"prim":"DENOMINACIÓN DEL INMUEBLE:","seg":$scope.datos.PTR_ACT.toUpperCase()},
     // {"prim":"FIGURA DE PROTECCIÓN:","seg":figuraa}
      ];
      var columns2 = [
      {title: "primero", dataKey: "prim"},
      {title: "segundo", dataKey: "seg"},
      {title: "tercero", dataKey: "ter"},
      {title: "cuarto", dataKey: "cuar"}
      ];
      if($scope.datos.PTR_MACRO ==-1||$scope.datos.PTR_MACRO =='(Ninguno)')
        {$scope.datos.PTR_MACRO =" ";} 
      var data2 = [
      {"prim":"MUNICIPIO:","seg":$scope.datos.PTR_MUNI.toUpperCase(),"ter":"NÚMERO DE CASA","cuar":" "},
      {"prim":"MACRODISTRITO:","seg":$scope.datos.PTR_MACRO,"ter":"NÚMERO 1:","cuar":$scope.datos.PTR_NUM1},
      {"prim":"ZONA:","seg":$scope.datos.PTR_ZONA,"ter":"NÚMERO 2:","cuar":$scope.datos.PTR_NUM2},
      {"prim":"DIRECCIÓN:","seg":$scope.datos.PTR_DIRE.toUpperCase(),"ter":"NÚMERO 3:","cuar":$scope.datos.PTR_NUM3},
      {"prim":"DEPARTAMENTO:","seg":$scope.datos.PTR_DEP.toUpperCase(),"ter":"NÚMERO 4:","cuar":$scope.datos.PTR_NUM4},
      {"prim":"CIUDAD/POBLACIÓN:","seg":$scope.datos.PTR_MUNI.toUpperCase(),"ter":"NÚMERO 5:","cuar":$scope.datos.PTR_NUM5},
      ];
      var columns3 = [
      {title: "primero", dataKey: "prim"}
      ];
      var despred = document.createElement('div');
      despred.innerHTML = $scope.datos.PTR_DES_PRED.toUpperCase();
      var data3 = [
      {"prim":despred.innerText}
      ];
      var columns4 = [
      {title: "primero", dataKey: "prim"}
      ];
      var data4 = [];
      for(var i = 1; i<$scope.datos.PTR_REG_PROPI.length;i++){
         var aporte = {"prim": $scope.datos.PTR_REG_PROPI[i].f01_reja_INT_.toUpperCase()};
        data4[i]=aporte; 
      }
      var columns67 = [
      {title: "primero", dataKey: "prim"},
      {title: "segundo", dataKey: "seg"}
      ];
      var data67 = [];
      for(var i = 1; i<$scope.datos.PTR_FIG_PROT.length;i++){
         data67[i] = {"prim": "* "+$scope.datos.PTR_FIG_PROT[i].f01_FIG_LEG_.toUpperCase(),"seg":$scope.datos.PTR_FIG_PROT[i].f01_FIG_OBS.toUpperCase()};
      }
      var columns66 = [
      {title: "primero", dataKey: "prim"},
      {title: "segundo", dataKey: "seg"},
      {title: "tercero", dataKey: "ter"},
      {title: "cuarto", dataKey: "cuar"}
      ];
      var data66 = [
      {"prim":"USO ACTUAL:","seg":actual.toUpperCase(),"ter":"USO TRADICIONAL:","cuar":tradicional.toUpperCase()}
      ];
      var columns6 = [
      {title: "primero", dataKey: "prim"},
      {title: "segundo", dataKey: "seg"},
      {title: "tercero", dataKey: "ter"},
      {title: "cuarto", dataKey: "cuar"}
      ];
      if($scope.datos.PTR_TIP_ARQ == -1 ||$scope.datos.PTR_TIP_ARQ =='(Ninguno)')
        {$scope.datos.PTR_TIP_ARQ =" ";}
      if($scope.datos.PTR_LIN_CONS ==-1 ||$scope.datos.PTR_LIN_CONS =='(Ninguno)')
        {$scope.datos.PTR_LIN_CONS =" ";}
      if($scope.datos.PTR_UBIC_MAN ==-1 ||$scope.datos.PTR_UBIC_MAN =='(Ninguno)')
        {$scope.datos.PTR_UBIC_MAN =" ";}
      if($scope.datos.PTR_EST_CON ==-1 ||$scope.datos.PTR_EST_CON =='(Ninguno)')
        {$scope.datos.PTR_EST_CON =" ";}
      if($scope.datos.PTR_TRAZ_MAN ==-1 ||$scope.datos.PTR_TRAZ_MAN =='(Ninguno)')
        {$scope.datos.PTR_TRAZ_MAN =" ";}
      if($scope.datos.PTR_TIP_VIA ==-1 ||$scope.datos.PTR_TIP_VIA =='(Ninguno)')
        {$scope.datos.PTR_TIP_VIA =" ";}
      if($scope.datos.PTR_RAN_EPO ==-1 ||$scope.datos.PTR_RAN_EPO =='(Ninguno)')
        {$scope.datos.PTR_RAN_EPO =" ";}
      if($scope.datos.PTR_MAT_VIA ==-1 ||$scope.datos.PTR_MAT_VIA =='(Ninguno)')
        {$scope.datos.PTR_MAT_VIA =" ";}
      if($scope.datos.PTR_EST_GEN ==-1 ||$scope.datos.PTR_EST_GEN =='(Ninguno)')
        {$scope.datos.PTR_EST_GEN =" ";}

      var data6 = [
      {"prim":"TIPOLOGIA ARQUITECTÓNICA:","seg":$scope.datos.PTR_TIP_ARQ.toUpperCase(),"ter":"UBICACIÓN DE MANZANA:","cuar":$scope.datos.PTR_UBIC_MAN.toUpperCase()},
      {"prim":"LINEA DE CONSTRUCCIÓN:","seg":$scope.datos.PTR_LIN_CONS.toUpperCase(),"ter":"ESTADO DE CONSERVACIÓN:","cuar":$scope.datos.PTR_EST_CON.toUpperCase()},
      {"prim":"TRAZO DE MANZANA:","seg":$scope.datos.PTR_TRAZ_MAN.toUpperCase(),"ter":"TIPO DE VÍA:","cuar":$scope.datos.PTR_TIP_VIA.toUpperCase()},
      {"prim":"RANGO DE ÉPOCA:","seg":$scope.datos.PTR_RAN_EPO.toUpperCase(),"ter":"MATERIAL DE VÍA:","cuar":$scope.datos.PTR_MAT_VIA.toUpperCase()},
      {"prim":"ESTILO GENERAL:","seg":$scope.datos.PTR_EST_GEN.toUpperCase(),"ter":" ","cuar":" "}
      ];
      var columns7 = [
      {title: "REFERENCIAS", dataKey: "uno"},
      {title: "OBSERVACIÓN", dataKey: "tres"}
      ];
      var data7=[];
      for (var i=1; i<$scope.datos.PTR_REF_HIST.length;i++){
        var desc = $scope.datos.PTR_REF_HIST[i].f01_ref_hist_.split('-');
        var aporte = {"uno":"* "+$scope.datos.PTR_REF_HIST[i].f01_ref_hist_.toUpperCase() ,"tres":$scope.datos.PTR_REF_HIST[i].f01_Obs_REF_};
        data7[i]=aporte;
      }
      var htmlOb = document.createElement('div');
      htmlOb.innerHTML = $scope.datos.PTR_VAL_TEC_DESC1;
      var htmlObj = document.createElement('div');
      htmlObj.innerHTML = $scope.datos.PTR_VAL_HIS_DESC1;
      var htmlObje = document.createElement('div');
      htmlObje.innerHTML = $scope.datos.PTR_VAL_ART_DESC1;
      var htmlObjet = document.createElement('div');
      htmlObjet.innerHTML = $scope.datos.PTR_VAL_ARQ_DESC1;
      var inte1 = document.createElement('div');
      inte1.innerHTML = $scope.datos.PTR_VAL_INTE_DESC1;
      var urb1 = document.createElement('div');
      urb1.innerHTML = $scope.datos.PTR_VAL_URB_DESC1;
      var inmat1 = document.createElement('div');
      inmat1.innerHTML = $scope.datos.PTR_VAL_INMAT_DESC1;
      var simb1 = document.createElement('div');
      simb1.innerHTML = $scope.datos.PTR_VAL_SIMB_DESC1;      
      var tec2 = document.createElement('div');
      tec2.innerHTML = $scope.datos.PTR_VAL_TEC_DESC2;
      var his2 = document.createElement('div');
      his2.innerHTML = $scope.datos.PTR_VAL_HIS_DESC2;
      var art2 = document.createElement('div');
      art2.innerHTML = $scope.datos.PTR_VAL_ART_DESC2;
      var arq2 = document.createElement('div');
      arq2.innerHTML = $scope.datos.PTR_VAL_ARQ_DESC2;
      var inte2 = document.createElement('div');
      inte2.innerHTML = $scope.datos.PTR_VAL_INTE_DESC2;
      var urb2 = document.createElement('div');
      urb2.innerHTML = $scope.datos.PTR_VAL_URB_DESC2;
      var inmat2 = document.createElement('div');
      inmat2.innerHTML = $scope.datos.PTR_VAL_INMAT_DESC2;
      var simb2 = document.createElement('div');
      simb2.innerHTML = $scope.datos.PTR_VAL_SIMB_DESC2; 
      var tec3 = document.createElement('div');
      tec3.innerHTML = $scope.datos.PTR_VAL_TEC_DESC3;
      var his3 = document.createElement('div');
      his3.innerHTML = $scope.datos.PTR_VAL_HIS_DESC3;
      var art3 = document.createElement('div');
      art3.innerHTML = $scope.datos.PTR_VAL_ART_DESC3;
      var arq3 = document.createElement('div');
      arq3.innerHTML = $scope.datos.PTR_VAL_ARQ_DESC3;
      var inte3 = document.createElement('div');
      inte3.innerHTML = $scope.datos.PTR_VAL_INTE_DESC3;
      var urb3 = document.createElement('div');
      urb3.innerHTML = $scope.datos.PTR_VAL_URB_DESC3;
      var inmat3 = document.createElement('div');
      inmat3.innerHTML = $scope.datos.PTR_VAL_INMAT_DESC3;
      var simb3 = document.createElement('div');
      simb3.innerHTML = $scope.datos.PTR_VAL_SIMB_DESC3;
      var tec4 = document.createElement('div');
      tec4.innerHTML = $scope.datos.PTR_VAL_TEC_DESC4;
      var his4 = document.createElement('div');
      his4.innerHTML = $scope.datos.PTR_VAL_HIS_DESC4;
      var art4 = document.createElement('div');
      art4.innerHTML = $scope.datos.PTR_VAL_ART_DESC4;
      var arq4 = document.createElement('div');
      arq4.innerHTML = $scope.datos.PTR_VAL_ARQ_DESC4;
      var inte4 = document.createElement('div');
      inte4.innerHTML = $scope.datos.PTR_VAL_INTE_DESC4;
      var urb4 = document.createElement('div');
      urb4.innerHTML = $scope.datos.PTR_VAL_URB_DESC4;
      var inmat4 = document.createElement('div');
      inmat4.innerHTML = $scope.datos.PTR_VAL_INMAT_DESC4;
      var simb4 = document.createElement('div');
      simb4.innerHTML = $scope.datos.PTR_VAL_SIMB_DESC4;
      var tec5 = document.createElement('div');
      tec5.innerHTML = $scope.datos.PTR_VAL_TEC_DESC5;
      var his5 = document.createElement('div');
      his5.innerHTML = $scope.datos.PTR_VAL_HIS_DESC5;
      var art5 = document.createElement('div');
      art5.innerHTML = $scope.datos.PTR_VAL_ART_DESC5;
      var arq5 = document.createElement('div');
      arq5.innerHTML = $scope.datos.PTR_VAL_ARQ_DESC5;
      var inte5 = document.createElement('div');
      inte5.innerHTML = $scope.datos.PTR_VAL_INTE_DESC5;
      var urb5 = document.createElement('div');
      urb5.innerHTML = $scope.datos.PTR_VAL_URB_DESC5;
      var inmat5 = document.createElement('div');
      inmat5.innerHTML = $scope.datos.PTR_VAL_INMAT_DESC5;
      var simb5 = document.createElement('div');
      simb5.innerHTML = $scope.datos.PTR_VAL_SIMB_DESC5;
      
      var header = function (data) {
        doc.addImage(material,'JPEG', 35, 40, 525, 60);
        doc.setTextColor(0);
        doc.setFontStyle('bold');
        doc.setFontSize(11);
        doc.text('FICHA DE CATALOGACIÓN DE BIENES INMUEBLES',80,120);
        doc.setFontSize(9);
        doc.text('NRO. FICHA: ',400,120);
        doc.setFontStyle('normal');
        doc.text($scope.datos.PTR_NUM_FIC,470,120);
        doc.rect(390, 105, 170, 25);
      };
      var totalPagesExp = "{total_pages_count_string}";
      var footer = function (data) {
        var str = "Página " + data.pageCount;
        if (typeof doc.putTotalPages === 'function') {
          str = str + " de " + totalPagesExp;
        }
        doc.text("Para cualquier consulta, por favor comunicarse al Telefono. 2-2440746 ", 150, doc.internal.pageSize.height - 40);
      };
      doc.setFontSize(9);
      if($scope.datos.PTR_CATEGORIA===undefined){
        $scope.datos.PTR_CATEGORIA=" ";
      }
      doc.setFontStyle('bold');      
      doc.text('IDENTIFICACIÓN',40,140);
      doc.autoTable(columns.splice(0,2), data, {drawHeaderRow: function() {return false;},startY: 150,pageBreak: 'auto',theme: 'plain',bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},beforePageContent: header,afterPageContent: footer,margin: {horizontal: 50, top: 160, bottom: 80},styles: {overflow: 'linebreak'},columnStyles: {prim: {columnWidth: 120,fontStyle: 'bold'}}});
      doc.rect(40, 150, 525, 60);
      doc.rect(40, doc.autoTableEndPosY() +30, 525, 80);
      doc.setFontSize(9);
      doc.setFontStyle('bold');
      doc.text('LOCALIZACIÓN',40,doc.autoTableEndPosY() +25);
      doc.autoTable(columns2.splice(0,4), data2,  {drawHeaderRow: function() {return false;},theme: 'plain',startY: doc.autoTableEndPosY() +35,bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 50, top: 140, bottom: 80},styles: {overflow: 'linebreak'},columnStyles: {prim: {columnWidth: 120,fontStyle: 'bold'},seg: {columnWidth: 170},ter: {columnWidth: 120,fontStyle: 'bold'},cuar: {columnWidth: 80}}});
      doc.setFontSize(9);
      doc.setFontStyle('bold');
      doc.text('FOTOGRAFÍA PRINCIPAL',340,doc.autoTableEndPosY() +20);
      doc.addImage(pic[0],'JPEG',290, doc.autoTableEndPosY() +30, 275 , 440);
      doc.setFontStyle('bold');
      doc.text('PLANO DE UBICACIÓN',70,doc.autoTableEndPosY() +20);
      doc.addImage(pic[1],'JPEG',40, doc.autoTableEndPosY() +30, 230 , 133);
      doc.setFontStyle('bold');
      doc.text('TIPOLOGÍA ARQUITECTÓNICA',70,doc.autoTableEndPosY() +173);
      doc.addImage(pic[2],'JPEG',40, doc.autoTableEndPosY() +183, 230 , 133);
      doc.setFontStyle('bold');
      doc.text('PERFÍL DE ACERA',70,doc.autoTableEndPosY() +326);
      doc.addImage(pic[3],'JPEG',40, doc.autoTableEndPosY() +336, 230 , 133);

      doc.setFontStyle('normal');
      doc.setFontSize(8);
      doc.text("Página 1 de 3", 470, doc.internal.pageSize.height - 40);
      doc.addPage();
      doc.setFontSize(9);
      doc.setFontStyle('bold');
      doc.text('DESCRIPCIÓN DEL INMUEBLE',40,140);
      doc.autoTable(columns3.splice(0,1), data3,  {drawHeaderRow: function() {return false;},
        theme: 'plain',startY: 150,bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},beforePageContent: header,afterPageContent: footer,margin: {horizontal: 50, top: 140, bottom: 80},styles: {overflow: 'linebreak'}, pageBreak: 'auto'});
      doc.setFontSize(9);
      doc.setFontStyle('bold');
      doc.text('TIPO DE PROPIEDAD',40,doc.autoTableEndPosY() + 15);
      doc.autoTable(columns4.splice(0,1), data4,  {drawHeaderRow: function() {return false;},
        theme: 'plain',startY: doc.autoTableEndPosY() +20,bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 50, top: 140, bottom: 80},styles: {overflow: 'linebreak'}, pageBreak: 'auto'});
      doc.rect(40, doc.autoTableEndPosY() +5, 525, 20);
      doc.autoTable(columns66.splice(0,4), data66, {drawHeaderRow: function() {return false;} ,
        startY: doc.autoTableEndPosY() + 10,pageBreak: 'auto',theme: 'plain',bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 50, top: 140, bottom: 80},styles: {overflow: 'linebreak'},columnStyles: {prim: {columnWidth: 120,fontStyle: 'bold'},seg: {columnWidth: 170},ter: {columnWidth: 120,fontStyle: 'bold'},cuar: {columnWidth: 80}}});
      doc.rect(40, doc.autoTableEndPosY() +12, 525, 85);
      doc.autoTable(columns6.splice(0,4), data6, {drawHeaderRow: function() {return false;} ,
        startY: doc.autoTableEndPosY() +15,pageBreak: 'auto',theme: 'plain',bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 50, top: 140, bottom: 80},styles: {overflow: 'linebreak'},columnStyles: {prim: {columnWidth: 120,fontStyle: 'bold'},seg: {columnWidth: 170},ter: {columnWidth: 120,fontStyle: 'bold'},cuar: {columnWidth: 80}}});
      doc.setFontSize(9);
      doc.setFontStyle('bold');
      doc.text('DATOS ORALES Y DOCUMENTALES',40,doc.autoTableEndPosY() +20);
      doc.setFontSize(9);
      doc.setFontStyle('bold');
      doc.text('FIGURA DE PROTECCIÓN LEGAL',40,doc.autoTableEndPosY() +35);
      doc.autoTable(columns67.splice(0,4), data67, {drawHeaderRow: function() {return false;} ,
        startY: doc.autoTableEndPosY() +45,pageBreak: 'auto',theme: 'plain',bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 50, top: 140, bottom: 80},styles: {overflow: 'linebreak'},columnStyles: {prim: {columnWidth: 120,fontStyle: 'bold'}}});

      doc.setFontSize(9);
      doc.setFontStyle('bold');
      doc.text('ORALES',40,doc.autoTableEndPosY() +15);
      doc.setFontSize(8);
      doc.setFontStyle('normal');
      doc.text('AUTOR O CONSTRUCTOR:',60,doc.autoTableEndPosY() +30);
      doc.text($scope.datos.PTR_AUT_CON.toUpperCase(),240,doc.autoTableEndPosY() +30);
      doc.text('FECHA DE CONSTRUCCIÓN:',60,doc.autoTableEndPosY() +45);
      doc.text($scope.datos.PTR_FECH_CONS.toUpperCase(),240,doc.autoTableEndPosY() +45);
      doc.setFontSize(9);
      doc.setFontStyle('bold');
      doc.text('DOCUMENTALES',40,doc.autoTableEndPosY() +60);
      doc.setFontSize(8);
      doc.setFontStyle('normal');
      doc.text('AUTOR O CONSTRUCTOR:',60,doc.autoTableEndPosY() +75);
      doc.text($scope.datos.PTR_AUT_CONS.toUpperCase(),240,doc.autoTableEndPosY() +75);
      doc.text('FECHA DE CONSTRUCCIÓN:',60,doc.autoTableEndPosY() +90);
      doc.text($scope.datos.PTR_FEC_CONST_DOC.toUpperCase(),240,doc.autoTableEndPosY() +90);
      doc.setFontSize(9);
      doc.setFontStyle('bold');
      doc.text('REFERENCIAS HISTORICAS:',40,doc.autoTableEndPosY() +105);
      doc.setFontStyle('normal');
      doc.autoTable(columns7, data7,{drawHeaderRow: function() {return false;},theme: 'plain',startY: doc.autoTableEndPosY() +110,headerStyles: {rowHeight: 15, fontSize: 8, fontStyle:'bold'},bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 60, top: 140, bottom: 80},styles: {overflow: 'linebreak'}, pageBreak: 'auto',columnStyles: {uno: {columnWidth: 'wrap'}}});

      doc.setFontStyle('normal');
      doc.setFontSize(8);
      doc.text("Página 2 de 3", 470, doc.internal.pageSize.height - 40);
      if (typeof doc.putTotalPages === 'function') {
        doc.putTotalPages(totalPagesExp);
      }
      $('#visorFumm object').attr('data',doc.output('datauristring'));
      $("#divPopup8").modal('show');
    })
    obj.error(function(error) {
      $.unblockUI();
    });
  };
  $scope.formlp = function(idfrcasos){
    var resDatos = {
      "table_name":"_fr_casos",
      "filter": "cas_id="+idfrcasos
    };
    var obj=DreamFactory.api[CONFIG.SERVICE].getRecordsByFilter(resDatos);
    obj.success(function (response) { 
      $scope.datos=JSON.parse(response.record[0].cas_datos);
      var col = [
      {title: "primero", dataKey: "prim"},
      {title: "segundo", dataKey: "seg"}
      ];
      var data = [
      {"prim":"Bien Cultural:","seg":$scope.datos.PTR_DEN.toUpperCase()},
      {"prim":"Tipo de Bien Cultural:","seg":$scope.datos.PTR_TB_CUL.toUpperCase()},
      {"prim":"Categoría de la declaratoria:","seg":$scope.datos.PTR_PROT_LEGAL.toUpperCase()},
      {"prim":"Norma Legal:","seg":$scope.datos.PTR_NIV_PROTEC.toUpperCase()},
      {"prim":"Número Legal:","seg":$scope.datos.PTR_NUM_PRLEGAL.toUpperCase()},
      {"prim":"Fecha de Programación:","seg":$scope.datos.PTR_FEC_PROG.toUpperCase()}
      ];
      var doc = new jsPDF('p', 'pt');

      var header = function (data) {
       doc.addImage(inmaterial,'JPEG', 35, 40, 525, 60);
         doc.setTextColor(0);
        doc.setFontStyle('bold');
        doc.setFontSize(11);
        doc.text('PATRIMONIO CULTURAL DE LA CIUDAD DE LA PAZ',40,120);
        doc.setFontSize(9);
        doc.text('NRO. FICHA: ',400,120);
        doc.setFontStyle('normal');
        doc.text($scope.datos.PTR_COD,470,120);
        doc.rect(390, 105, 170, 25);
      };
      var totalPagesExp = "{total_pages_count_string}";
      var footer = function (data) {
        var str = "Página " + data.pageCount;
        if (typeof doc.putTotalPages === 'function') {
          str = str + " de " + totalPagesExp;
        }
        doc.text(str, 470, doc.internal.pageSize.height - 45);
        doc.text("Para cualquier consulta, por favor comunicarse al Telefono. 2-2440746", 150, doc.internal.pageSize.height - 45);
      };

      doc.autoTable(col.splice(0,2), data, {drawHeaderRow: function() {return false;},startY: 135,pageBreak:'auto',theme:'plain',bodyStyles:{rowHeight:12,fontSize:8,valign:'middle'},margin:{horizontal:50,top:130,bottom:60},beforePageContent: header,afterPageContent: footer,styles: {overflow:'linebreak'},columnStyles: {prim: {columnWidth: 'wrap',fontStyle: 'bold'}}
    });
      if (typeof doc.putTotalPages === 'function') {
        doc.putTotalPages(totalPagesExp);
      }
      //doc.save('pidmlp'+'.pdf');
        $('#visorFumm object').attr('data',doc.output('datauristring'));
        $("#divPopup8").modal('show');
        //window.open(doc.output('datauristring'));

    });
    obj.error(function(error) {  
    });
  };
  
  $scope.formper=function(idfrcasos,img1,img2,text1,text2){
    var resDatos = {
      "table_name":"_fr_casos",
      "filter": "cas_id="+idfrcasos
    };
    var obj=DreamFactory.api[CONFIG.SERVICE].getRecordsByFilter(resDatos);
    obj.success(function (response) { 
      $scope.datos=JSON.parse(response.record[0].cas_datos);
      var colprim = [
      {title: "descripcion", dataKey: "des"}
      ];
      var obser1 = document.createElement('div');
      obser1.innerHTML = $scope.datos.PTR_CONTEX;      
      var funcion1 = document.createElement('div');
      funcion1.innerHTML = $scope.datos.PTR_CARACT; 
      var decoracion1 = document.createElement('div');
      decoracion1.innerHTML = $scope.datos.PTR_SIG_INTER;
      var descatri1 = document.createElement('div');
      descatri1.innerHTML = $scope.datos.PTR_DAT_HIS;
      var descest1 = document.createElement('div');
      descest1.innerHTML = $scope.datos.PTR_NARR_DEN;
      var tecnica1 = document.createElement('div');
      tecnica1.innerHTML = $scope.datos.PTR_DAT_COMP;
      var manufactura1 = document.createElement('div');
      manufactura1.innerHTML = $scope.datos.PTR_OTROS;
      var etim = document.createElement('div');
      etim.innerHTML = $scope.datos.PTR_ETIM;
      var proteccion='';
      for(var i=1; i<$scope.datos.PTR_NIV_PROTEC.length;i++){
        if($scope.datos.PTR_NIV_PROTEC[i].estado){
          if(proteccion!=''){
            proteccion=proteccion+', '+$scope.datos.PTR_NIV_PROTEC[i].resvalor;
          }
          else{
            proteccion=proteccion+$scope.datos.PTR_NIV_PROTEC[i].resvalor;
          }
        }
      }
      if($scope.datos.PTR_PROT_LEGAL ==-1)
        {$scope.datos.PTR_PROT_LEGAL =" ";} 
      if($scope.datos.PTR_INSTR_PRLEGAL ==-1)
        {$scope.datos.PTR_INSTR_PRLEGAL =" ";}
      var dataprim=[
      {"des":$scope.datos.PTR_EXPR.toUpperCase()},
      {"des":$scope.datos.PTR_DEN.toUpperCase()},
      {"des":etim.innerText.toUpperCase()},
      {"des":$scope.datos.PTR_PERIODO.toUpperCase()},
      {"des":$scope.datos.PTR_DIR.toUpperCase()},
      {"des":funcion1.innerText.toUpperCase()},    
      {"des":obser1.innerText.toUpperCase()}, 
      {"des":descatri1.innerText.toUpperCase()},
      {"des":decoracion1.innerText.toUpperCase()},   
      {"des":proteccion.toUpperCase()},
      {"des":$scope.datos.PTR_PROT_LEGAL.toUpperCase()},     
      {"des":$scope.datos.PTR_INSTR_PRLEGAL.toUpperCase() +' '+ $scope.datos.PTR_NUM_LEGAL.toUpperCase()},
      ];
      var colseg = [
      {title: "descripcion", dataKey: "des"}
      ];
      var dataseg=[ 
      {"des":$scope.datos.PTR_RESP_INF.toUpperCase()},     
      {"des":$scope.datos.PTR_RESP_FEC},
      {"des":tecnica1.innerText.toUpperCase()},
      {"des":manufactura1.innerText.toUpperCase()}
      ];
      var doc = new jsPDF('p', 'pt');
      var header = function (data) {
        doc.addImage(inmaterial,'JPEG', 35, 40, 525, 60);
         doc.setTextColor(0);
        doc.setFontStyle('bold');
        doc.setFontSize(11);
        doc.text('PERSONAJES RELACIONADOS CON EL PATRIMONIO CULTURAL',40,120);
        doc.setFontSize(9);
        doc.text('NRO. FICHA: ',400,120);
        doc.setFontStyle('normal');
        doc.text($scope.datos.PTR_COD,470,120);
        doc.rect(390, 105, 170, 25);
      };
      var totalPagesExp = "{total_pages_count_string}";
      var numeropag = 0;
      var footer = function (data) {
        if(data.pageCount >= 1){
          numeropag = numeropag + 1;
        }
        var str = "Página " + numeropag;
        if (typeof doc.putTotalPages === 'function') {
          str = str + " de " + totalPagesExp;
        }
        doc.text(str, 470, doc.internal.pageSize.height - 45);
        doc.text("Para cualquier consulta, por favor comunicarse al Telefono. 2-2440746", 150, doc.internal.pageSize.height - 45);
      };
      doc.setFontSize(9);
      doc.setTextColor(40);
      doc.setFontStyle('bold')
      doc.text('DATOS ORALES', 40, 135);
      doc.autoTable(colprim.splice(0,1), dataprim, {drawHeaderRow: function() {return false;},startY: 140,drawRow: function (row, data) {doc.setFontStyle('bold'); doc.setFontSize(9);
        if (row.index === 0) {          
            doc.setTextColor(0);
          doc.autoTableText("1. EXPRESIÓN CULTURAL" , 40, row.y +15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        }else if (row.index === 1) {          
            doc.setTextColor(0);
          doc.autoTableText("2. DENOMINACIÓN" , 40, row.y +15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        } else if (row.index === 2) {          
            doc.setTextColor(0);
          doc.autoTableText("3. ETIMOLOGÍA" , 40, row.y +15,{
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        } else if (row.index === 3) {          
            doc.setTextColor(0);
          doc.autoTableText("4. ÉPOCA O AÑO DE ORIGEN" , 40,row.y +15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        } else if (row.index === 4) {          
            doc.setTextColor(0);
          doc.autoTableText("5. LOCALIZACIÓN" , 40, row.y +15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        }
        else if (row.index === 5) {          
            doc.setTextColor(0);
          doc.autoTableText("6. CARACTERIZACIÓN DEL PERSONAJE" , 40, row.y +15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        }
        else if (row.index === 6) {

          doc.autoTableText("7. CONTEXTO SOCIO - CULTURAL" , 40, row.y +15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        }
        else if (row.index === 7) {          
            doc.setTextColor(0);
          doc.autoTableText("8. DESCRIPCIÓN DEL PERSONAJE" , 40, row.y +15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        } else if (row.index === 8) {          
            doc.setTextColor(0);
          doc.autoTableText("9. DATOS HISTÓRICOS " , 40, row.y +15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        } else if (row.index === 9) {          
            doc.setTextColor(0);
          doc.autoTableText("10. SIGNIFICADO E INTERPRETACIÓN" , 40, row.y +15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        }  else if (row.index === 10) {          
            doc.setTextColor(0);
          doc.autoTableText("11. NIVEL DE PROTECCIÓN LEGAL" , 40, row.y +15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        } else if (row.index === 11) {          
            doc.setTextColor(0);
          doc.autoTableText("12. ORGANO EMISOR DE PROTECCIÓN LEGAL" , 40, row.y +15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        }else if (row.index === 12) {          
            doc.setTextColor(0);
          doc.autoTableText("13. INSTRUMENTO DE PROTECCIÓN LEGAL" , 40, row.y +15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        }        
      },pageBreak:'auto',theme:'plain',bodyStyles:{rowHeight:12,fontSize:8,valign:'middle'},margin:{horizontal:50,top:130,bottom:80},beforePageContent: header,afterPageContent: footer,styles: {overflow:'linebreak'},
    });
      doc.setFontSize(9);
      doc.setTextColor(40);
      doc.setFontStyle('bold');
      if(doc.autoTableEndPosY()>600){
        doc.addPage();
        doc.text('14. IMAGENES', 40, 140);
        doc.addImage(img1,'JPEG', 50, 150, 200, 200);
        doc.addImage(img2,'JPEG', 290, 150, 200, 200);
        doc.text('14.1. DESCRIPCIÓN', 50, 360);  
        doc.text('14.2. DESCRIPCIÓN', 290, 360);
        doc.setFontStyle('normal');
        doc.setFontSize(8);
        doc.text(text1.toUpperCase(), 50, 370);  
        doc.text(text2.toUpperCase(), 290, 370);

        doc.autoTable(colseg.splice(0,1), dataseg, {drawHeaderRow: function() {return false;},startY:375,drawRow: function (row, data) {doc.setFontStyle('bold'); doc.setFontSize(8);
          if  (row.index === 0) {           
            doc.setTextColor(0);
            doc.autoTableText("15.1.  RESPONSABLE DE LA INFORMACIÓN" , 40, row.y +15, {
              halign: 'left',
              valign: 'middle'
            });
            data.cursor.y += 20;
          }else if (row.index === 1) {

            doc.setTextColor(0);
            doc.autoTableText("15.2.  FECHA DE ELABORACIÓN" , 40, row.y +15, {
              halign: 'left',
              valign: 'middle'
            });
            data.cursor.y += 20;
          } else if (row.index === 2) {

            doc.setTextColor(0);
            doc.autoTableText("16. FUENTES DE INFORMACIÓN" , 40, row.y +15, {
              halign: 'left',
              valign: 'middle'
            });
            data.cursor.y += 20;
          }
          else if (row.index === 3) {
            doc.setTextColor(0);
            doc.autoTableText("17. DATOS COMPLEMENTARIOS" , 40, row.y +15, {
              halign: 'left',
              valign: 'middle'
            });
            data.cursor.y += 20;
          }
        },pageBreak:'auto',theme:'plain',bodyStyles:{rowHeight:12,fontSize:7,valign:'middle'},margin:{horizontal:50,top:100,bottom:80},beforePageContent: header,afterPageContent: footer,styles: {overflow:'linebreak'},
      });
      }
      else{
        doc.text('14. IMAGENES', 40, doc.autoTableEndPosY()+10);
        doc.addImage(img1,'JPEG', 50, doc.autoTableEndPosY()+20, 200, 200);
        doc.addImage(img2,'JPEG', 290, doc.autoTableEndPosY()+20, 200, 200);
        doc.text('14.1. DESCRIPCIÓN', 50, doc.autoTableEndPosY()+230);  
        doc.text('14.2. DESCRIPCIÓN', 290, doc.autoTableEndPosY()+230);
        doc.setFontStyle('normal');
        doc.text(text1.toUpperCase(), 50, doc.autoTableEndPosY()+240);  
        doc.text(text2.toUpperCase(), 290, doc.autoTableEndPosY()+240);

        doc.autoTable(colseg.splice(0,1), dataseg, {drawHeaderRow: function() {return false;},startY:doc.autoTableEndPosY()+250,drawRow: function (row, data) {doc.setFontStyle('bold'); doc.setFontSize(9);
          if  (row.index === 0) {           
            doc.autoTableText("15.1.  RESPONSABLE DE LA INFORMACIÓN " , 40, row.y +15, {
              halign: 'left',
              valign: 'middle'
            });
            data.cursor.y += 20;
          }else if (row.index === 1) {
            doc.setTextColor(0);
            doc.autoTableText("15.2.  FECHA DE ELABORACIÓN" , 40, row.y +15, {
              halign: 'left',
              valign: 'middle'
            });
            data.cursor.y += 20;
          } else if (row.index === 2) {
            doc.setTextColor(0);
            doc.autoTableText("16. FUENTES DE INFORMACIÓN" , 40, row.y +15, {
              halign: 'left',
              valign: 'middle'
            });
            data.cursor.y += 20;
          }
          else if (row.index === 3) {
            doc.setTextColor(0);
            doc.autoTableText("17. DATOS COMPLEMENTARIOS" , 40, row.y +15, {
              halign: 'left',
              valign: 'middle'
            });
            data.cursor.y += 20;
          }

        },pageBreak:'auto',theme:'plain',bodyStyles:{rowHeight:12,fontSize:8,valign:'middle'},margin:{horizontal:50,top:120,bottom:80},beforePageContent: header,afterPageContent: footer,styles: {overflow:'linebreak'}});    
      }
      if (typeof doc.putTotalPages === 'function') {
        doc.putTotalPages(totalPagesExp);
      }
      //doc.save('inmaterial'+'.pdf');
        $('#visorFumm object').attr('data',doc.output('datauristring'));
        $("#divPopup8").modal('show');
        //window.open(doc.output('datauristring'));

    })
    obj.error(function(error) {
      $.unblockUI();   

    });
  };
  $scope.formgen=function(idfrcasos,tulo,numero,img1,img2,text1,text2){
    var resDatos = {
      "table_name":"_fr_casos",
      "filter": "cas_id="+idfrcasos
    };
    var obj=DreamFactory.api[CONFIG.SERVICE].getRecordsByFilter(resDatos);
    obj.success(function (response) { 
      $scope.datos=JSON.parse(response.record[0].cas_datos);
      var doc = new jsPDF('p', 'pt');
      var colprim = [
      {title: "descripcion", dataKey: "des"}
      ];
      var obser1 = document.createElement('div');
      obser1.innerHTML = $scope.datos.PTR_CONTEX;      
      var funcion1 = document.createElement('div');
      funcion1.innerHTML = $scope.datos.PTR_CARACT; 
      var decoracion1 = document.createElement('div');
      decoracion1.innerHTML = $scope.datos.PTR_SIG_INTER;
      var descatri1 = document.createElement('div');
      descatri1.innerHTML = $scope.datos.PTR_DAT_HIS;
      var descest1 = document.createElement('div');
      descest1.innerHTML = $scope.datos.PTR_NARR_DEN;
      var tecnica1 = document.createElement('div');
      tecnica1.innerHTML = $scope.datos.PTR_DAT_COMP;
      var manufactura1 = document.createElement('div');
      manufactura1.innerHTML = $scope.datos.PTR_OTROS;
      var etim = document.createElement('div');
      etim.innerHTML = $scope.datos.PTR_ETIM; 
      var proteccion='';
      for(var i=1; i<$scope.datos.PTR_NIV_PROTEC.length;i++){
        if($scope.datos.PTR_NIV_PROTEC[i].estado){
          if(proteccion!=''){
            proteccion=proteccion+', '+$scope.datos.PTR_NIV_PROTEC[i].resvalor;
          }
          else{
            proteccion=proteccion+$scope.datos.PTR_NIV_PROTEC[i].resvalor;
          }
        }
      }
      if($scope.datos.PTR_PROT_LEGAL ==-1)
        {$scope.datos.PTR_PROT_LEGAL =" ";} 
      if($scope.datos.PTR_INSTR_PRLEGAL ==-1)
        {$scope.datos.PTR_INSTR_PRLEGAL =" ";} 
      var dataprim=[
      {"des":$scope.datos.PTR_EXPR.toUpperCase()},
      {"des":$scope.datos.PTR_DEN},
      {"des":etim.innerText.toUpperCase()},
      {"des":$scope.datos.PTR_PERIODO},
      {"des":$scope.datos.PTR_DEP+'- '+$scope.datos.PTR_PROV+' '+$scope.datos.PTR_ZONA+' '+$scope.datos.PTR_DIR},
      {"des":funcion1.outerText.toUpperCase()},    
      {"des":obser1.outerText.toUpperCase()}, 
      {"des":descest1.outerText.toUpperCase()},
      {"des":descatri1.outerText.toUpperCase()},
      {"des":decoracion1.outerText.toUpperCase()},   
      {"des":proteccion.toUpperCase()},
      {"des":$scope.datos.PTR_PROT_LEGAL.toUpperCase()},     
      {"des":$scope.datos.PTR_INSTR_PRLEGAL.toUpperCase()+' '+ $scope.datos.PTR_NUM_LEGAL.toUpperCase()},
      ];
      var colseg = [
      {title: "descripcion", dataKey: "des"}
      ];
      var dataseg=[ 
      {"des":$scope.datos.PTR_RESP_INF},     
      {"des":$scope.datos.PTR_RESP_FEC},
      {"des":tecnica1.outerText.toUpperCase()},
      {"des":manufactura1.outerText.toUpperCase()}
      ];
      var textos = doc.splitTextToSize(tulo, 800, {halign: 'center',valign: 'middle'});
      var header = function (data) {
        doc.addImage(inmaterial,'JPEG', 35, 40, 525, 60);
        doc.setTextColor(0);
        doc.setFontStyle('bold');
        doc.setFontSize(11);
        doc.text(textos,40,140);
        doc.setFontSize(9);
        doc.text('NRO. FICHA: ',400,120);
        doc.setFontStyle('normal');
        doc.text($scope.datos.PTR_COD,470,120);
        doc.rect(390, 105, 170, 25);
      };
      var totalPagesExp = "{total_pages_count_string}";
      var numeropag = 0;
      var footer = function (data) {
        if(data.pageCount >= numeropag){
          numeropag = numeropag + 1;
        }
        var str = "Página " + numeropag;
        if (typeof doc.putTotalPages === 'function') {
          str = str + " de " + totalPagesExp;
        }
        doc.text(str, 470, doc.internal.pageSize.height - 45);
          doc.text("Para cualquier consulta, por favor comunicarse al Telefono. 2-2440746", 150, doc.internal.pageSize.height - 45);
      };
      doc.setFontSize(9);
      doc.setTextColor(40);
      doc.setFontStyle('bold')
      doc.text('DATOS ORALES', 40, 155);
      doc.autoTable(colprim.splice(0,1), dataprim, {drawHeaderRow: function() {return false;},startY: 160,drawRow: function (row, data) {doc.setFontStyle('bold'); doc.setFontSize(9);
        if (row.index === 0) {
          doc.autoTableText("1. EXPRESIÓN CULTURAL" , 40, row.y +15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        }else if (row.index === 1) {          
            doc.setTextColor(0);
          doc.autoTableText("2. DENOMINACIÓN" , 40, row.y +15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        } else if (row.index === 2) {
          doc.autoTableText("3. ETIMOLOGÍA" , 40, row.y +15,{
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        } else if (row.index === 3) {          
            doc.setTextColor(0);
          doc.autoTableText("4. ÉPOCA O AÑO DE ORIGEN" , 40,row.y +15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        } else if (row.index === 4) {
          doc.autoTableText("5. LOCALIZACIÓN" , 40, row.y +15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        }
        else if (row.index === 5) {          
            doc.setTextColor(0);
          doc.autoTableText("6. CARACTERIZACIÓN DE LA EXPRESIÓN CULTURAL" , 40, row.y +15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        }
        else if (row.index === 6) {          
          doc.setTextColor(0);
          doc.autoTableText("7. CONTEXTO SOCIO - CULTURAL" , 40, row.y +15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        }
        else if (row.index === 7) {          
          doc.setTextColor(0);
          doc.autoTableText("8. NARRACIÓN DE LA DENOMINACIÓN" , 40, row.y +15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        } else if (row.index === 8) {          
            doc.setTextColor(0);
          doc.autoTableText("9. DATOS HISTÓRICOS " , 40, row.y +15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        } else if (row.index === 9) {          
            doc.setTextColor(0);
          doc.autoTableText("10. SIGNIFICADO E INTERPRETACIÓN" , 40, row.y +15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        }  else if (row.index === 10) {          
            doc.setTextColor(0);
          doc.autoTableText("11. NIVEL DE PROTECCION LEGAL" , 40, row.y +15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        } else if (row.index === 11) {          
            doc.setTextColor(0);
          doc.autoTableText("12. ORGANO EMISOR DE PROTECCIÓN LEGAL" , 40, row.y +15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        }else if (row.index === 12) {          
            doc.setTextColor(0);
          doc.autoTableText("13. INSTRUMENTO DE PROTECCIÓN LEGAL" , 40, row.y +15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        }        
      },pageBreak:'auto',theme:'plain',bodyStyles:{rowHeight:12,fontSize:8,valign:'top'},margin:{horizontal:50,top:150,bottom:80},beforePageContent: header,afterPageContent: footer,styles: {overflow:'linebreak'},
    });
      doc.setFontSize(9);
      doc.setTextColor(40);
      doc.setFontStyle('bold');
      if(doc.autoTableEndPosY()>600){
        doc.addPage();
        doc.text('14. IMAGENES', 40, 140);
        doc.addImage(img1,'JPEG', 50, 150, 200, 200);
        doc.addImage(img2,'JPEG', 290, 150, 200, 200);
        doc.text('14.1. DESCRIPCIÓN', 40, 360);  
        doc.text('14.2. DESCRIPCIÓN', 280, 360);
        doc.setFontStyle('normal');
        doc.setFontSize(8);
        if(text1 == undefined)
          text1 = " ";

        if(text2 == undefined)
          text2 = " ";
        doc.text(text1, 50, 370);  
        doc.text(text2, 290, 370);
        doc.autoTable(colseg.splice(0,1), dataseg, {drawHeaderRow: function() {return false;},startY:375,drawRow: function (row, data) {doc.setFontStyle('bold'); doc.setFontSize(9);
          if  (row.index === 0) {             
            doc.setTextColor(0);        
            doc.autoTableText("15.1.  RESPONSABLE DE LA INFORMACIÓN " , 40, row.y +15, {
              halign: 'left',
              valign: 'middle'
            });
            data.cursor.y += 20;
          }else if (row.index === 1) {
            doc.setTextColor(0);
            doc.autoTableText("15.2.  FECHA DE ELABORACIÓN" , 40, row.y +15, {
              halign: 'left',
              valign: 'middle'
            });
            data.cursor.y += 20;
          } else if (row.index === 2) {
            doc.setTextColor(0);
            doc.autoTableText("16. DATOS COMPLEMENTARIOS" , 40, row.y +15, {
              halign: 'left',
              valign: 'middle'
            });
            data.cursor.y += 20;
          }
          else if (row.index === 3) {
            doc.setTextColor(0);
            doc.autoTableText("17. FUENTES DE INFORMACIÓN" , 40, row.y +15, {
              halign: 'left',
              valign: 'middle'
            });
            data.cursor.y += 20;
          }

        },pageBreak:'auto',theme:'plain',bodyStyles:{rowHeight:12,fontSize:8,valign:'top'},margin:{horizontal:50,top:140,bottom:80},beforePageContent: header,afterPageContent: footer,styles: {overflow:'linebreak'},
        });
      }
      else{
        doc.text('14. IMAGENES', 40, doc.autoTableEndPosY()+10);
        if(img1===""){

        }
        else{
          doc.addImage(img1,'JPEG', 50, doc.autoTableEndPosY()+20, 200, 200);
          doc.addImage(img2,'JPEG', 290, doc.autoTableEndPosY()+20, 200, 200);
        }
          doc.text('14.1. DESCRIPCIÓN', 50, doc.autoTableEndPosY()+230);  
          doc.text('14.2. DESCRIPCIÓN', 290, doc.autoTableEndPosY()+230);
          doc.setFontStyle('normal');
          if(text1 == undefined)
            text1 = " ";
          else
            text1 = text1.toUpperCase();
          if(text2 == undefined)
            text2 = " ";
          else
            text2 = text2.toUpperCase();
          doc.text(text1, 50, doc.autoTableEndPosY()+240);  
          doc.text(text2, 290, doc.autoTableEndPosY()+240);
        
        doc.autoTable(colseg.splice(0,1), dataseg, {drawHeaderRow: function() {return false;},startY:doc.autoTableEndPosY()+250,drawRow: function (row, data) {doc.setFontStyle('bold'); doc.setFontSize(9);
          if  (row.index === 0) {           
            doc.autoTableText("15.1.  RESPONSABLE DE LA INFORMACIÓN " , 40, row.y +15, {
              halign: 'left',
              valign: 'middle'
            });
            data.cursor.y += 20;
          }else if (row.index === 1) {

            doc.autoTableText("15.2.  FECHA DE ELABORACIÓN" , 40, row.y +15, {
              halign: 'left',
              valign: 'middle'
            });
            data.cursor.y += 20;
          } else if (row.index === 2) {

            doc.autoTableText("16. DATOS COMPLEMENTARIOS" , 40, row.y +15, {
              halign: 'left',
              valign: 'middle'
            });
            data.cursor.y += 20;
          }
          else if (row.index === 3) {

            doc.autoTableText("17. FUENTES DE INFORMACIÓN" , 40, row.y +15, {
              halign: 'left',
              valign: 'middle'
            });
            data.cursor.y += 20;
          }

        },pageBreak:'auto',theme:'plain',bodyStyles:{rowHeight:12,fontSize:8,valign:'top'},margin:{horizontal:50,top:150,bottom:80},beforePageContent: header,afterPageContent: footer,styles: {overflow:'linebreak'}});    
      }
      if (typeof doc.putTotalPages === 'function') {
        doc.putTotalPages(totalPagesExp);
      }
      //doc.save('inmaterial'+'.pdf');

        $('#visorFumm object').attr('data',doc.output('datauristring'));
        $("#divPopup8").modal('show');
        
        //window.open(doc.output('datauristring'));

    })
    obj.error(function(error) {
      $.unblockUI();  
    });
  };
  $scope.categoria=function(idfrcasos,numero,img1,img2,text1,text2){
    switch (numero){
      case '1':
      $scope.formgen(idfrcasos,'ÁMBITO I TRADICIONES Y EXPRESIONES ORALES, INCLUIDO EL IDIOMA COMO VEHÍCULO DEL PATRIMONIO CULTURAL INMATERIAL',numero,img1,img2,text1,text2);
      break;
      case '2':
      $scope.formgen(idfrcasos,'ÁMBITO II ARTES DEL ESPECTÁCULO',numero,img1,img2,text1,text2);    
      break;
      case '3':
      $scope.formgen(idfrcasos,'ÁMBITO III USOS SOCIALES, RITUALES Y ACTOS FESTIVOS',numero,img1,img2,text1,text2);
      break;
      case '4':
      $scope.formgen(idfrcasos,'ÁMBITO IV CONOCIMIENTOS Y USOS RELACIONADOS CON LA NATURALEZA Y EL UNIVERSO',numero,img1,img2,text1,text2);
      break;
      case '5':
      $scope.formgen(idfrcasos,'ÁMBITO V TÉCNICAS ARTESANALES TRADICIONALES',numero,img1,img2,text1,text2);
      break;
      case '7':
      $scope.formper(idfrcasos,img1,img2,text1,text2);
      break;
      default: console.log("se fue al default",numero);
    }
   
  };
  
  $scope.fichamonumento2=function(casid,frente,perfil,pedestal,plano){
    var resDatos = {
      "table_name":"_fr_casos",
      "filter": "cas_id="+casid
    };
    var obj=DreamFactory.api[CONFIG.SERVICE].getRecordsByFilter(resDatos);
      obj.success(function (response) {
      $scope.datos=JSON.parse(response.record[0].cas_datos);
      var columns = [
      {title: "titulo", dataKey: "tit"},
      {title: "descripcion", dataKey: "des"}
      ];
      var data=[
      {"tit":"DENOMINACIÓN:","des":$scope.datos.PTR_NOMBRE}
      ];
      var columns2 = [
      {title: "titulo", dataKey: "tit"},
      {title: "descripcion", dataKey: "des"}
      ];
      var autor1 = document.createElement('div');
      autor1.innerHTML = $scope.datos.PTR_AU; 
      var obra1 = document.createElement('div');
      obra1.innerHTML = $scope.datos.PTR_DESC_OBRA; 
      var fuente1 = document.createElement('div');
      fuente1.innerHTML = $scope.datos.PTR_FUENT_BIBLIO; 
      var descripcion1 = document.createElement('div');
      descripcion1.innerHTML = $scope.datos.PTR_DES_PER; 
      var referencia1 = document.createElement('div');
      referencia1.innerHTML = $scope.datos.PTR_REF_HIST; 
      if($scope.datos.PTR_MACRO ==-1)
        {$scope.datos.PTR_MACRO =" ";}
      if($scope.datos.PTR_EST_CON ==-1)
        {$scope.datos.PTR_EST_CON =" ";}
      var tradicional='';
      for(var i=0; i<3;i++){
        if($scope.datos.PTR_CONJ_ESC[i].estado){
          if(tradicional!=''){
            tradicional=tradicional+', '+$scope.datos.PTR_CONJ_ESC[i].resvalor;
          }
          else{
            tradicional=tradicional+$scope.datos.PTR_CONJ_ESC[i].resvalor;
          }
        }
      }
      var data2=[
        {"tit":"PAÍS:","des":$scope.datos.PTR_PAIS.toUpperCase()},
        {"tit":"DEPARTAMENTO:","des":$scope.datos.PTR_DEP.toUpperCase()},
        {"tit":"MUNICIPIO:","des":$scope.datos.PTR_MUNI.toUpperCase()},
        {"tit":"PROVINCIA:","des":$scope.datos.PTR_PROV.toUpperCase()},
        {"tit":"MACRODISTRITO:","des":$scope.datos.PTR_MACRO.toUpperCase()},
        {"tit":"COMUNIDAD:","des":$scope.datos.PTR_COMU.toUpperCase()},
        {"tit":"DIRECCIÓN:","des":$scope.datos.PTR_DIR.toUpperCase()},
        {"tit":"DATOS DEL AUTOR:","des":autor1.innerText.toUpperCase()},
        {"tit":"ESPECIALIDAD:","des":$scope.datos.PTR_ESP.toUpperCase()},
        {"tit":"TÉCNICA Y MATERIAL:","des":$scope.datos.PTR_TEC_MAT.toUpperCase()},
        {"tit":"PIEZA ESCULTÓRICA","des":tradicional.toUpperCase()},
        {"tit":"ALTO:","des":$scope.datos.PTR_ALTO.toUpperCase()},
        {"tit":"ANCHO","des":$scope.datos.PTR_ANCHO.toUpperCase()},
        {"tit":"PESO:","des":$scope.datos.PTR_PESO.toUpperCase()},
        {"tit":"DESCRIPCIÓN DE LA OBRA:","des":obra1.innerText.toUpperCase()},
        {"tit":"ORIGEN DE LA PIEZA:","des":$scope.datos.PTR_ORG_PIE.toUpperCase()},
        {"tit":"NOMBRE DEL PROPIETARIO:","des":$scope.datos.PTR_PROP.toUpperCase()},
        {"tit":"RESPONSABLES:","des": $scope.datos.PTR_RESP.toUpperCase()},
        {"tit":"TIPO:","des": $scope.datos.PTR_TIPO.toUpperCase()},
        {"tit":"NRO. LEY U ORDENANZA MUNICIPAL:","des": $scope.datos.PTR_LEY_OR.toUpperCase()},
        {"tit":"DESCRIPCIÓN DEL PERSONAJE O MOTIVO:","des":descripcion1.innerText.toUpperCase()},
        {"tit":"REFERENCIAS HISTÓRICAS DE LA OBRA:","des": referencia1.innerText.toUpperCase()},
        {"tit":"ESTADO DE CONSERVACIÓN:","des":$scope.datos.PTR_EST_CON.toUpperCase()},
        {"tit":"OBSERVACIONES:","des":$scope.datos.PTR_OBS.toUpperCase()},
        {"tit":"FUENTES:","des":fuente1.innerText.toUpperCase()}
      ];
      var doc = new jsPDF('p', 'pt');
      var header = function (data) {
        doc.addImage(inmaterial,'JPEG', 35, 40, 525, 60);
        doc.setTextColor(0);
        doc.setFontStyle('bold');
        doc.setFontSize(11);
        doc.text('FICHA DE REGISTRO DE ESCULTURAS',120,120);
        doc.setFontSize(9);
        doc.text('NRO. FICHA: ',400,120);
        doc.setFontStyle('normal');
        doc.text($scope.datos.PTR_NRO_FIC,470,120);
        doc.rect(390, 105, 170, 25);
      };
      var totalPagesExp = "{total_pages_count_string}";
      var numeropag = 0;
      var footer = function (data) {
        if(data.pageCount >= numeropag){
          numeropag = numeropag + 1;
        }
        var str = "Página " + numeropag;
        if (typeof doc.putTotalPages === 'function') {
          str = str + " de " + totalPagesExp;
        }
        doc.text(str, 470, doc.internal.pageSize.height - 45);
          doc.text("Para cualquier consulta, por favor comunicarse al Telefono. 2-2440746", 150, doc.internal.pageSize.height - 45);
      };
      doc.setFontSize(9);
      doc.setFontStyle('bold');
      doc.autoTable(columns.splice(0,2),data,{drawHeaderRow:function(){return false;},startY:130,pageBreak:'auto',theme:'plain',bodyStyles:{rowHeight:12,fontSize:8,valign:'middle'},margin:{horizontal:40,top:130,bottom:80},styles:{overflow:'linebreak'},columnStyles:{tit:{columnWidth:150,fontStyle:'bold'}}
    });
      doc.setFontSize(8);
       doc.text('FOTOGRAFIAS', 45,doc.autoTableEndPosY()+10);
      doc.text('FOTOGRAFIÁ FRENTE', 100,doc.autoTableEndPosY()+25);
      doc.addImage(frente, 'JPEG',60, doc.autoTableEndPosY()+30, 200, 190);
      doc.rect(60, doc.autoTableEndPosY()+30, 200, 190);
      doc.text('FOTOGRAFIÁ PERFIL', 340,doc.autoTableEndPosY()+25);
      doc.addImage(perfil, 'JPEG',300, doc.autoTableEndPosY()+30, 200, 190);
      doc.rect(300, doc.autoTableEndPosY()+30, 200, 190);
      doc.text('FOTOGRAFIÁ INCLUYENDO EL PEDESTAL Y PLACAS', 60,doc.autoTableEndPosY()+235);
      doc.addImage(pedestal, 'JPEG',60, doc.autoTableEndPosY()+240, 200, 190);
      doc.rect(60, doc.autoTableEndPosY()+240, 200, 190);
      doc.text('PLANO DE UBICACIÓN', 340,doc.autoTableEndPosY()+235);
      doc.addImage(plano, 'JPEG',300, doc.autoTableEndPosY()+240, 200, 190);
      doc.rect(300, doc.autoTableEndPosY()+240, 200, 190);
      doc.autoTable(columns2.splice(0,2), data2, {drawHeaderRow: function() {return false;},startY: doc.autoTableEndPosY()+440,pageBreak: 'auto',theme: 'mary',beforePageContent: header,afterPageContent: footer,bodyStyles: {rowHeight: 16, fontSize: 8, valign: 'top'},margin: {horizontal: 50, top: 135, bottom: 70},styles: {overflow: 'linebreak'},columnStyles: {tit: {columnWidth: 150,fontStyle: 'bold'}},drawRow: function (row, data) {doc.setFontStyle('bold'); doc.setFontSize(8);
        if (row.index === 0) {
          doc.autoTableText("I. LOCALIZACIÓN", 40, row.y + 10, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        } else if (row.index === 7) {

          doc.autoTableText("II. DATOS DEL AUTOR" , 40, row.y + 10, {
            halign: 'left',
            valign: 'botton'
          });
          data.cursor.y += 20;
        }  else if (row.index === 8) {

          doc.autoTableText("III. DATOS DE LA OBRA" , 40, row.y  + 10, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        } else if (row.index === 11) {

          doc.autoTableText("IV. DIMENCIONES DE LA OBRAA (SIN PEDESTAL)" , 40, row.y + 10, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        } else if (row.index === 16) {

          doc.autoTableText("V. REGIMEN DE PROPIEDAD" , 40, row.y  + 10, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        }   else if (row.index === 18) {

          doc.autoTableText("VI. PROTECCIÓN LEGAL" , 40, row.y  + 10, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        }  else if (row.index === 20) {

          doc.autoTableText("VII. REFERENCIAS DE LA OBRA" , 40, row.y  + 10, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        } else if (row.index === 22) {

          doc.autoTableText("VIII. ESTADO DE CONSERVACIÒN" , 40, row.y  + 10, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        }
      }});
      if (typeof doc.putTotalPages === 'function') {
        doc.putTotalPages(totalPagesExp);
      }
      //doc.save('monumento'+'.pdf');
        $('#visorFumm object').attr('data',doc.output('datauristring'));
        $("#divPopup8").modal('show');
      //data2 = tradicional = referencia1 = descripcion1 = fuente1 = obra1 = autor1 = columns = columns2 = data = null;
      //console.log(doc.output('datauristring'),"DOCUUU");
        //window.open(doc.output('datauristring'));
    })
    obj.error(function(error) {

    });
  };
  
  $scope.ejemplo1=function(hola,mapa){
    var resDatos = {
      "table_name":"_fr_casos",
      "filter": "cas_id="+hola
    };
    var obj=DreamFactory.api[CONFIG.SERVICE].getRecordsByFilter(resDatos);
    obj.success(function (response) {    
      $scope.datos=JSON.parse(response.record[0].cas_datos);
      var vector='';
      for(var i=0; i<9;i++){
        if($scope.datos.PTR_CRONO[i].estado){
          if(vector!=''){
            vector=vector+', '+$scope.datos.PTR_CRONO[i].resvalor;
          }
          else{
            vector=vector+$scope.datos.PTR_CRONO[i].resvalor;
          }
        }
      }
      var relbien1 = document.createElement('div');
      relbien1.innerHTML = $scope.datos.PTR_RELACION;

      var proviene = '';
      if($scope.datos.PTR_PROVIENE_C==='1'){
        proviene='CONTEXTO ARQUEOLÓGICO';
        var colprov = [
        {title: "Número", dataKey: "dos"},
        {title: "Coordenadas", dataKey: "tres"}
        ];
        var dataprov=[];
        for (var i=1; i<$scope.datos.PTR_UBIC_ANT.length;i++){
          var aporte = {"dos":$scope.datos.PTR_UBIC_ANT[i].f01_punto_des_,"tres":$scope.datos.PTR_UBIC_ANT[i].f01_veg_SFL_};          
          dataprov[i]=aporte;      
        }
      }
      else{
        if($scope.datos.PTR_PROVIENE_C==='3'){
          proviene=$scope.datos.PTR_PROVIENE;
        }
        else{
          proviene='COLECCIÓN';
        }
      }
      var columns = [
      {title: "primero", dataKey: "prim"},
      {title: "segundo", dataKey: "seg"},
      ];
      var data = [
      {"prim":"DENOMINACIÓN:","seg":proviene.toUpperCase()},
      {"prim":"CREADOR:","seg":$scope.datos.PTR_CREA}
      ];
      var colubic = [
      {title: "primero", dataKey: "prim"},
      {title: "segundo", dataKey: "seg"}
      ];
      var dataubic = [
      {"prim":"UBICACIÓN ACTUAL:","seg":$scope.datos.PTR_UBIC_ACT.toUpperCase()},
      {"prim":"RELACION DEL BIEN O PIEZA CON EL YACIMIENTO:","seg":relbien1.innerText.toUpperCase()}
      ];
      var colbien = [
      {title: "primero", dataKey: "prim"}
      ];
      var databien = [
      {"prim":$scope.datos.PTR_DESC_BIEN.toUpperCase()}
      ];
      var colmat = [
      {title: "primero", dataKey: "prim"}
      ];
      var datamat = [
      {"prim":$scope.datos.PTR_MATERIAL.toUpperCase()}
      ];
      var coltec = [
      {title: "primero", dataKey: "prim"}
      ];
      var datatec = [
      {"prim":$scope.datos.PTR_TECN.toUpperCase()}
      ];  
      var colmanu = [
      {title: "primero", dataKey: "prim"}
      ];
      var datamanu = [
      {"prim":$scope.datos.PTR_MANF.toUpperCase()}    
      ];
      var coldeco = [
      {title: "primero", dataKey: "prim"}
      ];
      var datadeco = [
      {"prim":$scope.datos.PTR_DECOR.toUpperCase()}   
      ];
      var colatri = [
      {title: "primero", dataKey: "prim"}
      ];
      var dataatri = [
      {"prim":$scope.datos.PTR_ATRIB.toUpperCase()}    
      ];
      var coldown = [
      {title: "primero", dataKey: "prim"},
      {title: "segundo", dataKey: "seg"}
      ];
      if($scope.datos.PTR_EST_CONS ==-1)
        {$scope.datos.PTR_EST_CONS =" ";} 
      var datadown = [
      {"prim":"ESTADO DE CONSERVACIÓN:","seg":$scope.datos.PTR_EST_CONS.toUpperCase()},
      {"prim":"DESCRIPCIÓN DEL ESTADO:","seg":$scope.datos.PTR_DESC_ESTADO.toUpperCase()},
      {"prim":"OBSERVACIONES:","seg":$scope.datos.PTR_OBS.toUpperCase()},
      {"prim":"CRONOLOGÍA:","seg":vector.toUpperCase()},
      {"prim":"FUNCIÓN:","seg":$scope.datos.PTR_FUNC.toUpperCase()},
      {"prim":"OBSERVACIONES:","seg":$scope.datos.PTR_OBS_FUNC.toUpperCase()}          
      ]; 

      var doc = new jsPDF('p', 'pt');
      var columnsLong = columns;
      var header = function (data) {
       doc.addImage(material,'JPEG', 35, 40, 525, 60);
        doc.setTextColor(0);
        doc.setFontStyle('bold');
        doc.setFontSize(11);
        doc.text('FICHA DE CATALOGACIÓN DE MUEBLES ARQUEOLOGICOS',60,120);
        doc.setFontSize(9);
        doc.text('NRO. FICHA: ',400,120);
        doc.setFontStyle('normal');
        doc.text($scope.datos.PTR_COD,470,120);
        doc.rect(390, 105, 170, 25);
      };
      var totalPagesExp = "{total_pages_count_string}";
      var numeropag = 0;
      var footer = function (data) {
        if(data.pageCount >= numeropag){
          numeropag = numeropag + 1;
        }
        var str = "Página " + numeropag;
        if (typeof doc.putTotalPages === 'function') {
          str = str + " de " + totalPagesExp;
        }
        doc.text(str, 470, doc.internal.pageSize.height - 45);
          doc.text("Para cualquier consulta, por favor comunicarse al Telefono. 2-2440746", 150, doc.internal.pageSize.height - 45);
      };
      doc.setFontSize(9);
      doc.setFontStyle('bold');
      doc.text('INFORMACIÓN GENERAL',40,140);
      doc.autoTable(columns.splice(0,4), data, {drawHeaderRow: function() {return false;} , startY: 155, pageBreak: 'auto',theme: 'mary',bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},beforePageContent: header,afterPageContent: footer,margin: {horizontal: 35, top: 110, bottom: 80},styles: {overflow: 'linebreak'},columnStyles: {prim: {columnWidth: 160,fontStyle: 'bold',fontSize: 9}}
      });
      doc.setFontSize(9);
      doc.setFontStyle('bold');
      doc.text('CONTEXTO ORIGINAL:',40,doc.autoTableEndPosY() +20);
      var m=doc.autoTableEndPosY()+30;
      if($scope.datos.PTR_PROVIENE_C==='1'){
        doc.setFontSize(9);
        doc.setFontStyle('bold');
        doc.text('UBICACIÓN GEOGRAFICA UTM',40,m+5);
        doc.autoTable(colprov, dataprov,{theme: 'mary',startY: m+10,headerStyles: {fontStyle: 'bold', rowHeight: 12, fontSize: 8, valign: 'middle'},bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 35, top: 110, bottom: 80},styles: {overflow: 'linebreak'}, pageBreak: 'auto'});
        m=doc.autoTableEndPosY()+15;
      }

      doc.autoTable(colubic.splice(0,2), dataubic,{drawHeaderRow: function() {return false;},
        theme: 'mary',startY: m,bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 35, top: 110, bottom: 80},styles: {overflow: 'linebreak'}, pageBreak: 'auto',columnStyles: {prim: {columnWidth: 160,fontStyle: 'bold'}}
      });
      doc.setFontSize(9);
      doc.setFontStyle('bold');
      doc.text('DESCRIPCIÓN DEL BIEN MUEBLE',40,doc.autoTableEndPosY() +15);
      doc.autoTable(colbien.splice(0,1), databien,{drawHeaderRow: function() {return false;},theme: 'mary',startY: doc.autoTableEndPosY() +20,bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 35, top: 110, bottom: 80},styles: {overflow: 'linebreak'}, pageBreak: 'auto',});
      doc.setFontSize(9);
      doc.setFontStyle('bold');
      doc.text('MATERIAL',40,doc.autoTableEndPosY() +15);
      doc.autoTable(colmat.splice(0,1), datamat,{drawHeaderRow: function() {return false;},
        theme: 'mary',startY: doc.autoTableEndPosY() +20,bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 35, top: 110, bottom: 80},styles: {overflow: 'linebreak'}, pageBreak: 'auto',
      });
      doc.setFontSize(9);
      doc.setFontStyle('bold');
      doc.text('TECNICA',40,doc.autoTableEndPosY() +15);
      doc.autoTable(coltec.splice(0,1), datatec,{drawHeaderRow: function() {return false;},
        theme: 'mary',startY: doc.autoTableEndPosY() +20,bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 35, top: 110, bottom: 80},styles: {overflow: 'linebreak'}, pageBreak: 'auto',
      });
      doc.setFontSize(9);
      doc.setFontStyle('bold');;
      doc.text('MANUFACTURA',40,doc.autoTableEndPosY() +15);
      doc.autoTable(colmanu.splice(0,1), datamanu,{drawHeaderRow: function() {return false;},
        theme: 'mary',startY: doc.autoTableEndPosY() +20,bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 35, top: 110, bottom: 80},styles: {overflow: 'linebreak'}, pageBreak: 'auto',
      });
      doc.setFontSize(9);
      doc.setFontStyle('bold');
      doc.text('DECORACIÓN',40,doc.autoTableEndPosY() +15);
      doc.autoTable(coldeco.splice(0,1), datadeco,{drawHeaderRow: function() {return false;},
        theme: 'mary',startY: doc.autoTableEndPosY() +20,bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 35, top: 110, bottom: 80},styles: {overflow: 'linebreak'}, pageBreak: 'auto',
      });
      doc.setFontSize(9);
      doc.setFontStyle('bold');
      doc.text('DESCRIPCIÓN DE LOS ATRIBUTOS',40,doc.autoTableEndPosY() +15);
      doc.autoTable(colatri.splice(0,1), dataatri,{drawHeaderRow: function() {return false;},
        theme: 'mary',startY: doc.autoTableEndPosY() +20,bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 35, top: 110, bottom: 80},styles: {overflow: 'linebreak'}, pageBreak: 'auto',
      });
      doc.autoTable(coldown.splice(0,4), datadown, {drawHeaderRow: function() {return false;} ,
        startY:doc.autoTableEndPosY() +10, pageBreak: 'auto',theme: 'mary',bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 35, top: 110, bottom: 80},styles: {overflow: 'linebreak'},columnStyles: {prim: {columnWidth: 160,fontStyle: 'bold',fontSize: 9}}
      });
      doc.addPage(790, 591);
      doc.addImage(material,'JPEG', 35, 35, 725, 60);
      doc.setTextColor(0);
      doc.setFontStyle('bold');
      doc.setFontSize(11);
      doc.text('FICHA DE CATALOGACIÓN DE MUEBLES ARQUEOLOGICOS',40,110);
      doc.text('NRO. FICHA: ',600,120);
      doc.setFontStyle('normal');
      doc.text($scope.datos.PTR_COD,670,120);
      doc.rect(590, 105, 170, 25);
      doc.setFontSize(9);
      doc.setFontStyle('bold');
      doc.text('UBICACIÓN:',40,130);
      doc.addImage(mapa,'JPEG', 40, 140, 700, 420);
      if (typeof doc.putTotalPages === 'function') {
        doc.putTotalPages(totalPagesExp);
      }
      console.log()
        $('#visorFumm object').attr('data',doc.output('datauristring'));
        $("#divPopup8").modal('show'); 
    })
    obj.error(function(error) {
    });
  };
  $scope.ejemplo2=function(hola,mapa){
    console.log(hola);
    var resDatos = {
      "table_name":"_fr_casos",
      "filter": "cas_id="+hola
    };
    var obj=DreamFactory.api[CONFIG.SERVICE].getRecordsByFilter(resDatos);
    obj.success(function (response) {    
      $scope.datos=JSON.parse(response.record[0].cas_datos);


      var vector='';
      for(var i=0; i<$scope.datos.PTR_IA_EST_CONS.length;i++){
        if($scope.datos.PTR_IA_EST_CONS[i].estado){
          if(vector!=''){
            vector=vector+', '+$scope.datos.PTR_IA_EST_CONS[i].resvalor;
          }
          else{
            vector=vector+$scope.datos.PTR_IA_EST_CONS[i].resvalor;
          }
        }
      }
      var tafo='';
      for(var i=0; i<$scope.datos.PTR_IA_TAFON.length ;i++){
        if($scope.datos.PTR_IA_TAFON[i].estado){
          if(tafo!=''){
            tafo=tafo+', '+$scope.datos.PTR_IA_TAFON[i].resvalor;
          }
          else{
            tafo=tafo+$scope.datos.PTR_IA_TAFON[i].resvalor;
          }
        }
      }
      var elemento='';
      for(var i=0; i<$scope.datos.PTR_IA_ELEM_MUEBLE.length;i++){
        if($scope.datos.PTR_IA_ELEM_MUEBLE[i].estado){
          if(elemento!=''){
            elemento=elemento+', '+$scope.datos.PTR_IA_ELEM_MUEBLE[i].resvalor;
          }
          else{
            elemento=elemento+$scope.datos.PTR_IA_ELEM_MUEBLE[i].resvalor;
          }
        }
      }
      var inter='';
      for(var i=0; i<$scope.datos.PTR_IA_TIP_INTER.length;i++){
        if($scope.datos.PTR_IA_TIP_INTER[i].estado){
          if(inter!=''){
            inter=inter+', '+$scope.datos.PTR_IA_TIP_INTER[i].resvalor;
          }
          else{
            inter=inter+$scope.datos.PTR_IA_TIP_INTER[i].resvalor;
          }
        }
      }
      var element='';
      for(var i=0; i<$scope.datos.PTR_IA_ELEM_INM.length;i++){
        if($scope.datos.PTR_IA_ELEM_INM[i].estado){
          if(element!=''){
            element=element+', '+$scope.datos.PTR_IA_ELEM_INM[i].resvalor;
          }
          else{
            element=element+$scope.datos.PTR_IA_ELEM_INM[i].resvalor;
          }
        }
      }
      var muebles='';
      for(var i=0; i<$scope.datos.PTR_IA_ELEM_MUEB.length;i++){
        if($scope.datos.PTR_IA_ELEM_MUEB[i].estado){
          if(muebles!=''){
            muebles=muebles+', '+$scope.datos.PTR_IA_ELEM_MUEB[i].resvalor;
          }
          else{
            muebles=muebles+$scope.datos.PTR_IA_ELEM_MUEB[i].resvalor;
          }
        }
      }
      var cronologia='';
      for(var i=0; i<$scope.datos.PTR_CRONO.length;i++){
        if($scope.datos.PTR_CRONO[i].estado){
          if(cronologia!=''){
            cronologia=cronologia+', '+$scope.datos.PTR_CRONO[i].resvalor;
          }
          else{
            cronologia=cronologia+$scope.datos.PTR_CRONO[i].resvalor;
          }
        }
      }
      var funcionalidad='';
      for(var i=0; i<$scope.datos.PTR_IA_FUNC.length;i++){
        if($scope.datos.PTR_IA_FUNC[i].estado){
          if(funcionalidad!=''){
            funcionalidad=funcionalidad+', '+$scope.datos.PTR_IA_FUNC[i].resvalor;
          }
          else{
            funcionalidad=funcionalidad+$scope.datos.PTR_IA_FUNC[i].resvalor;
          }
        }
      }
      var columns = [
      {title: "primero", dataKey: "prim"},
      {title: "segundo", dataKey: "seg"},
      ];
      var data = [
      {"prim":"DENOMINACIÓN:","seg":$scope.datos.PTR_PROVIENE},
      {"prim":"CREADOR:","seg":$scope.datos.PTR_CREA}
      ];

      var columns2 = [
      {title: "primero", dataKey: "prim"},
      {title: "segundo", dataKey: "seg"}
      ];
      var data2 = [
      {"prim":"PUNTO DE UBICACIÓN EN EL MUNICIPIO:","seg":$scope.datos.PTR_MUNI.toUpperCase()},
      {"prim":"UBICACIÓN MACRODISTRITO:","seg":$scope.datos.PTR_MACRO.toUpperCase()},
      {"prim":"UBICACIÓN LOCAL:","seg":$scope.datos.PTR_LUG.toUpperCase()},
      {"prim":"UBICACIÓN ESPECÍFICA DEL POLIGONO:","seg":$scope.datos.PTR_IA_POLIG.toUpperCase()}      
      ];  
      var colprov = [
      {title: "Número", dataKey: "dos"},
      {title: "Coordenadas", dataKey: "tres"}
      ];
      var dataprov=[];
      for (var i=1; i<$scope.datos.PTR_IA_UBIC.length;i++){
        var aporte = {"dos":$scope.datos.PTR_IA_UBIC[i].f01_punto_des_,"tres":$scope.datos.PTR_IA_UBIC[i].f01_veg_SFL_};          
        dataprov[i]=aporte;      
      }  
      var columns3 = [
      {title: "primero", dataKey: "prim"}
      ];
      var data3 = [
      {"prim":$scope.datos.PTR_IA_DESC_URB.toUpperCase()}
      ];  

      var columns4 = [
      {title: "primero", dataKey: "prim"}
      ];
      var data4 = [
      {"prim":$scope.datos.PTR_IA_DESC_RUR.toUpperCase()}
      ];
     
      if($scope.datos.PTR_IA_YACIM ==-1)
        {$scope.datos.PTR_IA_YACIM =" ";}
        else if($scope.datos.PTR_IA_YACIM =='Otros')
        {$scope.datos.PTR_IA_YACIM =$scope.datos.PTR_IA_YACIM_O;} 
      
      var columns6 = [
      {title: "primero", dataKey: "prim"},
      {title: "segundo", dataKey: "seg"}
      ];

      if($scope.datos.PTR_IA_DESC_ELEM_INM ==-1)
        {$scope.datos.PTR_IA_DESC_ELEM_INM_VALOR =" ";}
      else if ($scope.datos.PTR_IA_DESC_ELEM_INM_VALOR =='Otros'){
          $scope.datos.PTR_IA_DESC_ELEM_INM_VALOR =$scope.datos.PTR_IA_DESC_ELEM_INM_OTRO;
        } 
      var data6 = [
      {"prim":"DESCRIPCIÓN DE LOS ELEMENTOS INMUEBLES:","seg":$scope.datos.PTR_IA_DESC_ELEM_INM_VALOR.toUpperCase()}, 
      {"prim":"ESTADO DE CONSERVACIÓN:","seg":vector.toUpperCase()}, 
      {"prim":"DESCRIPCIÓN DEL ESTADO:","seg":$scope.datos.PTR_IA_DESC_EST_CONS.toUpperCase()},
      {"prim":"OBSERVACIONES:","seg":$scope.datos.PTR_IA_OBS_EST.toUpperCase()},
      {"prim":"TAFONOMIA:","seg":tafo.toUpperCase()},
      {"prim":"DESCRIPCIÓN DE TAFONOMIA:","seg":$scope.datos.PTR_IA_TAFON_DESC.toUpperCase()},
      {"prim":"PRESENCIA DE ELEMENTO:","seg":elemento.toUpperCase()},
      {"prim":"DESCRIPCIÓN:","seg":$scope.datos.PTR_IA_ELEM_MUEB_DESC.toUpperCase()},
      {"prim":"CRONOLÓGIA:","seg":cronologia.toUpperCase()},
      {"prim":"DESCRIPCIÓN DE CRONOLÓGIA:","seg":$scope.datos.PTR_CRONO_DESC.toUpperCase()},      
      {"prim":"FUNCIONALIDAD:","seg":funcionalidad.toUpperCase()},      
      {"prim":"TAMAÑO DEL SITIO O YACIMIENTO:","seg":$scope.datos.PTR_IA_TAM_YACIM.toUpperCase()},
      {"prim":"EVALUACIÓN DEL SUBSUELO:","seg":$scope.datos.PTR_IA_TAM_YACIM.toUpperCase()},
      {"prim":"TIPO DE INTERVENCIÓN:","seg":inter.toUpperCase()},
      {"prim":"NÚMERO DE POZOS:","seg":$scope.datos.PTR_IA_NUM_POZ.toUpperCase()},
      {"prim":"ÁREA DE INTERVENCIÓN:","seg":$scope.datos.PTR_IA_AR_INTER.toUpperCase()},
      {"prim":"PROFUNDIDAD MINIMA(cm):","seg":$scope.datos.PTR_IA_PROF_MIN.toUpperCase()},
      {"prim":"PROFUNDIDAD MÁXIMA(cm)","seg":$scope.datos.PTR_IA_PROF_MAX.toUpperCase()},
      {"prim":"ELEMENTOS INMUEBLES:","seg":element.toUpperCase()},
      {"prim":"ELEMENTOS MUEBLES:","seg":muebles.toUpperCase()},
      {"prim":"OBSERVACIONES:","seg":$scope.datos.PTR_IA_OBS.toUpperCase()}    
      ];
     
      var doc = new jsPDF('p', 'pt');
      var columnsLong = columns;

      var header = function (data) {
        doc.addImage(material,'JPEG', 35, 40, 525, 60);
        doc.setTextColor(0);
        doc.setFontStyle('bold');
        doc.setFontSize(9);
        doc.text('FICHA DE CATALOGACIÓN DE YACIMIENTOS ARQUEOLOGICOS',40,120);
        doc.text('NRO. FICHA: ',400,120);
        doc.setFontStyle('normal');
        doc.text($scope.datos.PTR_COD,470,120);
        doc.rect(390, 105, 170, 25);
      };
      var totalPagesExp = "{total_pages_count_string}";
      var numeropag = 0;
      var footer = function (data) {
        if(data.pageCount >= numeropag){
          numeropag = numeropag + 1;
        }
        var str = "Página " + numeropag;
        if (typeof doc.putTotalPages === 'function') {
          str = str + " de " + totalPagesExp;
        }
        doc.text(str, 470, doc.internal.pageSize.height - 45);
          doc.text("Para cualquier consulta, por favor comunicarse al Telefono. 2-2440746", 150, doc.internal.pageSize.height - 45);
      };
      doc.setFontSize(9);
      doc.setFontStyle('bold');
      doc.text('INFORMACIÓN GENERAL',40,130);
      doc.autoTable(columns.splice(0,4), data, {drawHeaderRow: function() {return false;} ,startY: 140, pageBreak: 'auto',theme: 'mary',bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {top: 110, bottom: 80},styles: {overflow: 'linebreak'},columnStyles: {prim: {columnWidth: 170,fontStyle: 'bold'}}});
      doc.setFontSize(9);
      doc.setFontStyle('bold');
      doc.text('CONTEXTO ORIGINAL:',40,doc.autoTableEndPosY() +20);
      doc.autoTable(colprov, dataprov,{theme: 'mary',startY: doc.autoTableEndPosY() +25,headerStyles: {fontStyle: 'bold', rowHeight: 12, fontSize: 8, valign: 'middle'},columnStyles: {dos: {columnWidth: 170}}, bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},styles: {overflow: 'linebreak'}, pageBreak: 'auto'});
      doc.setFontSize(9);
      doc.setFontStyle('bold');
      doc.text('UBICACIÓN GEOGRAFICA UTM:',40,doc.autoTableEndPosY() +10);
      doc.autoTable(columns2.splice(0,2), data2,  {drawHeaderRow: function() {return false;},theme: 'mary',startY: doc.autoTableEndPosY() +20,headerStyles: {fontStyle: 'bold', rowHeight: 12, fontSize: 8, valign: 'middle'},bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},styles: {overflow: 'linebreak'},columnStyles: {prim: {columnWidth: 170,fontStyle: 'bold'}}, pageBreak: 'auto'});
      doc.setFontSize(9);
      doc.setFontStyle('bold');
      doc.text('RELACIÓN DEL SITIO O YACIMIENTO CON OTRAS ÁREAS',40,doc.autoTableEndPosY() +15);
      doc.setFontSize(8);
      doc.setFontStyle('bold');
      doc.text('DESCRIPCIÓN DEL CONTEXTO INMEDIATO EN AREA URBANA',40,doc.autoTableEndPosY() +30);
      doc.text('DESCRIPCIÓN DEL CONTEXTO INMEDIATO EN AREA RURAL',300,doc.autoTableEndPosY() +30);
      var a=doc.autoTableEndPosY() +35;
      doc.autoTable(columns3.splice(0,2), data3,  {drawHeaderRow: function() {return false;},theme: 'mary',startY: a,bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},margin: { right: 305},styles: {overflow: 'linebreak'}});
      doc.autoTable(columns4.splice(0,1), data4,  {drawHeaderRow: function() {return false;},theme: 'mary',startY: a,bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {left: 305},styles: {overflow: 'linebreak'}});
      doc.setFontSize(9);
      doc.setFontStyle('bold');
      doc.text('UBICACIÓN GEOMORFOLOGICA',40,doc.autoTableEndPosY()+20);
      doc.setFontSize(8);
      doc.text('DESCRIPCIÓN GENERAL DEL YACIMIENTO',40,doc.autoTableEndPosY()+30);
      doc.setFontSize(8);
      doc.setFontStyle('normal');
      if($scope.datos.PTR_IA_YACIM_VALOR == "Otros")
        $scope.datos.PTR_IA_YACIM_VALOR = $scope.datos.PTR_IA_YACIM_OTRO;
      doc.text($scope.datos.PTR_IA_YACIM_VALOR,40,doc.autoTableEndPosY()+40);
      doc.setFontSize(9);
      doc.setFontStyle('bold');
      doc.text('EVALUACIÓN SUPERFICIAL',40,doc.autoTableEndPosY() +55);
      doc.autoTable(columns6.splice(0,2), data6, {drawHeaderRow: function() {return false;} ,
        startY: doc.autoTableEndPosY() +60,pageBreak: 'auto',theme: 'mary',beforePageContent: header,afterPageContent: footer,bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 40, top: 135, bottom: 60},styles: {overflow: 'linebreak'},columnStyles: {prim: {columnWidth: 170,fontStyle: 'bold'}}});
      doc.addPage(790, 591);
      doc.addImage(material,'JPEG', 35, 35, 725, 60);
      doc.setTextColor(0);
      doc.setFontStyle('bold');
      doc.setFontSize(11);
      doc.text('FICHA DE CATALOGACIÓN DE YACIMIENTOS ARQUEOLOGICOS',40,110);
      doc.text('NRO. FICHA: ',600,120);
      doc.setFontStyle('normal');
      doc.text($scope.datos.PTR_COD,670,120);
      doc.rect(590, 105, 170, 25);
      doc.setFontSize(9);
      doc.setFontStyle('bold');
      doc.text('UBICACIÓN:',40,130);
      doc.addImage(mapa,'JPEG', 40, 140, 700, 420);
     
      if (typeof doc.putTotalPages === 'function') {
        doc.putTotalPages(totalPagesExp);
      }
      //doc.save('arqueologia'+'.pdf'); 
        $('#visorFumm object').attr('data',doc.output('datauristring'));
        $("#divPopup8").modal('show');
      console.log("HELLO");
        //window.open(doc.output('datauristring'));  
    })
    obj.error(function(error) {                
    });
  };
  $scope.ficha = function(idfrcasos,nro) {
    var resDatos = {
      "table_name":"_fr_casos",
      "filter": "cas_id="+idfrcasos
    };
    var obj=DreamFactory.api[CONFIG.SERVICE].getRecordsByFilter(resDatos);
    obj.success(function (response) {
      $scope.datos=response.record[0].cas_nro_caso;
      var reslocal = {
        "procedure_name":"ejecutartojson",
        "body":{
          "params": [
          {
            "name":"expression",

            "param_type":"IN","value":"select doc_url_logica,doc_correlativo, doc_datos, doc_nombre from dms_gt_documentos where doc_proceso = '"+ $scope.procesonro+"' and doc_estado = 'A' and doc_id ="+$scope.datos
          }]
        }
      };
      var obj=DreamFactory.api[CONFIG.SERVICE].callStoredProcWithParams(reslocal);
      obj.success(function (respons) {
        $scope.url = JSON.parse(respons[0].ejecutartojson)
        var pic =[];
        pic[0] ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAFCAYAAACJmvbYAAAABHNCSVQICAgIfAhkiAAAABl0RVh0U29mdHdhcmUAZ25vbWUtc2NyZWVuc2hvdO8Dvz4AAAAVSURBVAiZY/z///9/BhyACZcEDSUBO0oEBrFgibAAAAAASUVORK5CYII=";
        var k =0;
        var j=0;
        var n = 1;
        if($scope.url == null){
          if(nro == '2')
                $scope.ejemplo2(idfrcasos,pic[0]); 
          else     
                $scope.ejemplo1(idfrcasos,pic[0]); 
          }
          else{
        for(var i=0;i<$scope.url.length ;i++){
          var a= $scope.url[i].doc_nombre;
          var imga = $scope.url[i].doc_url_logica;
          imga = imga.replace(/Ñ/gi,"%d1");
          imga = imga.replace(/ñ/gi,"%f1");
          imga = imga.replace(/Á/gi,"%c1");
          imga = imga.replace(/á/gi,"%e1");
          imga = imga.replace(/É/gi,"%c9");
          imga = imga.replace(/é/gi,"%e9");
          imga = imga.replace(/Í/gi,"%cd");
          imga = imga.replace(/í/gi,"%ed");
          imga = imga.replace(/Ó/gi,"%d3");
          imga = imga.replace(/ó/gi,"%f3");
          imga = imga.replace(/Ú/gi,"%da");
          imga = imga.replace(/ú/gi,"%fa");
          imga = imga.replace(/ /gi,"%20");
          imga = imga.replace(/“/gi,"%93");
          imga = imga.replace(/”/gi,"%94");
          imga = imga.replace(/&/gi,"%26");
          imga = imga.replace(/\\/gi,"/");
          if($scope.url[i].doc_correlativo == 1){
            k++;
            var img = new Image();
            img.crossOrigin = 'Anonymous';
            img.src = imga;
            img.onload = function(){ 
                var canvas = document.createElement('CANVAS');
                var ctx = canvas.getContext('2d');
                canvas.height = img.height;
                canvas.width = img.width;
                ctx.drawImage(img, 0, 0);      
                pic[0] = canvas.toDataURL("image/jpeg",0.1);
              j++;
              if(j == n){
                if(nro == '2')
                  $scope.ejemplo2(idfrcasos,pic[0]); 
                else     
                  $scope.ejemplo1(idfrcasos,pic[0]); 
              }
            }
            img.onerror = function(){
              sweet.show('Error de Carga de Imagen', a, 'error');
            } 
          }
          if($scope.url.length == i+1 && k==0){
            if(nro == '2')
                $scope.ejemplo2(idfrcasos,pic[0]); 
            else     
                $scope.ejemplo1(idfrcasos,pic[0]); 
          }

          if($scope.url.length == i+1){
            n=k;
          }
        }
      }
      })
      obj.error(function(error) {
      });
      })
    obj.error(function(error) {
    });
  };  
  
  $scope.espacios=function(hola,image1){
    var resDatos = {
      "table_name":"_fr_casos",
      "filter": "cas_id="+hola
    };
    var obj=DreamFactory.api[CONFIG.SERVICE].getRecordsByFilter(resDatos);
    obj.success(function (response) {    
      $scope.datos=JSON.parse(response.record[0].cas_datos);

      var materiales='';
      for(var i=0; i<10;i++){
        if($scope.datos.PTR_MURMAT[i].estado){
          if(materiales!=''){
            materiales=materiales+', '+$scope.datos.PTR_MURMAT[i].resvalor;
          }
          else{
            materiales=materiales+$scope.datos.PTR_MURMAT[i].resvalor;
          }
        }
      }
      var danos='';
      for(var i=0; i<6;i++){
        if($scope.datos.PTR_PATODAN[i].estado){
          if(danos!=''){
            danos=danos+', '+$scope.datos.PTR_PATODAN[i].resvalor;
          }
          else{
            danos=danos+$scope.datos.PTR_PATODAN[i].resvalor;
          }
        }
      }
      var parcial='';
      var panoramica='';
      if($scope.datos.PTR_VISTAS !=  undefined){
        if($scope.datos.PTR_VISTAS[0].estado){
          parcial = 'SI';
        }else {
          parcial = 'NO';
        }
        if($scope.datos.PTR_VISTAS[1].estado){
          panoramica = 'SI';
        }else {
          panoramica = 'NO';
        }
      }
      var other='';
      for(var i=0; i<3;i++){
        if($scope.datos.PTR_OTHER[i].estado){
          if(other!=''){
            other=other+', '+$scope.datos.PTR_OTHER[i].resvalor;
          }
          else{
            other=other+$scope.datos.PTR_OTHER[i].resvalor;
          }
        }
      }
      var causas='';
      for(var i=0; i<8;i++){
        if($scope.datos.PTR_PATOCAU[i].estado){
          if(causas!=''){
            causas=causas+', '+$scope.datos.PTR_PATOCAU[i].resvalor;
          }
          else{
            causas=causas+$scope.datos.PTR_PATOCAU[i].resvalor;
          }
        }
      }
      var preex1 = document.createElement('div');
      preex1.innerHTML = $scope.datos.PTR_PREEX; 
      var uso1 = document.createElement('div');
      uso1.innerHTML = $scope.datos.PTR_USOORG; 
      var hecho1 = document.createElement('div');
      hecho1.innerHTML = $scope.datos.PTR_HECHIS;
      var fiestas1 = document.createElement('div');
      fiestas1.innerHTML = $scope.datos.PTR_FIEREL;
      var histor1 = document.createElement('div');
      histor1.innerHTML = $scope.datos.PTR_DATHISC;
      var fuent1 = document.createElement('div');
      fuent1.innerHTML = $scope.datos.PTR_FUENTE;
      var preex1d = document.createElement('div');
      preex1d.innerHTML = $scope.datos.PTR_PREDIN;
      var uso1d = document.createElement('div');
      uso1d.innerHTML = $scope.datos.PTR_USOPREEX;
      var hecho1d = document.createElement('div');
      hecho1d.innerHTML = $scope.datos.PTR_HECHISD;
      var fiestas1d = document.createElement('div');
      fiestas1d.innerHTML = $scope.datos.PTR_FIERELD;
      var histor1d = document.createElement('div');
      histor1d.innerHTML = $scope.datos.PTR_DATHISTC;
      var fuentes1d = document.createElement('div');
      fuentes1d.innerHTML = $scope.datos.PTR_FUENTBIO;
      var espconj1 = document.createElement('div');
      espconj1.innerHTML = $scope.datos.PTR_INSCR;
      var espcon1 = document.createElement('div');
      espcon1.innerHTML = $scope.datos.PTR_ELEMVISID;
      var intrea1 = document.createElement('div');
      intrea1.innerHTML = $scope.datos.PTR_ELEMVISAL;
      var cartec1 = document.createElement('div');
      cartec1.innerHTML = $scope.datos.PTR_ELEMVISAB;
      var carico1 = document.createElement('div');
      carico1.innerHTML = $scope.datos.PTR_DESENTEI;
      var dathis1 = document.createElement('div');
      dathis1.innerHTML = $scope.datos.PTR_DESENTEI;
      var refeBib1 = document.createElement('div');
      refeBib1.innerHTML = $scope.datos.PTR_INFOBS;
      var obs1 = document.createElement('div');
      obs1.innerHTML = $scope.datos.PTR_PATOOBS;
      var coldato1 = [
      {title: "primero", dataKey: "prim"},
      {title: "segundo", dataKey: "seg"},
      {title: "tercero", dataKey: "ter"},
      {title: "cuarto", dataKey: "cuar"}
      ];
      var datadato1 = [
      {"prim":"Codigo de Catastro:","seg":$scope.datos.PTR_COD_CAT,"ter":"Georeferencia","cuar":$scope.datos.PTR_GEOREF}
      ];
       var coldato2 = [
        {title: "Nro", dataKey: "uno"},
        {title: "Punto Colineal", dataKey: "dos"}
        ];
        var datadato2=[];
      if($scope.datos.PTR_DOT_S != undefined){       
        for (var i=1; i<$scope.datos.PTR_DOT_S.length;i++){
          var aporte = {"uno":"P. Colineal "+i ,"dos":$scope.datos.PTR_DOT_S[i].f01_Pto_Colineal};          
          datadato2[i]=aporte;      
        }
      }
      var coldato = [
      {title: "primero", dataKey: "prim"},
      {title: "segundo", dataKey: "seg"},
      {title: "tercero", dataKey: "ter"},
      {title: "cuarto", dataKey: "cuar"}
      ];

      if($scope.datos.PTR_REPRO ==-1)
        {$scope.datos.PTR_REPRO =" ";} 

      if($scope.datos.PTR_MACRO ==-1)
        {$scope.datos.PTR_MACRO =" ";} 
      var datadato = [      
      {"prim":"Tradicional:","seg":$scope.datos.PTR_TRAD,"ter":"Actual:","cuar":$scope.datos.PTR_ACT},
      {"prim":"Departamento:","seg":$scope.datos.PTR_DEP,"ter":"Dirección:","cuar":$scope.datos.PTR_DIR},
      {"prim":"Municipio:","seg":$scope.datos.PTR_MUN,"ter":"Esq. o Entre Calles 1","cuar":$scope.datos.PTR_ESQ1},
      {"prim":"Ciudad/Poblado:","seg":$scope.datos.PTR_CIPO,"ter":"Esq. o Entre Calles 2","cuar":$scope.datos.PTR_ESQ2},
      {"prim":"Macro-distrito:","seg":$scope.datos.PTR_MACRO,"ter":"Altitud(m.s.n.m.)","cuar":$scope.datos.PTR_ALT},
      {"prim":"Barrio:","seg":$scope.datos.PTR_BARR,"ter":" ","cuar":" "},
      {"prim":"Nombre Propietario:","seg":$scope.datos.PTR_NOMPRO,"ter":"Propiedad","cuar":$scope.datos.PTR_REPRO},
      ];
      var colepo = [
      {title: "primero", dataKey: "prim"},
      {title: "segundo", dataKey: "seg"},
      {title: "tercero", dataKey: "ter"},
      {title: "cuarto", dataKey: "cuar"}
      ];
      if($scope.datos.PTR_MUREST ==-1)
        {$scope.datos.PTR_MUREST =" ";}

      if($scope.datos.PTR_EPOCA ==-1)
        {$scope.datos.PTR_EPOCA =" ";}

      if($scope.datos.PTR_ESTILO ==-1)
        {$scope.datos.PTR_ESTILO =" ";}
      if($scope.datos.PTR_UBICESP ==-1)
        {$scope.datos.PTR_UBICESP =" ";}
      if($scope.datos.PTR_LINCONS ==-1)
        {$scope.datos.PTR_LINCONS =" ";}
      if($scope.datos.PTR_TIPOLO ==-1)
        {$scope.datos.PTR_TIPOLO =" ";}
      if($scope.datos.PTR_MURINTE ==-1)
        {$scope.datos.PTR_MURINTE =" ";}
      var dataepo = [
      {"prim":"Época:","seg":$scope.datos.PTR_EPOCA,"ter":"Año de Construcción:","cuar":$scope.datos.PTR_ACONS},
      {"prim":"Ultima Remo-delación:","seg":$scope.datos.PTR_AULTR,"ter":" ","cuar":" "},
      {"prim":"Estilo:","seg":$scope.datos.PTR_ESTILO,"ter":" ","cuar":" "},
      {"prim":"Ubicación del Espacio en el Area:","seg":$scope.datos.PTR_UBICESP,"ter":"Linea de Construcción","cuar":$scope.datos.PTR_LINCONS},
      {"prim":"Tipológia:","seg":$scope.datos.PTR_TIPOLO,"ter":" ","cuar":" "},
      {"prim":"Materiales:","seg":materiales,"ter":"Integridad:","cuar":$scope.datos.PTR_MURINTE},
      {"prim":"Estado de Conservación:","seg":$scope.datos.PTR_MUREST,"ter":" ","cuar":" "}
      ];
      var colpato = [
      {title: "primero", dataKey: "prim"},
      {title: "segundo", dataKey: "seg"},
      {title: "tercero", dataKey: "ter"},
      {title: "cuarto", dataKey: "cuar"}
      ];
      if($scope.datos.PTR_INFADICIONAL ==-1)
        {$scope.datos.PTR_INFADICIONAL =" ";}
      var datapato = [
      {"prim":"Area de Espacio:","seg":$scope.datos.PTR_MEDIDAREA,"ter":"Ancho:","cuar":$scope.datos.PTR_MEDIDANC},
      {"prim":"Largo:","seg":$scope.datos.PTR_MEDIDLAR,"ter":"ancho de muro de cerco:","cuar":$scope.datos.PTR_MEDIAMC},
      {"prim":"Información Adicional:","seg":$scope.datos.PTR_INFADICIONAL,"ter":"Observaciones:","cuar":refeBib1.innerText},
      {"prim":"Daños:","seg":danos,"ter":"Causas:","cuar":causas},
      {"prim":"Observaciones:","seg":obs1.innerText,"ter":" ","cuar":" "}
      ];
      var colvisual = [
      {title: "primero", dataKey: "prim"}
      ];
      var datavisual = [
      {"prim":espcon1.innerText},
      {"prim":intrea1.innerText},
      {"prim":cartec1.innerText},
      {"prim":carico1.innerText},
      {"prim":dathis1.innerText}
      ];
      var colser = [
      {title: "Descripción", dataKey: "uno"},
      {title: "Proveedor", dataKey: "dos"}
      ];
      var dataser=[];
      for (var i=1; i<$scope.datos.PTR_SERV.length;i++){
        if($scope.datos.PTR_SERV[i].f01_emision_G_SERV_DESC===undefined){
          $scope.datos.PTR_SERV[i].f01_emision_G_SERV_DESC="1-Original";
          $scope.datos.PTR_SERV[i].f01_emision_G_SERV_PROV="1-Original"
        }
        var desc = $scope.datos.PTR_SERV[i].f01_emision_G_SERV_DESC.split('-');
        var prov=   $scope.datos.PTR_SERV[i].f01_emision_G_SERV_PROV.split('-'); 

        var aporte = {"uno":$scope.datos.PTR_SERV[i].f01_emision_G_SERV_DESC ,"dos":$scope.datos.PTR_SERV[i].f01_emision_G_SERV_PROV};          
        dataser[i]=aporte;      
      }
      var coluso = [
      {title: "Descripción", dataKey: "uno"},
      {title: "Tradicional", dataKey: "dos"},
      {title: "Actual", dataKey: "tres"}
      ];
      var datauso=[];
      for (var i=1; i<$scope.datos.PTR_USO.length;i++){
        if($scope.datos.PTR_USO[i].f01_emision_G_SERV_DESC===undefined){
          $scope.datos.PTR_USO[i].f01_emision_G_SERV_DESC="1-Original";
        }
        var desc = $scope.datos.PTR_USO[i].f01_emision_G_SERV_DESC.split('-');          
        var aporte = {"uno": $scope.datos.PTR_USO[i].f01_emision_G_SERV_DESC ,"dos":$scope.datos.PTR_USO[i].f01_emision_G_TRAD,"tres":$scope.datos.PTR_USO[i].f01_emision_G_ACT};          
        datauso[i]=aporte;      
      }
      var colreja = [
      {title: "Materiales", dataKey: "uno"},
      {title: "Tipo", dataKey: "dos"},
      {title: "Integridad", dataKey: "tres"}
      ];
      var datareja=[];
      for (var i=1; i<$scope.datos.PTR_REJAS.length;i++){
        var mat=" ";
        if( $scope.datos.PTR_REJAS[i].f01_reja_MAD_='SI'){
          mat=mat+'Madera ';
        }else if($scope.datos.PTR_REJAS[i].f01_reja_TUBO_='SI'){
          mat=mat+'Tubo Industrial ';
        }else if($scope.datos.PTR_REJAS[i].f01_reja_HIERRO_='SI'){
          mat=mat+'Hierro Forjado ';
        }else if($scope.datos.PTR_REJAS[i].f01_reja_OTRO_='SI'){
          mat=mat+$scope.datos.PTR_REJAS[i].f01_reja_OTRODESC_;
        }
        if($scope.datos.PTR_REJAS[i].f01_reja_DES_===undefined){
          $scope.datos.PTR_REJAS[i].f01_reja_DES_="1-Original";
          $scope.datos.PTR_REJAS[i].f01_reja_INT_="1-Original";
        }
        var desc = $scope.datos.PTR_REJAS[i].f01_reja_DES_.split('-');
        var integ= $scope.datos.PTR_REJAS[i].f01_reja_INT_.split('-');      
        var aporte = {"uno":$scope.datos.PTR_REJAS[i].f01_reja_DES_ ,"dos":mat,"tres":$scope.datos.PTR_REJAS[i].f01_reja_INT_};          
        datareja[i]=aporte;      
      }
      var colmuro = [
      {title: "Materiales", dataKey: "uno"},
      {title: "Tipo", dataKey: "dos"},
      {title: "Integridad", dataKey: "tres"}
      ];
      var datamuro=[];
      for (var i=1; i<$scope.datos.PTR_ACAMUR.length;i++){
        var mat=" ";
        if( $scope.datos.PTR_ACAMUR[i].f01_muro_AZU_='SI'){
          mat=mat+'Azulejo ';
        }else if($scope.datos.PTR_ACAMUR[i].f01_muro_CAL_='SI'){
          mat=mat+'Cal y Arena ';
        }else if($scope.datos.PTR_ACAMUR[i].f01_muro_CEM_='SI'){
          mat=mat+'Cemento y Arena ';

        } else if($scope.datos.PTR_ACAMUR[i].f01_muro_LAD_='SI'){
          mat=mat+'Ladrillo ';
        }else if($scope.datos.PTR_ACAMUR[i].f01_muro_MAD_='SI'){
          mat=mat+'Madera ';
        }else if($scope.datos.PTR_ACAMUR[i].f01_muro_MAR_='SI'){
          mat=mat+'Mármol ';
        }else if($scope.datos.PTR_ACAMUR[i].f01_muro_PIE_='SI'){
          mat=mat+'Piedra ';
        }else if($scope.datos.PTR_ACAMUR[i].f01_muro_OTRO_='SI'){
          mat=mat+$scope.datos.PTR_ACAMUR[i].f01_muro_OTRODESC_;
        }
        if($scope.datos.PTR_ACAMUR[i].f01_muro_DES_===undefined){
          $scope.datos.PTR_ACAMUR[i].f01_muro_DES_="1-Original";
          $scope.datos.PTR_ACAMUR[i].f01_muro_INT_="1-Original";
        }
        var desc = $scope.datos.PTR_ACAMUR[i].f01_muro_DES_.split('-');
        var integ= $scope.datos.PTR_ACAMUR[i].f01_muro_INT_.split('-');   
        var aporte = {"uno":$scope.datos.PTR_ACAMUR[i].f01_muro_DES_ ,"dos":mat,"tres":$scope.datos.PTR_ACAMUR[i].f01_muro_INT_};          
        datamuro[i]=aporte;      
      }
      var colpint = [
      {title: "Materiales", dataKey: "uno"},
      {title: "Tipo", dataKey: "dos"},
      {title: "Integridad", dataKey: "tres"}
      ];
      var datapint=[];
      for (var i=1; i<$scope.datos.PTR_PINTURA.length;i++){
        var mat=" ";
        if( $scope.datos.PTR_PINTURA[i].f01_pint_ACE_='SI'){
          mat=mat+'Aceite ';
        }else if($scope.datos.PTR_PINTURA[i].f01_pint_ACR_='SI'){
          mat=mat+'Acrílica ';
        }else if($scope.datos.PTR_PINTURA[i].f01_pint_CAL_='SI'){
          mat=mat+'Cal ';
        }else if($scope.datos.PTR_PINTURA[i].f01_pint_OTRO_='SI'){
          mat=mat+$scope.datos.PTR_PINTURA[i].f01_pint_OTRODESC_;
        }
        if($scope.datos.PTR_PINTURA[i].f01_pint_COD_===undefined){
          $scope.datos.PTR_PINTURA[i].f01_pint_COD_="1-Original";
          $scope.datos.PTR_PINTURA[i].f01_pint_INT_="1-Original";
        }
        var desc = $scope.datos.PTR_PINTURA[i].f01_pint_COD_.split('-');
        var integ= $scope.datos.PTR_PINTURA[i].f01_pint_INT_.split('-');      
        var aporte = {"uno":$scope.datos.PTR_PINTURA[i].f01_pint_COD_ ,"dos":mat,"tres":$scope.datos.PTR_PINTURA[i].f01_pint_INT_};           
        datapint[i]=aporte;      
      }
      var colpiso = [
      {title: "Materiales", dataKey: "uno"},
      {title: "Tipo", dataKey: "dos"},
      {title: "Integridad", dataKey: "tres"}
      ];
      var datapiso=[];
      for (var i=1; i<$scope.datos.PTR_PISOS.length;i++){
        var mat=" ";
        if( $scope.datos.PTR_PISOS[i].f01_pis_MOS_='SI'){
          mat=mat+'Mosaicos ';
        }else if($scope.datos.PTR_PISOS[i].f01_pis_POR_='SI'){
          mat=mat+'Porcelanato ';
        }else if($scope.datos.PTR_PISOS[i].f01_pis_LAJ_='SI'){
          mat=mat+'P. Laja ';
        }else if($scope.datos.PTR_PISOS[i].f01_pis_RIO_='SI'){
          mat=mat+'P. Rio ';
        }else if($scope.datos.PTR_PISOS[i].f01_pis_LAD_='SI'){
          mat=mat+'Ladrillos ';
        }else if($scope.datos.PTR_PISOS[i].f01_pis_GRA_='SI'){
          mat=mat+'Grama ';
        }else if($scope.datos.PTR_PISOS[i].f01_pis_TIE_='SI'){
          mat=mat+'Tierra ';
        }else if($scope.datos.PTR_PISOS[i].f01_pis_CON_='SI'){
          mat=mat+'Concreto ';
        }else if($scope.datos.PTR_PISOS[i].f01_pis_CER_='SI'){
          mat=mat+'Cerámica ';
        }else if($scope.datos.PTR_PISOS[i].f01_pis_MAD_='SI'){
          mat=mat+'Madera ';        
        }else if($scope.datos.PTR_PISOS[i].f01_pis_OTRO_='SI'){
          mat=mat+$scope.datos.PTR_PISOS[i].f01_pis_OTRODESC_;
        }   
        var aporte = {"uno":$scope.datos.PTR_PISOS[i].f01_pis_DES_ ,"dos":mat,"tres":$scope.datos.PTR_PISOS[i].f01_pis_INT_};           
        datapiso[i]=aporte;       
      }
      var colpue = [
      {title: "Materiales", dataKey: "uno"},
      {title: "Tipo", dataKey: "dos"},
      {title: "Integridad", dataKey: "tres"}
      ];
      var datapue=[];
      for (var i=1; i<$scope.datos.PTR_PUERTA.length;i++){
        var mat=" ";
        if( $scope.datos.PTR_PUERTA[i].f01_pue_MAD_='SI'){
          mat=mat+'Madera ';
        }else if($scope.datos.PTR_PUERTA[i].f01_pue_MET_='SI'){
          mat=mat+'Metal ';
        }else if($scope.datos.PTR_PUERTA[i].f01_pue_OTRO_='SI'){
          mat=mat+$scope.datos.PTR_PUERTA[i].f01_pue_OTRODESC_;
        }       
        var aporte = {"uno":$scope.datos.PTR_PUERTA[i].f01_pue_DES_ ,"dos":mat,"tres":$scope.datos.PTR_PUERTA[i].f01_pue_INT_};          
        datapue[i]=aporte;      
      }
      var colmob =[
      {title: "Materiales", dataKey: "uno"},
      {title: "Tipo", dataKey: "dos"},
      {title: "Integridad", dataKey: "tres"}
      ];
      var datamob=[];
      for (var i=1; i<$scope.datos.PTR_MOBURB.length;i++){
        var mat=" ";
        if( $scope.datos.PTR_MOBURB[i].f01_mob_ADO_='SI'){
          mat=mat+'Adobe ';
        }else if($scope.datos.PTR_MOBURB[i].f01_mob_CAL_='SI'){
          mat=mat+'Cal ';
        }else if($scope.datos.PTR_MOBURB[i].f01_mob_CAR_='SI'){
          mat=mat+'Fibra de Carbono ';
        }else if($scope.datos.PTR_MOBURB[i].f01_mob_CON_='SI'){
          mat=mat+'Concreto ';
        }else if($scope.datos.PTR_MOBURB[i].f01_mob_LAD_='SI'){
          mat=mat+'Ladrillo ';
        }else if($scope.datos.PTR_MOBURB[i].f01_mob_MAD_='SI'){
          mat=mat+'Madera ';
        }else if($scope.datos.PTR_MOBURB[i].f01_mob_MET_='SI'){
          mat=mat+'Metal ';
        }else if($scope.datos.PTR_MOBURB[i].f01_mob_PIE_='SI'){
          mat=mat+'Piedra ';
        }else if($scope.datos.PTR_MOBURB[i].f01_mob_VID_='SI'){
          mat=mat+'Vidrio ';
        }else if($scope.datos.PTR_MOBURB[i].f01_mob_BARR_='SI'){
          mat=mat+'Barro ';
        }else if($scope.datos.PTR_MOBURB[i].f01_mob_FIBR_='SI'){
          mat=mat+'Fibrocem ';
        }else if($scope.datos.PTR_MOBURB[i].f01_mob_OTRO_='SI'){
          mat=mat+$scope.datos.PTR_MOBURB[i].f01_mob_OTRODESC_;
        }
        if($scope.datos.PTR_MOBURB[i].f01_mob_DES_===undefined){
          $scope.datos.PTR_MOBURB[i].f01_mob_DES_="1-Original";
          $scope.datos.PTR_MOBURB[i].f01_mob_INT_="1-Original";
        }
        var desc = $scope.datos.PTR_MOBURB[i].f01_mob_DES_.split('-');
        var integ= $scope.datos.PTR_MOBURB[i].f01_mob_INT_.split('-');   
        var aporte = {"uno":$scope.datos.PTR_MOBURB[i].f01_mob_DES_ ,"dos":mat,"tres":$scope.datos.PTR_MOBURB[i].f01_mob_INT_ }; ;          
        datamob[i]=aporte;      
      }
      var colesc = [
      {title: "Materiales", dataKey: "uno"},
      {title: "Tipo", dataKey: "dos"},
      {title: "Integridad", dataKey: "tres"}
      ];
      var dataesc=[];
      for (var i=1; i<$scope.datos.PTR_ESCAL.length;i++){
        var mat=" ";
        if( $scope.datos.PTR_ESCAL[i].f01_esc_CON_='SI'){
          mat=mat+'Concreto ';
        }else if($scope.datos.PTR_ESCAL[i].f01_esc_LAD_='SI'){
          mat=mat+'Ladrillo ';
        }else if($scope.datos.PTR_ESCAL[i].f01_esc_MAD_='SI'){
          mat=mat+'Madera ';
        }else if($scope.datos.PTR_ESCAL[i].f01_esc_MET_='SI'){
          mat=mat+'Metal ';
        }else if($scope.datos.PTR_ESCAL[i].f01_esc_PIE_='SI'){
          mat=mat+'Piedra ';
        }else if($scope.datos.PTR_ESCAL[i].f01_esc_TIE_='SI'){
          mat=mat+'Tierra ';
        }else if($scope.datos.PTR_ESCAL[i].f01_esc_OTRO_='SI'){
          mat=mat+$scope.datos.PTR_ESCAL[i].f01_esc_OTRODESC_;
        }
        if($scope.datos.PTR_ESCAL[i].f01_esc_DES_===undefined){
          $scope.datos.PTR_ESCAL[i].f01_esc_DES_="1-Original";
          $scope.datos.PTR_ESCAL[i].f01_esc_INT_="1-Original";
        }
        var desc = $scope.datos.PTR_ESCAL[i].f01_esc_DES_.split('-');
        var integ= $scope.datos.PTR_ESCAL[i].f01_esc_INT_.split('-');    
        var aporte = {"uno":$scope.datos.PTR_ESCAL[i].f01_esc_DES_ ,"dos":mat,"tres":$scope.datos.PTR_ESCAL[i].f01_esc_INT_};          
        dataesc[i]=aporte;      
      }
      var colveg = [
      {title: "Materiales", dataKey: "uno"},
      {title: "Tipo", dataKey: "dos"},
      {title: "Integridad", dataKey: "tres"},
      {title: "Cantidad", dataKey: "cuatro"}
      ];
      var dataveg=[];
      for (var i=1; i<$scope.datos.PTR_VEGET.length;i++){
        var mat=" ";
        if( $scope.datos.PTR_VEGET[i].f01_veg_CAD_='SI'){
          mat=mat+'Caduca ';
        }else if($scope.datos.PTR_VEGET[i].f01_veg_PER_='SI'){
          mat=mat+'Perenne ';
        }else if($scope.datos.PTR_VEGET[i].f01_veg_SFL_='SI'){
          mat=mat+'Sin Floracion ';
        }else if($scope.datos.PTR_VEGET[i].f01_veg_OTRO_='SI'){
          mat=mat+$scope.datos.PTR_VEGET[i].f01_veg_OTRODESC_;
        }
        if($scope.datos.PTR_VEGET[i].f01_veg_DES_===undefined){
          $scope.datos.PTR_VEGET[i].f01_veg_DES_="1-Original";
          $scope.datos.PTR_VEGET[i].f01_veg_INT_="1-Original";
        }
        var desc = $scope.datos.PTR_VEGET[i].f01_veg_DES_.split('-');
        var integ= $scope.datos.PTR_VEGET[i].f01_veg_INT_.split('-');     
        var aporte = {"uno":$scope.datos.PTR_VEGET[i].f01_veg_DES_ ,"dos":mat,"tres":$scope.datos.PTR_VEGET[i].f01_veg_INT_,"cuatro":$scope.datos.PTR_VEGET[i].f01_veg_CAN_};           
        dataveg[i]=aporte;      
      }
      var colart = [
      {title: "Tipo", dataKey: "uno"},
      {title: "Integridad", dataKey: "tres"}
      ];
      var dataart=[];
      for (var i=1; i<$scope.datos.PTR_DETALLES.length;i++){
        if($scope.datos.PTR_DETALLES[i].f01_det_DES_===undefined){
          $scope.datos.PTR_DETALLES[i].f01_det_DES_="1-Original";
          $scope.datos.PTR_DETALLES[i].f01_det_INT_="1-Original";
        }
        var desc = $scope.datos.PTR_DETALLES[i].f01_det_DES_.split('-');
        var integ= $scope.datos.PTR_DETALLES[i].f01_det_INT_.split('-');    
        var aporte = {"uno":$scope.datos.PTR_DETALLES[i].f01_det_DES_ ,"tres":$scope.datos.PTR_DETALLES[i].f01_det_INT_};           
        dataart[i]=aporte;      
      }
      var color = [
      {title: "primero", dataKey: "prim"}
      ];
      var dataor = [
      {"prim":preex1.innerText},
      {"prim":uso1.innerText},
      {"prim":hecho1.innerText},
      {"prim":fiestas1.innerText},
      {"prim":histor1.innerText},
      {"prim":fuent1.innerText}      
      ];
      var coldoc = [
      {title: "primero", dataKey: "prim"}
      ];
      var datadoc = [
      {"prim":preex1d.innerText},
      {"prim":uso1d.innerText},
      {"prim":hecho1d.innerText},
      {"prim":fiestas1d.innerText},
      {"prim":histor1d.innerText},
      {"prim":fuentes1d.innerText}      
      ];
      var colhis = [
      {title: "Indicador Histórico Cultural:", dataKey: "uno"}
      ];
      var datahis = [];
      var j=0;
      for (var i=0; i<$scope.datos.PTR_VALORHIS.length;i++){
        if($scope.datos.PTR_VALORHIS[i].estado){
          var aporte = {"uno":$scope.datos.PTR_VALORHIS[i].resvalor}; 
          datahis[j]=aporte;
          j++;
        }    
      }
      var colrte = [
      {title: "Indicador Artístico:", dataKey: "uno"}
      ];
      var datarte = [];
      var j=0;
      for (var i=0; i<$scope.datos.PTR_VALORART.length;i++){
        if($scope.datos.PTR_VALORART[i].estado){
          var aporte = {"uno":$scope.datos.PTR_VALORART[i].resvalor};          
          datarte[j]=aporte;
          j++;
        }    
      }
      var coltipo = [
      {title: "Indicador Tipológico:", dataKey: "uno"}
      ];
      var datatipo = [];
      var j=0;
      for (var i=0; i<$scope.datos.PTR_VALORARQ.length;i++){
        if($scope.datos.PTR_VALORARQ[i].estado){
          var aporte = {"uno":$scope.datos.PTR_VALORARQ[i].resvalor};          
          datatipo[j]=aporte;
          j++;
        }    
      }
      var coltec = [
      {title: "Indicador Tecnológico", dataKey: "uno"}
      ];
      var datatec = [];
      var j=0;
      for (var i=0; i<$scope.datos.PTR_VALORTEC.length;i++){
        if($scope.datos.PTR_VALORTEC[i].estado){
          var aporte = {"uno":$scope.datos.PTR_VALORTEC[i].resvalor};          
          datatec[j]=aporte;
          j++;
        }    
      }
      var colinte = [
      {title: "Indicador de Integridad", dataKey: "uno"}
      ];
      var datainte = [];
      var j=0;
      for (var i=0; i<$scope.datos.PTR_VALORINTG.length;i++){
        if($scope.datos.PTR_VALORINTG[i].estado){
          var aporte = {"uno":$scope.datos.PTR_VALORINTG[i].resvalor};          
          datainte[j]=aporte;
          j++;
        }    
      }
      var colurb = [
      {title: "Indicador Urbano", dataKey: "uno"}
      ];
      var dataurb = [];
      var j=0;
      for (var i=0; i<$scope.datos.PTR_VALORURB.length;i++){
        if($scope.datos.PTR_VALORURB[i].estado){
          var aporte = {"uno":$scope.datos.PTR_VALORURB[i].resvalor};          
          dataurb[j]=aporte;
          j++;
        }    
      }
      var colinta = [
      {title: "Indicador Simbólico", dataKey: "uno"}
      ];
      var datainta = [];
      var j=0;
      for (var i=0; i<$scope.datos.PTR_VALORINT.length;i++){
        if($scope.datos.PTR_VALORINT[i].estado){
          var aporte = {"uno":$scope.datos.PTR_VALORINT[i].resvalor};          
          datainta[j]=aporte;
        }    
      }
      var colsimb = [
      {title: "Indicador Simbólico", dataKey: "uno"}
      ];
      var datasimb = [];
      var j=0;
      for (var i=0; i<$scope.datos.PTR_VALORSIMB.length;i++){
        if($scope.datos.PTR_VALORSIMB[i].estado){
          var aporte = {"uno":$scope.datos.PTR_VALORSIMB[i].resvalor};          
          datasimb[j]=aporte;
          j++;
        }    
      }
      var colinsc = [
      {title: "primero", dataKey: "prim"}
      ];
      var datainsc = [
      {"prim":espconj1.innerText}     
      ];
      var colcrite = [
      {title: "primero", dataKey: "prim"}
      ];
      var chis1 = document.createElement('div');
      chis1.innerHTML = $scope.datos.PTR_CRITERHIS; 
      var cart1 = document.createElement('div');
      cart1.innerHTML = $scope.datos.PTR_CRITERART; 
      var carq1 = document.createElement('div');
      carq1.innerHTML = $scope.datos.PTR_CRITERARQ; 
      var ctec1 = document.createElement('div');
      ctec1.innerHTML = $scope.datos.PTR_CRITERTEC;
      var cint1 = document.createElement('div');
      cint1.innerHTML = $scope.datos.PTR_CRITERINT; 
      var curb1 = document.createElement('div');
      curb1.innerHTML = $scope.datos.PTR_CRITERURB; 
      var cinta1 = document.createElement('div');
      cinta1.innerHTML = $scope.datos.PTR_CRITERINTA; 
      var csim1 = document.createElement('div');
      csim1.innerHTML = $scope.datos.PTR_CRITERSIMB; 
      var datacrite = [
      {"prim":chis1.innerText},
      {"prim":cart1.innerText},
      {"prim":carq1.innerText},
      {"prim":ctec1.innerText},
      {"prim":cint1.innerText},
      {"prim":curb1.innerText},
      {"prim":cinta1.innerText},
      {"prim":csim1.innerText}

      ];

      var doc = new jsPDF('p', 'pt');

      var header = function (data) {
        doc.addImage(material,'JPEG', 35, 40, 525, 60);
         doc.setTextColor(0);
        doc.setFontStyle('bold');
        doc.setFontSize(9);
        doc.text('FICHA DE CATALOGACION DE ESPACIOS ABIERTOS',40,120);
        doc.text('NRO. FICHA: ',400,120);
        doc.setFontStyle('normal');
        doc.text($scope.datos.PTR_REG,470,120);
        doc.rect(390, 105, 170, 25);
      };
      var totalPagesExp = "{total_pages_count_string}";
      var numeropag = 0;
      var footer = function (data) {
        if(1 == data.pageCount){
          numeropag = numeropag + 1;
        }
        var str = "Página " + numeropag;
        if (typeof doc.putTotalPages === 'function') {
          str = str + " de " + totalPagesExp;
        }
        doc.text(str, 470, doc.internal.pageSize.height - 45);
          doc.text("Para cualquier consulta, por favor comunicarse al Telefono. 2-2440746", 40, doc.internal.pageSize.height - 45);
      };
      doc.setFontSize(8);
      doc.setFontStyle('bold');
      doc.text('I. IDENTIFICACIÓN',35,130);
      doc.text('1. PLANO DE UBICACIÓN',40,145);
      doc.rect(60, 155, 300, 200);
      doc.addImage(image1[0],'JPEG', 60, 155,300,200);
      doc.autoTable(coldato1.splice(0,4), datadato1, {drawHeaderRow: function() {return false;} ,
        startY: 365,pageBreak: 'auto',theme: 'mary',bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 50, top: 110, bottom: 75},styles: {overflow: 'linebreak'},columnStyles: {prim: {columnWidth: 90,fontStyle: 'bold'},seg: {columnWidth: 150},ter: {columnWidth: 100,fontStyle: 'bold'},cuar: {columnWidth: 140}},drawRow: function (row, data) {doc.setFontStyle('bold'); doc.setFontSize(8);
        if (row.index === 0) {
          doc.autoTableText("2. DATOS GENERALES", 40, row.y + row.height / 2, {
            halign: 'left',
            valign: 'botton'
          });
          data.cursor.y += 20;
        }           
      },
    });
      doc.autoTable(coldato2, datadato2, {startY: doc.autoTableEndPosY() +5 ,headerStyles: {fontStyle: 'bold', rowHeight: 12, fontSize: 8, valign: 'middle'},pageBreak: 'auto',theme: 'mary',bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 50, top: 110, bottom: 75},styles: {overflow: 'linebreak'},columnStyles: {uno: {columnWidth: 90,fontStyle: 'bold'},dos: {columnWidth: 390}}
    });

      doc.autoTable(coldato.splice(0,4), datadato, {drawHeaderRow: function() {return false;} ,startY: doc.autoTableEndPosY() +10,pageBreak: 'auto',theme: 'mary',bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},beforePageContent: header,afterPageContent: footer,margin: {horizontal: 50, top: 110, bottom: 75},styles: {overflow: 'linebreak'},columnStyles: {prim: {columnWidth: 90,fontStyle: 'bold'},seg: {columnWidth: 150},ter: {columnWidth: 100,fontStyle: 'bold'},cuar: {columnWidth: 140}},drawRow: function (row, data) {doc.setFontStyle('bold'); doc.setFontSize(8);
        if (row.index === 0) {

          doc.autoTableText("3. DENOMINACIÓN DEL INMUEBLE" , 40, row.y + row.height / 2, {
            halign: 'left',
            valign: 'botton'
          });
          data.cursor.y += 20;
        }  else if (row.index === 1) {

          doc.autoTableText("4. LOCALIZACIÓN" , 40, row.y + row.height / 2, {
            halign: 'left',
            valign: 'botton'
          });
          data.cursor.y += 20;
        }   else if (row.index === 6) {

          doc.autoTableText("5. REGIMEN DE PROPIEDAD" , 40, row.y + row.height / 2, {
            halign: 'left',
            valign: 'botton'
          });
          data.cursor.y += 20;
        }            
      },
    });

      doc.text('6. USO DE SUELO',40,doc.autoTableEndPosY() +15);

      doc.autoTable(coluso, datauso,{startY: doc.autoTableEndPosY() +20,pageBreak: 'auto',theme: 'mary',bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},headerStyles: {fontStyle: 'bold', rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 50, top: 110, bottom: 75},styles: {overflow: 'linebreak'},columnStyles: {uno: {columnWidth: 240},dos: {columnWidth: 100},tres: {columnWidth: 140}}});
      doc.text('7. SERVICIOS',40,doc.autoTableEndPosY() +15);

      doc.autoTable(colser, dataser,{startY: doc.autoTableEndPosY() +20,pageBreak: 'auto',theme: 'mary',bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},headerStyles: {fontStyle: 'bold', rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 50, top: 110, bottom: 75},styles: {overflow: 'linebreak'},columnStyles: {uno: {columnWidth: 240},dos: {columnWidth: 240}}});
      doc.setFontSize(8);
      doc.setFontStyle('bold');
      doc.text('Otros Servicios:',50,doc.autoTableEndPosY() +10); 
      doc.setFontStyle('normal');
      doc.text(other,60,doc.autoTableEndPosY() +20); 
      doc.setFontSize(8);
      doc.setFontStyle('normal');
      doc.setFontSize(8);
      doc.setFontStyle('bold');
     
      doc.addPage();
      doc.text('II. MARCO LEGAL',35,135);
      if($scope.datos.PTR_FIGPRO ==-1)
        {$scope.datos.PTR_FIGPRO =" ";} 
      doc.text('Figura de Protección Legal:',50,150); 
      doc.setFontSize(8);
      doc.setFontStyle('normal');
      doc.text($scope.datos.PTR_FIGPRO,160,150);
      doc.setFontSize(8);
      doc.setFontStyle('bold');
      if($scope.datos.PTR_REFHIST ==-1)
        {$scope.datos.PTR_REFHIST =" ";} 
      doc.text('III. REFERENCIA HISTÓRICA',35,165);
      doc.text('Referencia Histórica:',50,180); 
      doc.setFontSize(8);
      doc.setFontStyle('normal');
      doc.text($scope.datos.PTR_REFHIST,160,180);
      doc.setFontSize(8);
      doc.setFontStyle('bold');
      doc.text('IV. DATOS ORALES',35,190);
      doc.text('Fecha de Construcción:',40,205); 
      doc.text('Autor/Constructor:',300,205); 
      doc.text('Propietarios::',40,220);
      doc.setFontStyle('normal');
      doc.rect(40, 195, 520, 30);
      doc.setFontSize(8);
      doc.setFontStyle('normal');
      doc.text($scope.datos.PTR_FECCONS,150,205);
      doc.text($scope.datos.PTR_AUTOR,400,205);
      doc.text($scope.datos.PTR_PROP,150,220);

      doc.autoTable(color.splice(0,2), dataor, {drawHeaderRow: function() {return false;},startY: 225,pageBreak: 'auto',theme: 'plain',bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'top'},beforePageContent: header,afterPageContent: footer,margin: {horizontal: 50, top: 130, bottom: 75},styles: {overflow: 'linebreak'},drawRow: function (row, data) {doc.setFontStyle('bold'); doc.setFontSize(8);
        if (row.index === 0) {
          doc.autoTableText("Preexistencia/Edificación/Intervenciones:", 40, row.y+15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        } else if (row.index ===1 ) {

          doc.autoTableText("Usos Originales" , 40, row.y +15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        }  else if (row.index === 2) {

          doc.autoTableText("Hechos Históricos/Personajes Distinguidos" , 40, row.y +15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        }   else if (row.index === 3) {

          doc.autoTableText("Fiestas Religiosas" , 40, row.y +15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        }    
        else if (row.index === 4) {

          doc.autoTableText("Datos Históricos del Conjunto" , 40, row.y+15 , {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        } 
        else if (row.index === 5) {

          doc.autoTableText("Fuentes Bibliográficas" , 40, row.y+15 , {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        }         
      },
    });
      doc.setFontSize(8);
      doc.setFontStyle('bold');
      doc.text('V. DATOS DOCUMENTALES',35,doc.autoTableEndPosY() +15);
      doc.text('Fecha de Construcción:',40,doc.autoTableEndPosY() +30); 
      doc.text('Autor/Constructor:',300,doc.autoTableEndPosY() +30); 
      doc.text('Propietarios::',40,doc.autoTableEndPosY() +45);
      doc.rect(40, doc.autoTableEndPosY() +20, 520, 35); 
      doc.setFontSize(8);
      doc.setFontStyle('normal');
      doc.text($scope.datos.PTR_FECCONST,150,doc.autoTableEndPosY() +30);
      doc.text($scope.datos.PTR_AUTCONST,400,doc.autoTableEndPosY() +30);
      doc.text($scope.datos.PTR_PROPIE,150,doc.autoTableEndPosY() +45);

      doc.autoTable(coldoc.splice(0,2), datadoc, {drawHeaderRow: function() {return false;},startY: doc.autoTableEndPosY() +50,pageBreak: 'auto',theme: 'plain',bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'top'},margin: {horizontal: 50, top: 130, bottom: 80},styles: {overflow: 'linebreak'},drawRow: function (row, data) {doc.setFontStyle('bold'); doc.setFontSize(8);
        if (row.index === 0) {
          doc.autoTableText("Preexistencia/ Edificación/ Intervenciones:", 40, row.y+10, {
            halign: 'left',
            valign: 'botton'
          });
          data.cursor.y += 20;
        } else if (row.index ===1 ) {

          doc.autoTableText("Usos Originales" , 40, row.y +15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        } else if (row.index === 2) {
          doc.autoTableText("Hechos Históricos/ Personajes Distinguidos" , 40, row.y+15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        } else if (row.index === 3) {

          doc.autoTableText("Fiestas Religiosas" , 40, row.y+15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        }    
        else if (row.index === 4) {

          doc.autoTableText("Datos Históricos del Conjunto" , 40, row.y+15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        } 
        else if (row.index === 5) {

          doc.autoTableText("Fuentes Bibliográficas" , 40, row.y+15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        }         
      },
    });
      doc.setFontSize(8);
      doc.setFontStyle('bold');
      doc.text('VI. INSCRIPCIONES',35,doc.autoTableEndPosY() +15);

      doc.autoTable(colinsc.splice(0, 1), datainsc, {drawHeaderRow: function() {return false;}, startY: doc.autoTableEndPosY() +20,theme: 'plain',bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 50, top: 130, bottom: 75},styles: {overflow: 'linebreak'}        

      });
      doc.autoTable(colepo.splice(0,4), dataepo, {drawHeaderRow: function() {return false;},startY: doc.autoTableEndPosY() +1,pageBreak: 'auto',theme: 'mary',columnStyles: {prim: {columnWidth: 90,fontStyle: 'bold'},seg: {columnWidth: 150},ter: {columnWidth: 100,fontStyle: 'bold'},cuar: {columnWidth: 140}},bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 50, top: 130, bottom: 75},styles: {overflow: 'linebreak'},drawRow: function (row, data) {doc.setFontStyle('bold'); doc.setFontSize(8);
        if (row.index === 0) {
          doc.setTextColor(0);
          doc.autoTableText("VII. EPOCA", 35, row.y+10, {
            halign: 'left',
            valign: 'botton'
          });
          data.cursor.y += 20;
        } else if (row.index ===2 ) {
          doc.setTextColor(0);
          doc.autoTableText("VIII. ESTILO" , 35, row.y +15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        }  else if (row.index === 3) {
          doc.setTextColor(0);
          doc.autoTableText("VIII. DESCRIPCIÓN DEL AREA" , 35, row.y+15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        }   else if (row.index === 4) {
          doc.setTextColor(0);
          doc.autoTableText("1. TIPOLOGÍA" , 40, row.y+15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        }    
        else if (row.index === 5) {
          doc.setTextColor(0);
          doc.autoTableText("2. MUROS DE DELIMITACIÓN" , 40, row.y+15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        } 
      }
    });
      doc.setFontSize(8);
      doc.setFontStyle('bold');
      doc.text('3. REJAS',40,doc.autoTableEndPosY() +15);
      doc.setFontSize(8);
      doc.setFontStyle('normal');

      if($scope.datos.PTR_REJAEST ==-1)
        {$scope.datos.PTR_REJAEST =" ";} 
      if($scope.datos.PTR_ACAEST ==-1)
        {$scope.datos.PTR_ACAEST =" ";} 
      if($scope.datos.PTR_PINTEST ==-1)
        {$scope.datos.PTR_PINTEST =" ";} 
      if($scope.datos.PTR_PISOEST ==-1)
        {$scope.datos.PTR_PISOEST =" ";} 
      if($scope.datos.PTR_PUERTAEST ==-1)
        {$scope.datos.PTR_PUERTAEST =" ";} 
      if($scope.datos.PTR_MOBEST ==-1)
        {$scope.datos.PTR_MOBEST =" ";}
      doc.text('Estado de conservación',50,doc.autoTableEndPosY() +25);  
      doc.text($scope.datos.PTR_REJAEST,150,doc.autoTableEndPosY() +25);
      doc.autoTable(colreja, datareja,{startY: doc.autoTableEndPosY() +30,pageBreak: 'auto',theme: 'mary',bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},headerStyles: {fontStyle: 'bold', rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 50, top: 130, bottom: 75},styles: {overflow: 'linebreak'},columnStyles: {uno: {columnWidth: 150},dos: {columnWidth: 150}}});
      doc.setFontStyle('bold');
      doc.text('4. ACABADOS DE MUROS',40,doc.autoTableEndPosY() +15);
      doc.setFontStyle('normal');
      doc.text('Estado de conservación',50,doc.autoTableEndPosY() +25);
      doc.text($scope.datos.PTR_ACAEST,150,doc.autoTableEndPosY() +25);
      doc.autoTable(colmuro, datamuro,{startY: doc.autoTableEndPosY() +30,pageBreak: 'auto',theme: 'mary',bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},headerStyles: {fontStyle: 'bold', rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 50, top: 130, bottom: 75},styles: {overflow: 'linebreak'},columnStyles: {uno: {columnWidth: 150},dos: {columnWidth: 150}}});
      doc.setFontStyle('bold');
      doc.text('5. PINTURAS',40,doc.autoTableEndPosY() +15);
      doc.setFontStyle('normal');
      doc.text('Estado de conservación',50,doc.autoTableEndPosY() +25);
      doc.text($scope.datos.PTR_PINTEST,150,doc.autoTableEndPosY() +25);
      doc.autoTable(colpint, datapint,{startY: doc.autoTableEndPosY() +30,beforePageContent: header,afterPageContent: footer,pageBreak: 'auto',theme: 'mary',bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},headerStyles: {fontStyle: 'bold', rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 50, top: 130, bottom: 75},styles: {overflow: 'linebreak'},columnStyles: {uno: {columnWidth: 150},dos: {columnWidth: 150}}});
      doc.setFontStyle('bold');
      doc.text('6. PISOS',40,doc.autoTableEndPosY() +15);
      doc.setFontStyle('normal');
      doc.text('Estado de conservación',50,doc.autoTableEndPosY() +25);
      doc.text($scope.datos.PTR_PISOEST,150,doc.autoTableEndPosY() +25);
      doc.autoTable(colpiso, datapiso,{startY: doc.autoTableEndPosY() +30,pageBreak: 'auto',theme: 'mary',bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},headerStyles: {fontStyle: 'bold', rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 50, top: 130, bottom: 75},styles: {overflow: 'linebreak'},columnStyles: {uno: {columnWidth: 150},dos: {columnWidth: 150}}});
      doc.setFontStyle('bold');
      doc.text('7. PUERTAS DE ACCESO',40,doc.autoTableEndPosY() +15);
      doc.setFontStyle('normal');
      doc.text('Estado de conservación',50,doc.autoTableEndPosY() +25);
      doc.text($scope.datos.PTR_PUERTAEST,150,doc.autoTableEndPosY() +25);
      doc.autoTable(colpue, datapue,{startY: doc.autoTableEndPosY() +30,pageBreak: 'auto',theme: 'mary',bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},headerStyles: {fontStyle: 'bold', rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 50, top: 130, bottom: 75},styles: {overflow: 'linebreak'},columnStyles: {uno: {columnWidth: 150},dos: {columnWidth: 150}}});
      doc.setFontStyle('bold');
      doc.text('8. MOBILIARIO URBANO',40,doc.autoTableEndPosY() +15);
      doc.setFontStyle('normal');
      doc.text('Estado de conservación',50,doc.autoTableEndPosY() +25);
      doc.text($scope.datos.PTR_MOBEST,150,doc.autoTableEndPosY() +25);
      doc.autoTable(colmob, datamob,{startY: doc.autoTableEndPosY() +30,pageBreak: 'auto',theme: 'mary',bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},headerStyles: {fontStyle: 'bold', rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 50, top: 130, bottom: 75},styles: {overflow: 'linebreak'},columnStyles: {uno: {columnWidth: 150},dos: {columnWidth: 150}}});
      doc.setFontStyle('bold');
      doc.text('9. ESCALERAS',40,doc.autoTableEndPosY() +15);
      doc.setFontStyle('normal');
      if($scope.datos.PTR_ESCEST ==-1)
        {$scope.datos.PTR_ESCEST =" ";} 
      if($scope.datos.PTR_VEGEST ==-1)
        {$scope.datos.PTR_VEGEST =" ";}
      if($scope.datos.PTR_DETALLEST ==-1)
        {$scope.datos.PTR_DETALLEST =" ";}
      doc.text('Estado de conservación',50,doc.autoTableEndPosY() +25);
      doc.text($scope.datos.PTR_ESCEST,150,doc.autoTableEndPosY() +25);
      doc.autoTable(colesc, dataesc,{startY: doc.autoTableEndPosY() +30,pageBreak: 'auto',theme: 'mary',bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},headerStyles: {fontStyle: 'bold', rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 50, top: 130, bottom: 75},styles: {overflow: 'linebreak'},columnStyles: {uno: {columnWidth: 150},dos: {columnWidth: 150}}});
      doc.setFontStyle('bold');
      doc.text('10. CARACTERISTICAS DE LA VEGETACIÓN',40,doc.autoTableEndPosY() +15);
      doc.setFontStyle('normal');
      doc.text('Estado de conservación',50,doc.autoTableEndPosY() +25);
      doc.text($scope.datos.PTR_VEGEST,150,doc.autoTableEndPosY() +25); 
      doc.autoTable(colveg, dataveg,{startY: doc.autoTableEndPosY() +30,pageBreak: 'auto',theme: 'mary',bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},headerStyles: {fontStyle: 'bold', rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 50, top: 130, bottom: 75},styles: {overflow: 'linebreak'},columnStyles: {uno: {columnWidth: 150},dos: {columnWidth: 150},tres: {columnWidth: 150}}});
      doc.setFontStyle('bold');
      doc.text('11. DETALLES ARTISTICOS',40,doc.autoTableEndPosY() +15);
      doc.setFontStyle('normal');
      doc.text('Estado de conservación',50,doc.autoTableEndPosY() +25);
      doc.text($scope.datos.PTR_DETALLEST,150,doc.autoTableEndPosY() +25);
      doc.autoTable(colart, dataart,{startY: doc.autoTableEndPosY() +30,pageBreak: 'auto',theme: 'mary',bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},headerStyles: {fontStyle: 'bold', rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 50, top: 130, bottom: 75},styles: {overflow: 'linebreak'},columnStyles: {uno: {columnWidth: 150},dos: {columnWidth: 150},tres: {columnWidth: 150}}});
      doc.setFontStyle('bold');
      m = doc.autoTableEndPosY() +15;
      if(m > 710){
        doc.addPage();
        m = 125;
      }
      doc.text('X.ESQUEMA ARQUITECTONICO',35,m +15);      
      doc.addImage(image1[1],'JPEG', 40, m +20,200,200);
      doc.text('XI.ANGULO VISUAL HORIZONTAL',350,m +15);
      doc.text('Vista Panoramica:',350,m +190);
      doc.text('Vista Parcial:',350,m +200);
      doc.text('Orientación:',350,m +210);
      doc.text('Otros:',350,m +220);
      doc.setFontStyle('normal');
      doc.text(parcial,420,m +190);
      doc.text(panoramica,420,m +200);
      doc.text($scope.datos.PTR_ANGOR,420,m +210);
      doc.text($scope.datos.PTR_ANGGRA,420,m +220);
      doc.addImage(image1[2],'JPEG', 350,m +20,150,150);
      doc.setFontStyle('bold');
      doc.text('XII.ELEMENTOS VISUALES',35,m +235);
      doc.autoTable(colvisual.splice(0,1), datavisual, {drawHeaderRow: function() {return false;},startY: m +235,pageBreak: 'auto',theme: 'plain',bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'top'},margin: {horizontal: 50, top: 130, bottom: 75},styles: {overflow: 'linebreak'},drawRow: function (row, data) {doc.setFontStyle('bold'); doc.setFontSize(8);
        if (row.index === 0) {
          doc.autoTableText("De izquierda a Derecha" , 40, row.y +15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        }  else if (row.index === 1) {
          doc.autoTableText("A lo alto" , 40, row.y+15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        }  else if (row.index === 2) {
          doc.autoTableText("A lo bajo" , 40, row.y+15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        } else if (row.index === 3) {
          doc.autoTableText("XIII. DESCRIPCIÓN DEL ENTORNO INMEDIATO" , 35, row.y+15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        }    
        else if (row.index === 4) {
          doc.autoTableText("XIV. DESCRIPCIÓN DEL ESPACIO" , 35, row.y+15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        } 
      }
    });
      doc.autoTable(colpato.splice(0,4), datapato, {drawHeaderRow: function() {return false;}, startY: doc.autoTableEndPosY() +5,pageBreak: 'auto',theme: 'mary',beforePageContent: header,afterPageContent: footer,bodyStyles: {rowHeight: 14, fontSize: 8, valign: 'middle'},margin: {horizontal: 50, top: 130, bottom: 75},styles: {overflow: 'linebreak'},drawRow: function (row, data) {doc.setFontStyle('bold'); doc.setFontSize(8);
        if (row.index === 0) {
          doc.autoTableText("XV. MEDIDAS" , 35, row.y +15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        }  else if (row.index === 2) {
          doc.autoTableText("XVI. INFORMACIÓN ADICIONAL" , 35, row.y+15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        }  else if (row.index === 3) {
          doc.autoTableText("XVII. PATOLOGIAS" , 35, row.y+15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        } 
      },columnStyles: {prim: {columnWidth: 90,fontStyle: 'bold'},seg: {columnWidth: 150},ter: {columnWidth: 100,fontStyle: 'bold'},cuar: {columnWidth: 140}}
    });
      doc.setFontStyle('bold');
      doc.text('XVIII. VALORACIÓN',35,doc.autoTableEndPosY() +15);
      doc.autoTable(colhis, datahis,{startY: doc.autoTableEndPosY() +30,pageBreak: 'auto',theme: 'plain',bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},headerStyles: {fontStyle: 'bold', rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 50, top: 130, bottom: 75},styles: {overflow: 'linebreak'}});
      doc.autoTable(colrte, datarte,{startY: doc.autoTableEndPosY() +5,pageBreak: 'auto',theme: 'plain',bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},headerStyles: {fontStyle: 'bold', rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 50, top: 130, bottom: 75},styles: {overflow: 'linebreak'}});
      doc.autoTable(coltipo, datatipo,{startY: doc.autoTableEndPosY() +5,pageBreak: 'auto',theme: 'plain',bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},headerStyles: {fontStyle: 'bold', rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 50, top: 130, bottom: 75},styles: {overflow: 'linebreak'}});
      doc.autoTable(coltec, datatec,{startY: doc.autoTableEndPosY() +5,pageBreak: 'auto',theme: 'plain',bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},headerStyles: {fontStyle: 'bold', rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 50, top: 130, bottom: 75},styles: {overflow: 'linebreak'}});
      doc.autoTable(colinte, datainte,{startY: doc.autoTableEndPosY() +5,pageBreak: 'auto',theme: 'plain',bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},headerStyles: {fontStyle: 'bold', rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 50, top: 130, bottom: 75},styles: {overflow: 'linebreak'}});
      doc.autoTable(colurb, dataurb,{startY: doc.autoTableEndPosY() +5,pageBreak: 'auto',theme: 'plain',bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},headerStyles: {fontStyle: 'bold', rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 50, top: 130, bottom: 75},styles: {overflow: 'linebreak'}});
      doc.autoTable(colsimb, datasimb,{startY: doc.autoTableEndPosY() +5,pageBreak: 'auto',theme: 'plain',bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},headerStyles: {fontStyle: 'bold', rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 50, top: 130, bottom: 75},styles: {overflow: 'linebreak'}});
      doc.autoTable(colinta, datainta,{startY: doc.autoTableEndPosY() +5,pageBreak: 'auto',theme: 'plain',bodyStyles: {rowHeight: 12, fontSize: 8, valign: 'middle'},headerStyles: {fontStyle: 'bold', rowHeight: 12, fontSize: 8, valign: 'middle'},margin: {horizontal: 50, top: 130, bottom: 75},styles: {overflow: 'linebreak'}});
      doc.setFontStyle('bold');
      doc.text('XIX. CRITERIOS DE VALORACIÓN',35,doc.autoTableEndPosY() +15);
      doc.autoTable(colcrite.splice(0,4), datacrite, {drawHeaderRow: function() {return false;} ,
        startY: doc.autoTableEndPosY() +10,pageBreak: 'auto',theme: 'plain',beforePageContent: header,afterPageContent: footer,bodyStyles: {rowHeight: 14, fontSize: 8, valign: 'top'},margin: {horizontal: 50, top: 130, bottom: 75},styles: {overflow: 'linebreak'},drawRow: function (row, data) {doc.setFontStyle('bold'); doc.setFontSize(8);
        if (row.index === 0) {
          doc.setTextColor(0);
          doc.autoTableText("Indicador Histórico Cultural" , 40, row.y +15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        }  else if (row.index === 1) {
          doc.setTextColor(0);
          doc.autoTableText("Indicador Artístico" , 40, row.y+15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        }  else if (row.index === 2) {
          doc.setTextColor(0);
          doc.autoTableText("Indicador Tipológico" , 40, row.y+15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        } else if (row.index === 3) {
          doc.setTextColor(0);
          doc.autoTableText("Indicador Tecnológico" , 40, row.y+15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        } else if (row.index === 4) {
          doc.setTextColor(0);
          doc.autoTableText("Indicador de Integridad" , 40, row.y+15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        } else if (row.index === 5) {
          doc.setTextColor(0);
          doc.autoTableText("Indicador Urbano" , 40, row.y+15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        } else if (row.index === 6) {
          doc.setTextColor(0);
          doc.autoTableText("Indicador Simbólico" , 40, row.y+15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        } else if (row.index === 6) {
          doc.setTextColor(0);
          doc.autoTableText("Indicador Simbólico" , 40, row.y+15, {
            halign: 'left',
            valign: 'middle'
          });
          data.cursor.y += 20;
        } 
      }
    });
      if (typeof doc.putTotalPages === 'function') {
        doc.putTotalPages(totalPagesExp);
      }
      //doc.save('espacioabierto'+'.pdf');
        $('#visorFumm object').attr('data',doc.output('datauristring'));
        $("#divPopup8").modal('show');
    });
    obj.error(function(error) {
    });
  };

}
</script>

<div class="wrap" ng-controller="documentosDeSalidaController"  data-ng-init="inicioDocumentosSalida();">
  <div class="col-md-12">
    <div   class="{{clase222}}">
      <div class="row">
        <div class="col-md-12">
          <div class="panel panel-default">
            <div class="panel-heading"><B> Documentos </B></div>
            <div class="panel-body"  >
              <div ng-show = "personaNatural1 == null">
                <form name="formularioBuscar" readOnly="true" novalidate>
                  <div class="row" ng-show = "frmPersonaNatural1 == null">
                    <div class="col-md-12">
                      <br>
                      <label for="url" >Fecha de creacion:</label>
                      {{docsFechaCreacion}}
                      <input type="hidden" name="AE_IMP_FEC_CREACION" id="AE_IMP_FEC_CREACION" ng-model="datos.AE_IMP_FEC_CREACION">
                    </div>
                    <div class="col-md-12">
                      <br>
                      <label for="url" >DOCUMENTOS DE SALIDA:</label>
                      <br>
                      <a class="btn btn-primary"  ng-click="generarDocumentoPhp(0)" >IMPRIMIR FICHA</a><br><br>
                      <a class="btn btn-primary"  ng-click="generarDocumentoPhp(6)" >ARCHIVO FOTOGRAFICO</a><br><br>
                      <a ng-show="bloque1" class="btn btn-primary" ng-click="generarDocumentoPhp(1)" >Ficha de Bloque 1</a><br><br>
                       <a ng-show="bloque2" class="btn btn-primary" ng-click="generarDocumentoPhp(2)" >Ficha de Bloque 2</a><br><br>
                      <a class="btn btn-primary"  ng-show="bloque3"  ng-click="generarDocumentoPhp(3)" >Ficha de Bloque 3</a><br><br>
                      <a class="btn btn-primary"   ng-show="bloque4" ng-click="generarDocumentoPhp(4)" >Ficha de Bloque 4</a><br><br>
                      <a class="btn btn-primary"   ng-show="bloque5"  ng-click="generarDocumentoPhp(5)" >Ficha de Bloque 5</a><br><br>
                    </div>                                           
                  </div>
                </form>
              </div>
              <div id="impresionid">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div> 
  <div class="modal fade" id="divPopup8" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog" style="width:700px">
             <div class="modal-content">
                 <div class="modal-header">
                     <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Cerrar</span></button>
                 </div>
                 <div class="modal-body">
                     <div id="visorFumm">
                         <object data="" type="application/pdf" width="650" height="500"></object>
                     </div>
                 </div>
                 <div class="modal-footer">
                     <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                 </div>
             </div>
        </div>
    </div>
  <div class="hr-line-dashed"></div>
  <a class="btn btn-primary" ng-disabled="false" ng-click="volver()">
    <i class="glyphicon fa fa-times"></i>
    Cancelar
  </a>
  <a class="btn btn-primary" ng-click="cargarDatos(datos);guardarData(datos);almacenarDocumentosSalidaLocal();" ng-disabled="false">
    <i class="glyphicon fa fa-save"></i>
    Guardar / Continuar
  </a>  
</div>